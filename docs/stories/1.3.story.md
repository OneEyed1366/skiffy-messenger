# Story 1.3: Add Storybook to the apps/v2 project

## Status

Draft

## Story

**As a** developer,
**I want** to integrate Storybook 9 into the apps/v2 Expo + Tauri project,
**so that** I can build, test, and document UI components in isolation with a catalog of UI states for faster development and easier component sharing.

## Acceptance Criteria

1. **Storybook Installation**: Storybook 9 is installed and configured in the apps/v2 project with React Native support
2. **Metro Configuration**: Metro bundler is properly configured to work with Storybook via withStorybook wrapper
3. **Expo Router Integration**: A /storybook route is created and accessible within the app during development
4. **Development Environment Control**: Storybook access is controlled by environment variables (only accessible when EXPO_PUBLIC_ENVIRONMENT='storybook')
5. **Sample Story Creation**: At least one sample story is created demonstrating component states with proper decorators
6. **Build Scripts**: Package.json includes a dedicated storybook script to run the app in storybook mode
7. **Documentation**: Basic README or documentation is provided explaining how to use Storybook in the project

## Tasks / Subtasks

- [ ] Task 1: Install Storybook 9 with React Native support (AC: 1)
  - [ ] Run `pnpm create storybook@latest` and select React Native option
  - [ ] Verify `.rnstorybook` configuration folder is created
  - [ ] Confirm `@storybook/react-native` dependency is installed

- [ ] Task 2: Configure Metro bundler for Storybook integration (AC: 2)
  - [ ] Run `pnpx expo@latest customize metro.config.js` if not already customized
  - [ ] Update metro.config.js to include `withStorybook` wrapper from `@storybook/react-native/metro/withStorybook`
  - [ ] Test Metro bundler restarts properly with Storybook configuration

- [ ] Task 3: Create Storybook route in Expo Router (AC: 3)
  - [ ] Create `app/storybook.tsx` that exports default from '../.rnstorybook'
  - [ ] Update `app/_layout.tsx` to include Stack.Protected guard for storybook screen
  - [ ] Ensure storybook route is only accessible based on environment configuration

- [ ] Task 4: Implement environment-based access control (AC: 4)
  - [ ] Configure Stack.Protected guard to use `process.env.EXPO_PUBLIC_ENVIRONMENT === 'storybook'`
  - [ ] Create package.json script: `"sb": "EXPO_PUBLIC_ENVIRONMENT='storybook' expo start"`
  - [ ] Test that storybook is only accessible when environment variable is set

- [ ] Task 5: Create sample component and story (AC: 5)
  - [ ] Create a sample Input component in components directory with props for label, error, disabled states
  - [ ] Add components directory to stories regex in `.rnstorybook/main.ts`
  - [ ] Create Input.stories.tsx with Basic, Error, and Disabled story variations
  - [ ] Implement decorators for consistent component presentation (padding wrapper)

- [ ] Task 6: Configure build and development scripts (AC: 6)
  - [ ] Add "storybook" script to package.json with environment variable
  - [ ] Verify "start" script continues to work for normal app development
  - [ ] Test both development modes work correctly

- [ ] Task 7: Create basic documentation (AC: 7)
  - [ ] Document Storybook setup and usage in project README or separate docs
  - [ ] Include instructions for writing stories
  - [ ] Document environment variable usage and development workflow

## Dev Notes

### Technology Stack Information

[Source: architecture/tech-stack.md]

**Current Tech Stack (apps/v2)**:

- **Runtime**: Expo ~54.0.13 + Tauri 2.1.0
- **Frontend Framework**: React 19.1.0 with React Compiler
- **Cross-Platform**: React Native 0.81.4 + React Native Web ~0.21.2
- **Styling**: react-native-unistyles 3.0.15
- **Build System**: Expo Metro (built-in)
- **Package Manager**: pnpm (standardized for performance)
- **TypeScript**: ~5.9.2 with strict mode enabled

**Storybook 9 Key Features**:

- Best React Native support yet
- Simplified configuration with new folder structure
- Lite mode UI for TV/MacOS compatibility
- Better controls and conditional args
- 48% leaner core with flatter dependency structure

### Project Structure Context

[Source: architecture/source-tree.md]

**Apps/v2 Structure**:

```
apps/v2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                 # Expo Router application structure
â”‚   â”‚   â”œâ”€â”€ _layout.tsx      # Root layout component (MODIFY for Stack.Protected)
â”‚   â”‚   â””â”€â”€ storybook.tsx    # CREATE: Storybook route
â”‚   â”œâ”€â”€ components/          # React Native UI components (CREATE stories here)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ .rnstorybook/           # CREATE: Storybook configuration
â”œâ”€â”€ package.json            # MODIFY: Add storybook script
â”œâ”€â”€ metro.config.js         # MODIFY: Add withStorybook wrapper
â””â”€â”€ ...
```

**File Creation Locations**:

- Storybook route: `apps/v2/src/app/storybook.tsx`
- Sample component: `apps/v2/src/components/Input.tsx`
- Sample story: `apps/v2/src/components/Input.stories.tsx`
- Metro config: `apps/v2/metro.config.js` (modify existing)
- Layout file: `apps/v2/src/app/_layout.tsx` (modify existing)

### Coding Standards Context

[Source: architecture/coding-standards.md]

**TypeScript Standards**:

- Use strict mode TypeScript with proper interfaces
- Use `@/*` path aliases for clean imports
- Follow function component patterns with explicit types

**React Standards**:

- Use functional components with React 19 compatibility
- Follow hooks order: useState, useEffect, custom hooks, then callbacks
- Let React Compiler handle optimization (avoid manual memoization)

**Styling Standards**:

- Use react-native-unistyles with theme system
- Access colors, spacing, fonts from theme object
- Use `theme.gap()` function for consistent spacing
- Co-locate styles at component bottom

**Import Order** (ESLint enforced):

1. Built-in modules
2. External modules (React, React Native, etc.)
3. Internal modules with path aliases
4. Sibling modules
5. Parent modules

### Previous Story Context

Story 1.1 established the Expo + Tauri project foundation with:

- âœ… Tauri project initialized with Expo integration
- ðŸ”„ Expo static output configuration pending verification
- ðŸ”„ Development environment hot reload testing pending

### Metro Configuration Requirements

The Metro configuration must be updated to work with Storybook while maintaining existing Expo functionality. The `withStorybook` wrapper should be applied to the existing Metro config without breaking current build processes.

### Component Development Guidelines

Sample components should demonstrate:

- TypeScript interface definitions for props
- Unistyles theme-based styling
- Multiple UI states (normal, error, disabled)
- Proper accessibility attributes
- React Native best practices

## Testing

### Testing Standards

[Source: architecture/coding-standards.md]

**Test File Organization**:

- Location: Co-located with source files or in `__tests__` directories
- Naming: `.test.ts` or `.spec.ts` suffix
- Structure: Describe blocks for logical grouping

**Testing Requirements for This Story**:

- Test that Storybook loads correctly in development environment
- Verify sample component renders properly in different states
- Test environment variable controls access correctly
- Validate Metro configuration doesn't break existing build process
- Ensure scripts work as expected (both storybook and normal dev modes)

**Testing Framework**:

- Use React Native Testing Library for component testing
- Follow Jest testing patterns established in project
- Test files should be located in `apps/v2/src/components/__tests__/` or co-located with components

## Change Log

| Date       | Version | Description                                      | Author       |
| ---------- | ------- | ------------------------------------------------ | ------------ |
| 2025-10-20 | 1.0     | Initial story creation for Storybook integration | Scrum Master |
| 2025-10-20 | 1.1     | Renumbered from Story 1.2 to Story 1.3           | Scrum Master |

## Dev Agent Record

### Agent Model Used

<!-- To be filled by dev agent -->

### Debug Log References

<!-- To be filled by dev agent -->

### Completion Notes List

<!-- To be filled by dev agent -->

### File List

<!-- To be filled by dev agent -->

## QA Results

<!-- To be filled by QA agent -->
