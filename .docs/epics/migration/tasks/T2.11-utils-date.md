# T2.11: Date Utilities

## Metadata

| Field        | Value           |
| ------------ | --------------- |
| **ID**       | T2.11           |
| **Layer**    | L2 - Pure Utils |
| **Status**   | pending         |
| **Priority** | medium          |
| **Estimate** | 1h              |
| **Parallel** | true            |
| **Assignee** | -               |
| **Created**  | 2026-01-07      |
| **Updated**  | 2026-01-07      |

## Dependencies

None

## Blocks

| Task ID | Name                         |
| ------- | ---------------------------- |
| T10c.\* | Components displaying dates  |
| T8.\*   | Hooks using date comparisons |

## Description

Pure date utility functions migrated from Mattermost. Uses native JavaScript `Date` API (no moment.js or external libraries) for React Native compatibility.

## Source Files

- `vendor/desktop/webapp/channels/src/utils/datetime.ts`

## Target File

`apps/v2/src/utils/date.ts`

## Implementation

```typescript
// apps/v2/src/utils/date.ts

/**
 * Date utility functions
 * Migrated from: vendor/desktop/webapp/channels/src/utils/datetime.ts
 *
 * Uses native Date API for React Native compatibility (no moment.js).
 */

//#region Types

type IDateInput = Date | number | string;

//#endregion

//#region Internal Helpers

/**
 * Normalizes input to a Date object.
 */
function toDate(input: IDateInput): Date {
  if (input instanceof Date) {
    return input;
  }
  return new Date(input);
}

/**
 * Gets start of day (midnight) for a date.
 */
function startOfDay(date: Date): Date {
  const result = new Date(date);
  result.setHours(0, 0, 0, 0);
  return result;
}

//#endregion

//#region Comparison Functions

/**
 * Checks if two dates are on the same calendar day.
 *
 * @param date1 - First date
 * @param date2 - Second date
 * @returns true if both dates are on the same day
 *
 * @example
 * isSameDay(new Date('2026-01-07T10:00'), new Date('2026-01-07T22:00')) // true
 * isSameDay(new Date('2026-01-07'), new Date('2026-01-08')) // false
 */
export function isSameDay(date1: IDateInput, date2: IDateInput): boolean {
  const d1 = toDate(date1);
  const d2 = toDate(date2);

  return (
    d1.getFullYear() === d2.getFullYear() &&
    d1.getMonth() === d2.getMonth() &&
    d1.getDate() === d2.getDate()
  );
}

/**
 * Checks if two dates are in the same month and year.
 *
 * @param date1 - First date
 * @param date2 - Second date
 * @returns true if both dates are in the same month
 *
 * @example
 * isSameMonth(new Date('2026-01-01'), new Date('2026-01-31')) // true
 * isSameMonth(new Date('2026-01-15'), new Date('2026-02-15')) // false
 */
export function isSameMonth(date1: IDateInput, date2: IDateInput): boolean {
  const d1 = toDate(date1);
  const d2 = toDate(date2);

  return (
    d1.getFullYear() === d2.getFullYear() && d1.getMonth() === d2.getMonth()
  );
}

/**
 * Checks if two dates are in the same year.
 *
 * @param date1 - First date
 * @param date2 - Second date
 * @returns true if both dates are in the same year
 *
 * @example
 * isSameYear(new Date('2026-01-01'), new Date('2026-12-31')) // true
 * isSameYear(new Date('2025-12-31'), new Date('2026-01-01')) // false
 */
export function isSameYear(date1: IDateInput, date2: IDateInput): boolean {
  return toDate(date1).getFullYear() === toDate(date2).getFullYear();
}

//#endregion

//#region Relative Date Checks

/**
 * Checks if a date is today.
 *
 * @param date - Date to check
 * @returns true if the date is today
 *
 * @example
 * isToday(new Date()) // true
 * isToday(new Date('2020-01-01')) // false
 */
export function isToday(date: IDateInput): boolean {
  return isSameDay(date, new Date());
}

/**
 * Checks if a date is yesterday.
 *
 * @param date - Date to check
 * @returns true if the date is yesterday
 *
 * @example
 * const yesterday = new Date();
 * yesterday.setDate(yesterday.getDate() - 1);
 * isYesterday(yesterday) // true
 */
export function isYesterday(date: IDateInput): boolean {
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);
  return isSameDay(date, yesterday);
}

//#endregion

//#region Timestamp Conversion

/**
 * Converts a date to Unix timestamp in seconds (UTC).
 *
 * @param date - Date to convert
 * @returns Unix timestamp in seconds
 *
 * @example
 * toUTCUnixSeconds(new Date('2026-01-01T00:00:00Z')) // 1767225600
 */
export function toUTCUnixSeconds(date: IDateInput): number {
  return Math.floor(toDate(date).getTime() / 1000);
}

//#endregion
```

## Index Export

```typescript
// apps/v2/src/utils/index.ts (append to existing exports)

export {
  isSameDay,
  isSameMonth,
  isSameYear,
  isToday,
  isYesterday,
  toUTCUnixSeconds,
} from "./date";
```

## Acceptance Criteria

- [ ] `isSameDay` compares dates ignoring time component
- [ ] `isSameMonth` compares month and year
- [ ] `isSameYear` compares year only
- [ ] `isToday` correctly identifies today's date
- [ ] `isYesterday` correctly identifies yesterday's date
- [ ] `toUTCUnixSeconds` returns correct Unix timestamp
- [ ] All functions accept Date, number (timestamp), or string inputs
- [ ] No external dependencies (moment.js, date-fns, etc.)
- [ ] Uses `type` keyword with `I` prefix for types
- [ ] Uses `#region` comments for organization
- [ ] Exported from `utils/index.ts`
- [ ] TypeScript strict mode passes

## Testing

```typescript
// apps/v2/src/utils/date.spec.ts

import {
  isSameDay,
  isSameMonth,
  isSameYear,
  isToday,
  isYesterday,
  toUTCUnixSeconds,
} from "./date";

describe("isSameDay", () => {
  it("returns true for same day different times", () => {
    const date1 = new Date("2026-01-07T10:00:00");
    const date2 = new Date("2026-01-07T22:30:00");
    expect(isSameDay(date1, date2)).toBe(true);
  });

  it("returns false for different days", () => {
    const date1 = new Date("2026-01-07");
    const date2 = new Date("2026-01-08");
    expect(isSameDay(date1, date2)).toBe(false);
  });

  it("accepts timestamps", () => {
    const ts1 = new Date("2026-01-07T10:00:00").getTime();
    const ts2 = new Date("2026-01-07T22:00:00").getTime();
    expect(isSameDay(ts1, ts2)).toBe(true);
  });

  it("accepts date strings", () => {
    expect(isSameDay("2026-01-07", "2026-01-07")).toBe(true);
  });
});

describe("isSameMonth", () => {
  it("returns true for same month", () => {
    const date1 = new Date("2026-01-01");
    const date2 = new Date("2026-01-31");
    expect(isSameMonth(date1, date2)).toBe(true);
  });

  it("returns false for different months", () => {
    const date1 = new Date("2026-01-15");
    const date2 = new Date("2026-02-15");
    expect(isSameMonth(date1, date2)).toBe(false);
  });

  it("returns false for same month different year", () => {
    const date1 = new Date("2025-01-15");
    const date2 = new Date("2026-01-15");
    expect(isSameMonth(date1, date2)).toBe(false);
  });
});

describe("isSameYear", () => {
  it("returns true for same year", () => {
    const date1 = new Date("2026-01-01");
    const date2 = new Date("2026-12-31");
    expect(isSameYear(date1, date2)).toBe(true);
  });

  it("returns false for different years", () => {
    const date1 = new Date("2025-12-31");
    const date2 = new Date("2026-01-01");
    expect(isSameYear(date1, date2)).toBe(false);
  });
});

describe("isToday", () => {
  it("returns true for current date", () => {
    expect(isToday(new Date())).toBe(true);
  });

  it("returns true for different time today", () => {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    expect(isToday(today)).toBe(true);
  });

  it("returns false for yesterday", () => {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    expect(isToday(yesterday)).toBe(false);
  });

  it("returns false for tomorrow", () => {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    expect(isToday(tomorrow)).toBe(false);
  });
});

describe("isYesterday", () => {
  it("returns true for yesterday", () => {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    expect(isYesterday(yesterday)).toBe(true);
  });

  it("returns false for today", () => {
    expect(isYesterday(new Date())).toBe(false);
  });

  it("returns false for two days ago", () => {
    const twoDaysAgo = new Date();
    twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
    expect(isYesterday(twoDaysAgo)).toBe(false);
  });
});

describe("toUTCUnixSeconds", () => {
  it("converts date to unix seconds", () => {
    const date = new Date("2026-01-01T00:00:00Z");
    expect(toUTCUnixSeconds(date)).toBe(1767225600);
  });

  it("handles millisecond timestamps", () => {
    const ms = 1767225600000;
    expect(toUTCUnixSeconds(ms)).toBe(1767225600);
  });

  it("truncates fractional seconds", () => {
    const date = new Date("2026-01-01T00:00:00.999Z");
    expect(toUTCUnixSeconds(date)).toBe(1767225600);
  });
});
```

Run tests:

```bash
pnpm --filter @retrievly/app test:unit -- date.spec
```
