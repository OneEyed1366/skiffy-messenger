# T9.01: useCurrentUser Hook

## Metadata

| Field        | Value            |
| ------------ | ---------------- |
| **ID**       | T9.01            |
| **Layer**    | L9 - State Hooks |
| **Status**   | pending          |
| **Priority** | high             |
| **Estimate** | 1h               |
| **Parallel** | true             |
| **Assignee** | -                |
| **Created**  | 2026-01-04       |
| **Updated**  | 2026-01-04       |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T7.04   | Store Setup |

## Blocks

| Task ID | Name                    |
| ------- | ----------------------- |
| T9.xx   | Layout components       |
| T10c.xx | User profile components |

## Description

Create a hook to get the current logged-in user from the auth store.

## Source Analysis

- **Redux Selector**: `vendor/desktop/webapp/platform/client/src/selectors/entities/users.ts` - `getCurrentUser`
- **Usage Example**: `vendor/desktop/webapp/channels/src/components/common/hooks/useOpenSalesLink.ts:20`

```typescript
// Mattermost pattern
const currentUser = useSelector(getCurrentUser);
```

## Migration Target

- **Target File**: `apps/v2/src/hooks/useCurrentUser/useCurrentUser.ts`
- **Index Export**: `apps/v2/src/hooks/useCurrentUser/index.ts`
- **Test File**: `apps/v2/src/hooks/useCurrentUser/useCurrentUser.spec.ts`

## Implementation

```typescript
// apps/v2/src/hooks/useCurrentUser/useCurrentUser.ts

import { useAuthStore } from "@/stores";
import type { IUserProfile } from "@/types";

//#region Types

type IUseCurrentUserReturn = {
  user: IUserProfile | null;
  loading: boolean;
  isLoggedIn: boolean;
};

//#endregion

//#region Hook

export function useCurrentUser(): IUseCurrentUserReturn {
  const user = useAuthStore((state) => state.currentUser);
  const loading = useAuthStore((state) => state.isLoading);
  const isLoggedIn = useAuthStore((state) => state.isLoggedIn);

  return { user, loading, isLoggedIn };
}

//#endregion
```

## Index Export

```typescript
// apps/v2/src/hooks/useCurrentUser/index.ts

export { useCurrentUser } from "./useCurrentUser";
export type { IUseCurrentUserReturn } from "./useCurrentUser";
```

## Acceptance Criteria

- [ ] Uses Zustand store correctly
- [ ] Returns user, loading, and isLoggedIn states
- [ ] TypeScript strict mode passes
- [ ] No `any` types
- [ ] Unit tests pass
- [ ] Exported from hooks index

## Testing

```typescript
// apps/v2/src/hooks/useCurrentUser/useCurrentUser.spec.ts

import { renderHook } from "@testing-library/react-native";
import { useCurrentUser } from "./useCurrentUser";
import { useAuthStore } from "@/stores";

jest.mock("@/stores", () => ({
  useAuthStore: jest.fn(),
}));

describe("useCurrentUser", () => {
  const mockUser = {
    id: "user-1",
    username: "testuser",
    email: "test@example.com",
  };

  beforeEach(() => {
    jest.clearAllMocks();
  });

  it("returns current user when logged in", () => {
    (useAuthStore as unknown as jest.Mock).mockImplementation((selector) =>
      selector({
        currentUser: mockUser,
        isLoading: false,
        isLoggedIn: true,
      }),
    );

    const { result } = renderHook(() => useCurrentUser());

    expect(result.current.user).toEqual(mockUser);
    expect(result.current.loading).toBe(false);
    expect(result.current.isLoggedIn).toBe(true);
  });

  it("returns null user when not logged in", () => {
    (useAuthStore as unknown as jest.Mock).mockImplementation((selector) =>
      selector({
        currentUser: null,
        isLoading: false,
        isLoggedIn: false,
      }),
    );

    const { result } = renderHook(() => useCurrentUser());

    expect(result.current.user).toBeNull();
    expect(result.current.isLoggedIn).toBe(false);
  });

  it("returns loading state correctly", () => {
    (useAuthStore as unknown as jest.Mock).mockImplementation((selector) =>
      selector({
        currentUser: null,
        isLoading: true,
        isLoggedIn: false,
      }),
    );

    const { result } = renderHook(() => useCurrentUser());

    expect(result.current.loading).toBe(true);
  });
});
```

```bash
pnpm --filter @retrievly/app test:unit -- useCurrentUser
```
