# T9.06: useTeamQuery Hook

## Metadata

| Field        | Value            |
| ------------ | ---------------- |
| **ID**       | T9.06            |
| **Layer**    | L9 - State Hooks |
| **Status**   | pending          |
| **Priority** | medium           |
| **Estimate** | 2h               |
| **Parallel** | true             |
| **Assignee** | -                |
| **Created**  | 2026-01-06       |
| **Updated**  | 2026-01-07       |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T7.01   | API Client  |
| T7.02   | QueryClient |
| T7.03   | Query Keys  |

## Blocks

| Task ID | Name                    |
| ------- | ----------------------- |
| T10c.xx | Team switcher, settings |

## Description

Create a TanStack Query hook to fetch and cache a team by ID.

**Architecture Note:** Team data is server state (from REST API), so it uses TanStack Query,
not Zustand. See `.docs/architecture/state-management.md`.

## Source Analysis

- **API Endpoint**: `GET /api/v4/teams/{team_id}`

## Migration Target

- **Target File**: `apps/v2/src/hooks/useTeamQuery/useTeamQuery.ts`
- **Index Export**: `apps/v2/src/hooks/useTeamQuery/index.ts`

## Implementation

```typescript
// apps/v2/src/hooks/useTeamQuery/useTeamQuery.ts

import { useQuery, UseQueryOptions } from "@tanstack/react-query";
import { teamsApi } from "@/api/teams";
import { queryKeys } from "@/queries/keys";
import type { ITeam } from "@/types";

//#region Types

type IUseTeamQueryOptions = Omit<
  UseQueryOptions<ITeam, Error>,
  "queryKey" | "queryFn"
>;

//#endregion Types

//#region Hook

/**
 * Fetches and caches a team by ID using TanStack Query.
 *
 * @param teamId - Team ID to fetch (null/undefined skips query)
 * @param options - TanStack Query options
 * @returns Query result with data, isLoading, error, etc.
 */
export function useTeamQuery(
  teamId: string | null | undefined,
  options?: IUseTeamQueryOptions,
) {
  return useQuery({
    queryKey: queryKeys.teams.detail(teamId!),
    queryFn: () => teamsApi.getTeam(teamId!),
    enabled: !!teamId && (options?.enabled ?? true),
    staleTime: 1000 * 60, // 1 minute
    ...options,
  });
}

//#endregion Hook
```

## Index Export

```typescript
// apps/v2/src/hooks/useTeamQuery/index.ts

export { useTeamQuery } from "./useTeamQuery";
```

## Acceptance Criteria

- [ ] Uses TanStack Query `useQuery` hook
- [ ] Query key uses `queryKeys.teams.detail(teamId)`
- [ ] Disabled when teamId is null/undefined
- [ ] Returns standard TQ result
- [ ] TypeScript strict mode passes

## Testing

```typescript
// apps/v2/src/hooks/useTeamQuery/useTeamQuery.spec.ts

import { renderHook, waitFor } from "@testing-library/react-native";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { useTeamQuery } from "./useTeamQuery";
import { teamsApi } from "@/api/teams";

jest.mock("@/api/teams");

const mockTeam = {
  id: "team-1",
  name: "myteam",
  display_name: "My Team",
  type: "O",
};

function createWrapper() {
  const queryClient = new QueryClient({
    defaultOptions: { queries: { retry: false } },
  });
  return ({ children }: { children: React.ReactNode }) => (
    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>
  );
}

describe("useTeamQuery", () => {
  it("fetches team by ID", async () => {
    (teamsApi.getTeam as jest.Mock).mockResolvedValue(mockTeam);

    const { result } = renderHook(() => useTeamQuery("team-1"), {
      wrapper: createWrapper(),
    });

    await waitFor(() => {
      expect(result.current.isSuccess).toBe(true);
    });

    expect(result.current.data).toEqual(mockTeam);
  });

  it("does not fetch when teamId is null", () => {
    const { result } = renderHook(() => useTeamQuery(null), {
      wrapper: createWrapper(),
    });

    expect(result.current.fetchStatus).toBe("idle");
  });
});
```

## Notes

- **WebSocket updates** — Real-time team updates flow through `teams$` stream → TQ cache (T7.50)
