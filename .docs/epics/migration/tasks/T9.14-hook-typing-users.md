# T9.14: useTypingUsers Hook

## Metadata

| Field        | Value            |
| ------------ | ---------------- |
| **ID**       | T9.14            |
| **Layer**    | L9 - State Hooks |
| **Status**   | pending          |
| **Priority** | medium           |
| **Estimate** | 1h               |
| **Parallel** | true             |
| **Assignee** | -                |
| **Created**  | 2026-01-06       |
| **Updated**  | 2026-01-06       |

## Dependencies

| Task ID | Name             |
| ------- | ---------------- |
| T7.31   | useTypingStore   |
| T8.02   | WebSocket Events |

## Description

Hook to get list of users currently typing in a channel. Integrates with WebSocket events for real-time updates.

## Source Analysis

- **Redux Selector**: `vendor/desktop/webapp/platform/client/src/selectors/entities/typing.ts`

## Migration Target

- **Target File**: `apps/v2/src/hooks/useTypingUsers/useTypingUsers.ts`

## Implementation

```typescript
// apps/v2/src/hooks/useTypingUsers/useTypingUsers.ts

import { useTypingStore } from "@/stores/typing";
import { shallow } from "zustand/shallow";
import type { ITypingUser } from "@/types";

//#region Hook

/**
 * Returns list of users currently typing in a channel.
 * Data flows: WebSocket typing$ stream → useTypingStore → this hook
 *
 * @param channelId - Channel ID to get typing users for
 * @returns Array of typing users with userId, username, timestamp
 */
export function useTypingUsers(channelId: string | null): ITypingUser[] {
  return useTypingStore((state) => {
    if (!channelId) return [];
    return state.typing[channelId] ?? [];
  }, shallow);
}

//#endregion Hook

//#region Formatted Hook

/**
 * Returns formatted typing indicator string.
 *
 * @param channelId - Channel ID
 * @returns Formatted string like "John is typing..." or null if nobody typing
 */
export function useTypingIndicator(channelId: string | null): string | null {
  const typingUsers = useTypingUsers(channelId);

  if (typingUsers.length === 0) return null;
  if (typingUsers.length === 1) {
    return `${typingUsers[0].username} is typing...`;
  }
  if (typingUsers.length === 2) {
    return `${typingUsers[0].username} and ${typingUsers[1].username} are typing...`;
  }
  return `${typingUsers.length} people are typing...`;
}

//#endregion Formatted Hook
```

## Acceptance Criteria

- [ ] Returns list of users typing in channel
- [ ] Filters out stale typing indicators (>5s)
- [ ] Provides formatted string variant
- [ ] Handles multiple users typing
- [ ] TypeScript strict mode passes
