# T6.20: Pressable Component

## Metadata

| Field        | Value              |
| ------------ | ------------------ |
| **ID**       | T6.20              |
| **Layer**    | L6 - UI Components |
| **Status**   | pending            |
| **Priority** | low                |
| **Estimate** | 1h                 |
| **Parallel** | true               |
| **Assignee** | -                  |
| **Created**  | 2026-01-06         |
| **Updated**  | 2026-01-06         |

## Dependencies

| Task ID | Name  |
| ------- | ----- |
| T0.01   | types |

## Blocks

| Task ID | Name                              |
| ------- | --------------------------------- |
| T10b.\* | List items, cards, custom buttons |

## Description

Create a Pressable wrapper component that provides consistent press feedback, accessibility, and ripple effects across platforms. This is a base interactive component for building custom pressable UI elements beyond standard buttons.

Features:

- Opacity feedback on press (cross-platform)
- Ripple effect on Android
- Hover state on web
- Disabled state handling
- Long press support
- Accessibility role and state

## Source Files

- Native React Native Pressable API
- `vendor/desktop/webapp/channels/src/sass/utils/_interaction.scss`

### Source Analysis

The original web implementation uses:

- **CSS transitions**: For hover/active states
- **Cursor styles**: pointer, not-allowed
- **Touch targets**: Minimum 44x44px for mobile

## Migration Target

- **Target File**: `apps/v2/src/components/Pressable/Pressable.tsx`
- **Index Export**: `apps/v2/src/components/Pressable/index.ts`

## Implementation

```typescript
// apps/v2/src/components/Pressable/Pressable.tsx

import {
  Pressable as RNPressable,
  PressableProps as RNPressableProps,
  Platform,
  View,
} from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";

//#region Types

type IPressableFeedback = "opacity" | "highlight" | "none";

type IProps = {
  /**
   * Child elements
   */
  children: React.ReactNode | ((state: { pressed: boolean }) => React.ReactNode);
  /**
   * Press handler
   */
  onPress?: () => void;
  /**
   * Long press handler
   */
  onLongPress?: () => void;
  /**
   * Press in handler
   */
  onPressIn?: () => void;
  /**
   * Press out handler
   */
  onPressOut?: () => void;
  /**
   * Disabled state
   * @default false
   */
  disabled?: boolean;
  /**
   * Press feedback style
   * @default "opacity"
   */
  feedback?: IPressableFeedback;
  /**
   * Opacity when pressed (if feedback="opacity")
   * @default 0.7
   */
  pressedOpacity?: number;
  /**
   * Delay before onLongPress fires (ms)
   * @default 500
   */
  delayLongPress?: number;
  /**
   * Hit slop (extra touchable area)
   */
  hitSlop?: number | { top?: number; bottom?: number; left?: number; right?: number };
  /**
   * Accessibility label
   */
  accessibilityLabel?: string;
  /**
   * Accessibility hint
   */
  accessibilityHint?: string;
  /**
   * Accessibility role
   * @default "button"
   */
  accessibilityRole?: RNPressableProps["accessibilityRole"];
  /**
   * Ref to underlying Pressable
   */
  ref?: React.Ref<React.ComponentRef<typeof RNPressable>>;
  /**
   * Test ID
   */
  testID?: string;
  /**
   * Additional style
   */
  style?: RNPressableProps["style"];
} & UnistylesVariants<typeof styles>;

//#endregion Types

//#region Component

export function Pressable({
  children,
  onPress,
  onLongPress,
  onPressIn,
  onPressOut,
  disabled = false,
  feedback = "opacity",
  pressedOpacity = 0.7,
  delayLongPress = 500,
  hitSlop,
  accessibilityLabel,
  accessibilityHint,
  accessibilityRole = "button",
  ref,
  testID,
  style,
}: IProps) {
  styles.useVariants({ disabled });

  const handlePress = () => {
    if (!disabled) {
      onPress?.();
    }
  };

  const handleLongPress = () => {
    if (!disabled) {
      onLongPress?.();
    }
  };

  const handlePressIn = () => {
    if (!disabled) {
      onPressIn?.();
    }
  };

  const handlePressOut = () => {
    if (!disabled) {
      onPressOut?.();
    }
  };

  return (
    <RNPressable
      ref={ref}
      style={({ pressed, hovered }) => [
        styles.pressable,
        feedback === "opacity" && pressed && { opacity: pressedOpacity },
        feedback === "highlight" && pressed && styles.highlighted,
        Platform.OS === "web" && hovered && !disabled && styles.hovered,
        typeof style === "function" ? style({ pressed }) : style,
      ]}
      onPress={handlePress}
      onLongPress={handleLongPress}
      onPressIn={handlePressIn}
      onPressOut={handlePressOut}
      disabled={disabled}
      delayLongPress={delayLongPress}
      hitSlop={hitSlop}
      accessibilityLabel={accessibilityLabel}
      accessibilityHint={accessibilityHint}
      accessibilityRole={accessibilityRole}
      accessibilityState={{ disabled }}
      testID={testID}
      // Android ripple effect
      android_ripple={
        feedback !== "none" && !disabled
          ? { color: "rgba(0, 0, 0, 0.1)", borderless: false }
          : undefined
      }
    >
      {children}
    </RNPressable>
  );
}

//#endregion Component

//#region Styles

const styles = StyleSheet.create((theme) => ({
  pressable: {
    variants: {
      disabled: {
        true: {
          opacity: 0.32,
          cursor: "not-allowed",
        },
        false: {
          cursor: "pointer",
        },
      },
    },
  },

  highlighted: {
    backgroundColor: `${theme.colors.centerChannelColor}14`, // 8% opacity
  },

  hovered: {
    backgroundColor: `${theme.colors.centerChannelColor}08`, // 3% opacity
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/Pressable/index.ts

export { Pressable } from "./Pressable";
```

## Acceptance Criteria

- [ ] Wraps children with pressable behavior
- [ ] Supports opacity feedback on press
- [ ] Supports highlight feedback on press
- [ ] Supports "none" feedback option
- [ ] Android ripple effect when feedback enabled
- [ ] Web hover state styling
- [ ] Disabled state prevents interaction and shows visual feedback
- [ ] Long press with configurable delay
- [ ] Hit slop for larger touch targets
- [ ] Proper accessibility role and state
- [ ] Uses Unistyles variants (not conditional styles)
- [ ] All types use `I` prefix naming convention
- [ ] No `forwardRef` (React 19 ref prop)
- [ ] TypeScript strict mode passes
- [ ] No `any` types

## Testing

```typescript
// apps/v2/src/components/Pressable/Pressable.spec.tsx

import { render, fireEvent } from "@testing-library/react-native";
import { Text } from "react-native";
import { Pressable } from "./Pressable";

//#region Rendering Tests

describe("<Pressable />", () => {
  describe("rendering", () => {
    it("renders children", () => {
      const { getByText } = render(
        <Pressable>
          <Text>Press me</Text>
        </Pressable>
      );
      expect(getByText("Press me")).toBeTruthy();
    });

    it("renders with render prop children", () => {
      const { getByText } = render(
        <Pressable>
          {({ pressed }) => <Text>{pressed ? "Pressed" : "Not pressed"}</Text>}
        </Pressable>
      );
      expect(getByText("Not pressed")).toBeTruthy();
    });

    it("renders with testID", () => {
      const { getByTestId } = render(
        <Pressable testID="pressable">
          <Text>Content</Text>
        </Pressable>
      );
      expect(getByTestId("pressable")).toBeTruthy();
    });
  });

  //#endregion Rendering Tests

  //#region Interaction Tests

  describe("interactions", () => {
    it("calls onPress when pressed", () => {
      const onPress = jest.fn();
      const { getByText } = render(
        <Pressable onPress={onPress}>
          <Text>Press me</Text>
        </Pressable>
      );

      fireEvent.press(getByText("Press me"));
      expect(onPress).toHaveBeenCalledTimes(1);
    });

    it("calls onLongPress when long pressed", () => {
      const onLongPress = jest.fn();
      const { getByText } = render(
        <Pressable onLongPress={onLongPress}>
          <Text>Hold me</Text>
        </Pressable>
      );

      fireEvent(getByText("Hold me"), "longPress");
      expect(onLongPress).toHaveBeenCalledTimes(1);
    });

    it("calls onPressIn and onPressOut", () => {
      const onPressIn = jest.fn();
      const onPressOut = jest.fn();
      const { getByText } = render(
        <Pressable onPressIn={onPressIn} onPressOut={onPressOut}>
          <Text>Touch me</Text>
        </Pressable>
      );

      fireEvent(getByText("Touch me"), "pressIn");
      expect(onPressIn).toHaveBeenCalledTimes(1);

      fireEvent(getByText("Touch me"), "pressOut");
      expect(onPressOut).toHaveBeenCalledTimes(1);
    });

    it("does not call onPress when disabled", () => {
      const onPress = jest.fn();
      const { getByText } = render(
        <Pressable onPress={onPress} disabled>
          <Text>Disabled</Text>
        </Pressable>
      );

      fireEvent.press(getByText("Disabled"));
      expect(onPress).not.toHaveBeenCalled();
    });
  });

  //#endregion Interaction Tests

  //#region Feedback Tests

  describe("feedback", () => {
    it("applies opacity feedback by default", () => {
      const { getByRole } = render(
        <Pressable>
          <Text>Content</Text>
        </Pressable>
      );
      expect(getByRole("button")).toBeTruthy();
    });

    it("supports highlight feedback", () => {
      const { getByRole } = render(
        <Pressable feedback="highlight">
          <Text>Content</Text>
        </Pressable>
      );
      expect(getByRole("button")).toBeTruthy();
    });

    it("supports none feedback", () => {
      const { getByRole } = render(
        <Pressable feedback="none">
          <Text>Content</Text>
        </Pressable>
      );
      expect(getByRole("button")).toBeTruthy();
    });
  });

  //#endregion Feedback Tests

  //#region Accessibility Tests

  describe("accessibility", () => {
    it("has button role by default", () => {
      const { getByRole } = render(
        <Pressable>
          <Text>Button</Text>
        </Pressable>
      );
      expect(getByRole("button")).toBeTruthy();
    });

    it("supports custom accessibility role", () => {
      const { getByRole } = render(
        <Pressable accessibilityRole="link">
          <Text>Link</Text>
        </Pressable>
      );
      expect(getByRole("link")).toBeTruthy();
    });

    it("uses accessibilityLabel", () => {
      const { getByLabelText } = render(
        <Pressable accessibilityLabel="Custom action">
          <Text>Action</Text>
        </Pressable>
      );
      expect(getByLabelText("Custom action")).toBeTruthy();
    });

    it("has disabled accessibility state when disabled", () => {
      const { getByRole } = render(
        <Pressable disabled>
          <Text>Disabled</Text>
        </Pressable>
      );
      expect(getByRole("button").props.accessibilityState.disabled).toBe(true);
    });
  });

  //#endregion Accessibility Tests

  //#region Hit Slop Tests

  describe("hit slop", () => {
    it("accepts number hit slop", () => {
      const { getByRole } = render(
        <Pressable hitSlop={10}>
          <Text>Content</Text>
        </Pressable>
      );
      expect(getByRole("button").props.hitSlop).toBe(10);
    });

    it("accepts object hit slop", () => {
      const hitSlop = { top: 10, bottom: 10, left: 20, right: 20 };
      const { getByRole } = render(
        <Pressable hitSlop={hitSlop}>
          <Text>Content</Text>
        </Pressable>
      );
      expect(getByRole("button").props.hitSlop).toEqual(hitSlop);
    });
  });

  //#endregion Hit Slop Tests
});
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- Pressable
```

## Storybook

```typescript
// apps/v2/src/components/Pressable/Pressable.stories.tsx

import type { Meta, StoryObj } from "@storybook/react";
import { Text, View } from "react-native";
import { Pressable } from "./Pressable";

const meta: Meta<typeof Pressable> = {
  title: "Components/Pressable",
  component: Pressable,
  argTypes: {
    feedback: {
      control: "select",
      options: ["opacity", "highlight", "none"],
    },
    disabled: { control: "boolean" },
    pressedOpacity: {
      control: { type: "range", min: 0.1, max: 1, step: 0.1 },
    },
  },
  decorators: [
    (Story) => (
      <View style={{ padding: 16 }}>
        <Story />
      </View>
    ),
  ],
};

export default meta;
type Story = StoryObj<typeof Pressable>;

//#region Card Component for Stories

const Card = ({ pressed = false }: { pressed?: boolean }) => (
  <View
    style={{
      padding: 16,
      backgroundColor: pressed ? "#e0e0e0" : "#f5f5f5",
      borderRadius: 8,
      borderWidth: 1,
      borderColor: "#ddd",
    }}
  >
    <Text style={{ fontWeight: "600" }}>Pressable Card</Text>
    <Text style={{ color: "#666", marginTop: 4 }}>
      {pressed ? "Pressed!" : "Tap or click me"}
    </Text>
  </View>
);

//#endregion Card Component for Stories

//#region Basic Stories

export const Default: Story = {
  render: () => (
    <Pressable onPress={() => console.log("Pressed!")}>
      <Card />
    </Pressable>
  ),
};

export const WithRenderProp: Story = {
  render: () => (
    <Pressable onPress={() => console.log("Pressed!")}>
      {({ pressed }) => <Card pressed={pressed} />}
    </Pressable>
  ),
};

export const Disabled: Story = {
  render: () => (
    <Pressable disabled>
      <Card />
    </Pressable>
  ),
};

//#endregion Basic Stories

//#region Feedback Stories

export const OpacityFeedback: Story = {
  render: () => (
    <Pressable feedback="opacity" pressedOpacity={0.5}>
      <Card />
    </Pressable>
  ),
};

export const HighlightFeedback: Story = {
  render: () => (
    <Pressable feedback="highlight">
      <Card />
    </Pressable>
  ),
};

export const NoFeedback: Story = {
  render: () => (
    <Pressable feedback="none">
      <Card />
    </Pressable>
  ),
};

//#endregion Feedback Stories

//#region Interactive Stories

export const LongPress: Story = {
  render: () => (
    <Pressable
      onPress={() => console.log("Press")}
      onLongPress={() => console.log("Long press!")}
      delayLongPress={300}
    >
      <Card />
    </Pressable>
  ),
};

export const WithHitSlop: Story = {
  render: () => (
    <View style={{ padding: 40, backgroundColor: "#f0f0f0" }}>
      <Pressable
        onPress={() => console.log("Pressed!")}
        hitSlop={20}
        style={{ alignSelf: "flex-start" }}
      >
        <Text style={{ padding: 8, backgroundColor: "#ddd" }}>
          Small target with 20px hit slop
        </Text>
      </Pressable>
    </View>
  ),
};

//#endregion Interactive Stories
```
