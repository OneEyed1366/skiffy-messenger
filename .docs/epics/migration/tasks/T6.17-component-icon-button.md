# T6.17: IconButton Component

## Metadata

| Field        | Value              |
| ------------ | ------------------ |
| **ID**       | T6.17              |
| **Layer**    | L6 - UI Components |
| **Status**   | pending            |
| **Priority** | medium             |
| **Estimate** | 1.5h               |
| **Parallel** | true               |
| **Assignee** | -                  |
| **Created**  | 2026-01-06         |
| **Updated**  | 2026-01-06         |

## Dependencies

| Task ID | Name   |
| ------- | ------ |
| T6.05   | Icon   |
| T6.06   | Button |

## Blocks

| Task ID | Name                       |
| ------- | -------------------------- |
| T10b.\* | Toolbar buttons, nav icons |

## Description

Create an IconButton component that combines the Icon component with a pressable wrapper optimized for icon-only interactions. This is a specialized Button variant without text, commonly used in toolbars, headers, and action rows.

Features:

- Circular or rounded square hit targets
- Size variants matching icon sizes
- Visual feedback on press
- Badge/notification dot overlay support
- Accessibility label required (no visible text)

## Source Files

- `vendor/desktop/webapp/channels/src/components/icon_button/icon_button.tsx`
- `vendor/desktop/webapp/channels/src/sass/components/_icon-button.scss`

### Source Analysis

The original implementation uses:

- **Button element**: With `btn btn-icon` classes
- **Sizes**: 24px, 32px, 40px hit targets
- **States**: Hover, active, disabled, toggled
- **Backgrounds**: Transparent default, subtle bg on hover

## Migration Target

- **Target File**: `apps/v2/src/components/IconButton/IconButton.tsx`
- **Index Export**: `apps/v2/src/components/IconButton/index.ts`

## Implementation

```typescript
// apps/v2/src/components/IconButton/IconButton.tsx

import { Pressable, View } from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";

//#region Types

type IIconButtonSize = "sm" | "md" | "lg";
type IIconButtonVariant = "default" | "filled" | "outline";

type IProps = {
  /**
   * Icon element to render
   */
  icon: React.ReactNode;
  /**
   * Press handler
   */
  onPress?: () => void;
  /**
   * Long press handler
   */
  onLongPress?: () => void;
  /**
   * Accessibility label (REQUIRED - no visible text)
   */
  accessibilityLabel: string;
  /**
   * Button size (hit target)
   * @default "md"
   */
  size?: IIconButtonSize;
  /**
   * Visual variant
   * @default "default"
   */
  variant?: IIconButtonVariant;
  /**
   * Disabled state
   * @default false
   */
  disabled?: boolean;
  /**
   * Toggled/active state
   * @default false
   */
  toggled?: boolean;
  /**
   * Show notification badge dot
   * @default false
   */
  showBadge?: boolean;
  /**
   * Badge color
   * @default theme error color
   */
  badgeColor?: string;
  /**
   * Ref to underlying Pressable
   */
  ref?: React.Ref<React.ComponentRef<typeof Pressable>>;
  /**
   * Test ID
   */
  testID?: string;
};

//#endregion Types

//#region Component

export function IconButton({
  icon,
  onPress,
  onLongPress,
  accessibilityLabel,
  size = "md",
  variant = "default",
  disabled = false,
  toggled = false,
  showBadge = false,
  badgeColor,
  ref,
  testID,
}: IProps) {
  styles.useVariants({ size, variant, disabled, toggled });

  const handlePress = () => {
    if (!disabled) {
      onPress?.();
    }
  };

  const handleLongPress = () => {
    if (!disabled) {
      onLongPress?.();
    }
  };

  return (
    <Pressable
      ref={ref}
      style={({ pressed }) => [
        styles.button,
        pressed && !disabled && styles.buttonPressed,
      ]}
      onPress={handlePress}
      onLongPress={handleLongPress}
      disabled={disabled}
      accessibilityRole="button"
      accessibilityLabel={accessibilityLabel}
      accessibilityState={{ disabled, selected: toggled }}
      testID={testID}
    >
      <View style={styles.iconContainer}>{icon}</View>

      {showBadge && (
        <View
          style={[styles.badge, badgeColor && { backgroundColor: badgeColor }]}
        />
      )}
    </Pressable>
  );
}

//#endregion Component

//#region Styles

const styles = StyleSheet.create((theme) => ({
  button: {
    alignItems: "center",
    justifyContent: "center",
    borderRadius: theme.radius.m,
    position: "relative",
    variants: {
      //#region Size Styles
      size: {
        sm: {
          width: 24,
          height: 24,
          borderRadius: theme.radius.s,
        },
        md: {
          width: 32,
          height: 32,
        },
        lg: {
          width: 40,
          height: 40,
        },
      },
      //#endregion Size Styles

      //#region Variant Styles
      variant: {
        default: {
          backgroundColor: "transparent",
        },
        filled: {
          backgroundColor: theme.colors.buttonBg,
        },
        outline: {
          backgroundColor: "transparent",
          borderWidth: 1,
          borderColor: theme.colors.centerChannelColor,
          borderOpacity: 0.16,
        },
      },
      //#endregion Variant Styles

      //#region State Styles
      disabled: {
        true: { opacity: 0.32 },
        false: { opacity: 1 },
      },
      toggled: {
        true: {
          backgroundColor: `${theme.colors.buttonBg}14`, // 8% opacity
        },
        false: {},
      },
      //#endregion State Styles
    },
    compoundVariants: [
      // Toggled filled variant
      {
        variant: "filled",
        toggled: true,
        styles: {
          backgroundColor: theme.colors.buttonBg,
        },
      },
    ],
  },

  buttonPressed: {
    variants: {
      variant: {
        default: {
          backgroundColor: `${theme.colors.centerChannelColor}14`, // 8% opacity
        },
        filled: {
          backgroundColor: theme.colors.primaryHover,
        },
        outline: {
          backgroundColor: `${theme.colors.centerChannelColor}08`, // 3% opacity
        },
      },
    },
  },

  iconContainer: {
    alignItems: "center",
    justifyContent: "center",
    variants: {
      size: {
        sm: { width: 16, height: 16 },
        md: { width: 20, height: 20 },
        lg: { width: 24, height: 24 },
      },
    },
  },

  badge: {
    position: "absolute",
    width: 8,
    height: 8,
    borderRadius: 4,
    backgroundColor: theme.colors.errorText,
    variants: {
      size: {
        sm: { top: 0, right: 0 },
        md: { top: 2, right: 2 },
        lg: { top: 4, right: 4 },
      },
    },
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/IconButton/index.ts

export { IconButton } from "./IconButton";
```

## Acceptance Criteria

- [ ] Renders icon within pressable hit target
- [ ] Supports 3 sizes: sm (24px), md (32px), lg (40px)
- [ ] Supports 3 variants: default, filled, outline
- [ ] Requires accessibilityLabel prop (enforced by TypeScript)
- [ ] Handles disabled state with visual feedback
- [ ] Handles toggled/active state
- [ ] Supports badge notification dot
- [ ] Uses Unistyles variants (not conditional styles)
- [ ] All types use `I` prefix naming convention
- [ ] No `forwardRef` (React 19 ref prop)
- [ ] TypeScript strict mode passes
- [ ] No `any` types

## Testing

```typescript
// apps/v2/src/components/IconButton/IconButton.spec.tsx

import { render, fireEvent } from "@testing-library/react-native";
import { View } from "react-native";
import { IconButton } from "./IconButton";

const MockIcon = () => <View testID="mock-icon" />;

//#region Rendering Tests

describe("<IconButton />", () => {
  describe("rendering", () => {
    it("renders icon", () => {
      const { getByTestId } = render(
        <IconButton icon={<MockIcon />} accessibilityLabel="Test button" />
      );
      expect(getByTestId("mock-icon")).toBeTruthy();
    });

    it("renders with testID", () => {
      const { getByTestId } = render(
        <IconButton
          icon={<MockIcon />}
          accessibilityLabel="Test"
          testID="icon-button"
        />
      );
      expect(getByTestId("icon-button")).toBeTruthy();
    });
  });

  //#endregion Rendering Tests

  //#region Interaction Tests

  describe("interactions", () => {
    it("calls onPress when pressed", () => {
      const onPress = jest.fn();
      const { getByRole } = render(
        <IconButton
          icon={<MockIcon />}
          accessibilityLabel="Press me"
          onPress={onPress}
        />
      );

      fireEvent.press(getByRole("button"));
      expect(onPress).toHaveBeenCalledTimes(1);
    });

    it("calls onLongPress when long pressed", () => {
      const onLongPress = jest.fn();
      const { getByRole } = render(
        <IconButton
          icon={<MockIcon />}
          accessibilityLabel="Hold me"
          onLongPress={onLongPress}
        />
      );

      fireEvent(getByRole("button"), "longPress");
      expect(onLongPress).toHaveBeenCalledTimes(1);
    });

    it("does not call onPress when disabled", () => {
      const onPress = jest.fn();
      const { getByRole } = render(
        <IconButton
          icon={<MockIcon />}
          accessibilityLabel="Disabled"
          onPress={onPress}
          disabled
        />
      );

      fireEvent.press(getByRole("button"));
      expect(onPress).not.toHaveBeenCalled();
    });
  });

  //#endregion Interaction Tests

  //#region Size Tests

  describe("sizes", () => {
    it("renders small size", () => {
      const { getByRole } = render(
        <IconButton icon={<MockIcon />} accessibilityLabel="Small" size="sm" />
      );
      expect(getByRole("button")).toBeTruthy();
    });

    it("renders medium size (default)", () => {
      const { getByRole } = render(
        <IconButton icon={<MockIcon />} accessibilityLabel="Medium" />
      );
      expect(getByRole("button")).toBeTruthy();
    });

    it("renders large size", () => {
      const { getByRole } = render(
        <IconButton icon={<MockIcon />} accessibilityLabel="Large" size="lg" />
      );
      expect(getByRole("button")).toBeTruthy();
    });
  });

  //#endregion Size Tests

  //#region Variant Tests

  describe("variants", () => {
    it("renders default variant", () => {
      const { getByRole } = render(
        <IconButton
          icon={<MockIcon />}
          accessibilityLabel="Default"
          variant="default"
        />
      );
      expect(getByRole("button")).toBeTruthy();
    });

    it("renders filled variant", () => {
      const { getByRole } = render(
        <IconButton
          icon={<MockIcon />}
          accessibilityLabel="Filled"
          variant="filled"
        />
      );
      expect(getByRole("button")).toBeTruthy();
    });

    it("renders outline variant", () => {
      const { getByRole } = render(
        <IconButton
          icon={<MockIcon />}
          accessibilityLabel="Outline"
          variant="outline"
        />
      );
      expect(getByRole("button")).toBeTruthy();
    });
  });

  //#endregion Variant Tests

  //#region State Tests

  describe("states", () => {
    it("handles toggled state", () => {
      const { getByRole } = render(
        <IconButton
          icon={<MockIcon />}
          accessibilityLabel="Toggled"
          toggled
        />
      );
      expect(getByRole("button").props.accessibilityState.selected).toBe(true);
    });

    it("renders badge when showBadge is true", () => {
      const { UNSAFE_getAllByType } = render(
        <IconButton
          icon={<MockIcon />}
          accessibilityLabel="With badge"
          showBadge
        />
      );
      const View = require("react-native").View;
      // Badge is a View element
      expect(UNSAFE_getAllByType(View).length).toBeGreaterThan(1);
    });
  });

  //#endregion State Tests

  //#region Accessibility Tests

  describe("accessibility", () => {
    it("has button role", () => {
      const { getByRole } = render(
        <IconButton icon={<MockIcon />} accessibilityLabel="Accessible" />
      );
      expect(getByRole("button")).toBeTruthy();
    });

    it("uses accessibilityLabel", () => {
      const { getByLabelText } = render(
        <IconButton icon={<MockIcon />} accessibilityLabel="Close menu" />
      );
      expect(getByLabelText("Close menu")).toBeTruthy();
    });

    it("has disabled accessibility state when disabled", () => {
      const { getByRole } = render(
        <IconButton icon={<MockIcon />} accessibilityLabel="Disabled" disabled />
      );
      expect(getByRole("button").props.accessibilityState.disabled).toBe(true);
    });
  });

  //#endregion Accessibility Tests
});
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- IconButton
```

## Storybook

```typescript
// apps/v2/src/components/IconButton/IconButton.stories.tsx

import type { Meta, StoryObj } from "@storybook/react";
import { View, Text } from "react-native";
import { IconButton } from "./IconButton";

// Mock icon component for stories
const PlusIcon = () => (
  <Text style={{ fontSize: 16, fontWeight: "bold" }}>+</Text>
);
const CloseIcon = () => (
  <Text style={{ fontSize: 16, fontWeight: "bold" }}>×</Text>
);
const MenuIcon = () => (
  <Text style={{ fontSize: 16, fontWeight: "bold" }}>☰</Text>
);

const meta: Meta<typeof IconButton> = {
  title: "Components/IconButton",
  component: IconButton,
  argTypes: {
    size: {
      control: "select",
      options: ["sm", "md", "lg"],
    },
    variant: {
      control: "select",
      options: ["default", "filled", "outline"],
    },
    disabled: { control: "boolean" },
    toggled: { control: "boolean" },
    showBadge: { control: "boolean" },
  },
  decorators: [
    (Story) => (
      <View style={{ padding: 16 }}>
        <Story />
      </View>
    ),
  ],
};

export default meta;
type Story = StoryObj<typeof IconButton>;

//#region Basic Stories

export const Default: Story = {
  args: {
    icon: <PlusIcon />,
    accessibilityLabel: "Add item",
  },
};

export const Filled: Story = {
  args: {
    icon: <PlusIcon />,
    accessibilityLabel: "Add item",
    variant: "filled",
  },
};

export const Outline: Story = {
  args: {
    icon: <CloseIcon />,
    accessibilityLabel: "Close",
    variant: "outline",
  },
};

//#endregion Basic Stories

//#region Size Stories

export const AllSizes: Story = {
  render: () => (
    <View style={{ flexDirection: "row", gap: 16, alignItems: "center" }}>
      <IconButton icon={<MenuIcon />} accessibilityLabel="Small menu" size="sm" />
      <IconButton icon={<MenuIcon />} accessibilityLabel="Medium menu" size="md" />
      <IconButton icon={<MenuIcon />} accessibilityLabel="Large menu" size="lg" />
    </View>
  ),
};

//#endregion Size Stories

//#region State Stories

export const Disabled: Story = {
  args: {
    icon: <PlusIcon />,
    accessibilityLabel: "Disabled button",
    disabled: true,
  },
};

export const Toggled: Story = {
  args: {
    icon: <MenuIcon />,
    accessibilityLabel: "Toggle menu",
    toggled: true,
  },
};

export const WithBadge: Story = {
  args: {
    icon: <MenuIcon />,
    accessibilityLabel: "Menu with notifications",
    showBadge: true,
  },
};

//#endregion State Stories
```
