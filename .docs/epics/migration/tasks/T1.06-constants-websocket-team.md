# T1.06: WebSocket & Team Constants

## Metadata

| Field        | Value          |
| ------------ | -------------- |
| **ID**       | T1.06          |
| **Layer**    | L1 - Constants |
| **Status**   | done           |
| **Priority** | high           |
| **Estimate** | 1h             |
| **Parallel** | true           |
| **Assignee** | -              |
| **Created**  | 2026-01-07     |
| **Updated**  | 2026-01-07     |

## Dependencies

| Task ID | Name       |
| ------- | ---------- |
| T0.\*   | L0 - Types |

## Blocks

| Task ID                              | Name                   |
| ------------------------------------ | ---------------------- |
| T8.\*                                | L8 - WebSocket Service |
| T7.\*                                | L7 - Stores            |
| T9.\*                                | L9 - Hooks             |
| WebSocket events used throughout app |

## Description

Migrate WebSocket events, team constants, and scheme scope types from Mattermost webapp. These constants are critical for real-time communication and team/channel permission schemes.

**Included:**

- WebsocketEvents (57 events for real-time communication)
- Team type constants (OPEN, INVITE)
- ScopeTypes for permission schemes (TEAM, CHANNEL)

## Source Files

- `vendor/desktop/webapp/channels/src/packages/mattermost-redux/src/constants/websocket.ts`
- `vendor/desktop/webapp/channels/src/packages/mattermost-redux/src/constants/teams.ts`
- `vendor/desktop/webapp/channels/src/packages/mattermost-redux/src/constants/schemes.ts`
- `vendor/desktop/webapp/channels/src/utils/constants.tsx` (SocketEvents)

## Target File

`apps/v2/src/constants/websocket.ts`
`apps/v2/src/constants/team.ts`

## Implementation

### WebSocket Constants

```typescript
// apps/v2/src/constants/websocket.ts

/**
 * WebSocket event constants for real-time communication
 * Migrated from: vendor/desktop/webapp/channels/src/packages/mattermost-redux/src/constants/websocket.ts
 * Extended from: vendor/desktop/webapp/channels/src/utils/constants.tsx (SocketEvents)
 */

//#region WebSocket Events

/**
 * All WebSocket events used for real-time communication with the server.
 * These events are received via WebSocket and trigger state updates.
 */
export const WEBSOCKET_EVENTS = {
  // Post events
  POSTED: "posted",
  POST_EDITED: "post_edited",
  POST_DELETED: "post_deleted",
  POST_UPDATED: "post_updated",
  POST_UNREAD: "post_unread",

  // Burn on read events
  BURN_ON_READ_POST_REVEALED: "post_revealed",
  BURN_ON_READ_POST_BURNED: "post_burned",
  BURN_ON_READ_ALL_REVEALED: "burn_on_read_all_revealed",

  // Post acknowledgement events
  POST_ACKNOWLEDGEMENT_ADDED: "post_acknowledgement_added",
  POST_ACKNOWLEDGEMENT_REMOVED: "post_acknowledgement_removed",

  // Channel events
  CHANNEL_CONVERTED: "channel_converted",
  CHANNEL_CREATED: "channel_created",
  CHANNEL_DELETED: "channel_deleted",
  CHANNEL_UNARCHIVED: "channel_restored",
  CHANNEL_UPDATED: "channel_updated",
  MULTIPLE_CHANNELS_VIEWED: "multiple_channels_viewed",
  CHANNEL_MEMBER_UPDATED: "channel_member_updated",
  CHANNEL_SCHEME_UPDATED: "channel_scheme_updated",

  // Channel bookmark events
  CHANNEL_BOOKMARK_CREATED: "channel_bookmark_created",
  CHANNEL_BOOKMARK_DELETED: "channel_bookmark_deleted",
  CHANNEL_BOOKMARK_UPDATED: "channel_bookmark_updated",
  CHANNEL_BOOKMARK_SORTED: "channel_bookmark_sorted",

  // Direct/Group message events
  DIRECT_ADDED: "direct_added",
  GROUP_ADDED: "group_added",

  // Team events
  ADDED_TO_TEAM: "added_to_team",
  JOIN_TEAM: "join_team",
  LEAVE_TEAM: "leave_team",
  UPDATE_TEAM: "update_team",
  DELETE_TEAM: "delete_team",
  UPDATE_TEAM_SCHEME: "update_team_scheme",

  // User events
  NEW_USER: "new_user",
  USER_ADDED: "user_added",
  USER_REMOVED: "user_removed",
  USER_UPDATED: "user_updated",
  USER_ROLE_UPDATED: "user_role_updated",
  MEMBERROLE_UPDATED: "memberrole_updated",
  USER_ACTIVATION_STATUS_CHANGED: "user_activation_status_change",

  // Role events
  ROLE_ADDED: "role_added",
  ROLE_REMOVED: "role_removed",
  ROLE_UPDATED: "role_updated",

  // Typing events
  TYPING: "typing",
  STOP_TYPING: "stop_typing",

  // Preference events
  PREFERENCE_CHANGED: "preference_changed",
  PREFERENCES_CHANGED: "preferences_changed",
  PREFERENCES_DELETED: "preferences_deleted",

  // System events
  EPHEMERAL_MESSAGE: "ephemeral_message",
  STATUS_CHANGED: "status_change",
  HELLO: "hello",

  // Reaction events
  REACTION_ADDED: "reaction_added",
  REACTION_REMOVED: "reaction_removed",

  // Emoji events
  EMOJI_ADDED: "emoji_added",

  // Plugin events
  PLUGIN_ENABLED: "plugin_enabled",
  PLUGIN_DISABLED: "plugin_disabled",
  PLUGIN_STATUSES_CHANGED: "plugin_statuses_changed",

  // Config events
  LICENSE_CHANGED: "license_changed",
  CONFIG_CHANGED: "config_changed",

  // Dialog events
  OPEN_DIALOG: "open_dialog",

  // Group events
  RECEIVED_GROUP: "received_group",
  GROUP_MEMBER_ADD: "group_member_add",
  GROUP_MEMBER_DELETED: "group_member_deleted",
  RECEIVED_GROUP_ASSOCIATED_TO_TEAM: "received_group_associated_to_team",
  RECEIVED_GROUP_NOT_ASSOCIATED_TO_TEAM:
    "received_group_not_associated_to_team",
  RECEIVED_GROUP_ASSOCIATED_TO_CHANNEL: "received_group_associated_to_channel",
  RECEIVED_GROUP_NOT_ASSOCIATED_TO_CHANNEL:
    "received_group_not_associated_to_channel",

  // Sidebar category events
  SIDEBAR_CATEGORY_CREATED: "sidebar_category_created",
  SIDEBAR_CATEGORY_UPDATED: "sidebar_category_updated",
  SIDEBAR_CATEGORY_DELETED: "sidebar_category_deleted",
  SIDEBAR_CATEGORY_ORDER_UPDATED: "sidebar_category_order_updated",

  // Thread events
  THREAD_UPDATED: "thread_updated",
  THREAD_FOLLOW_CHANGED: "thread_follow_changed",
  THREAD_READ_CHANGED: "thread_read_changed",

  // Draft events
  DRAFT_CREATED: "draft_created",
  DRAFT_UPDATED: "draft_updated",
  DRAFT_DELETED: "draft_deleted",

  // Scheduled post events
  SCHEDULED_POST_CREATED: "scheduled_post_created",
  SCHEDULED_POST_UPDATED: "scheduled_post_updated",
  SCHEDULED_POST_DELETED: "scheduled_post_deleted",

  // Cloud events
  CLOUD_PAYMENT_STATUS_UPDATED: "cloud_payment_status_updated",
  CLOUD_SUBSCRIPTION_CHANGED: "cloud_subscription_changed",

  // Apps framework events
  APPS_FRAMEWORK_REFRESH_BINDINGS:
    "custom_com.mattermost.apps_refresh_bindings",
  APPS_FRAMEWORK_PLUGIN_ENABLED: "custom_com.mattermost.apps_plugin_enabled",
  APPS_FRAMEWORK_PLUGIN_DISABLED: "custom_com.mattermost.apps_plugin_disabled",

  // Admin events
  FIRST_ADMIN_VISIT_MARKETPLACE_STATUS_RECEIVED:
    "first_admin_visit_marketplace_status_received",

  // Notification events
  PERSISTENT_NOTIFICATION_TRIGGERED: "persistent_notification_triggered",

  // Hosted customer events
  HOSTED_CUSTOMER_SIGNUP_PROGRESS_UPDATED:
    "hosted_customer_signup_progress_updated",

  // Custom profile attributes events
  CPA_FIELD_CREATED: "custom_profile_attributes_field_created",
  CPA_FIELD_UPDATED: "custom_profile_attributes_field_updated",
  CPA_FIELD_DELETED: "custom_profile_attributes_field_deleted",
  CPA_VALUES_UPDATED: "custom_profile_attributes_values_updated",

  // Content flagging events
  CONTENT_FLAGGING_REPORT_VALUE_CHANGED:
    "content_flagging_report_value_updated",

  // WebRTC (legacy)
  WEBRTC: "webrtc",

  // Post visibility
  INCREASE_POST_VISIBILITY_BY_ONE: "increase_post_visibility_by_one",
} as const;

export type IWebsocketEvent =
  (typeof WEBSOCKET_EVENTS)[keyof typeof WEBSOCKET_EVENTS];

//#endregion

//#region WebSocket Event Categories

/**
 * Post-related WebSocket events
 */
export const POST_WEBSOCKET_EVENTS = [
  WEBSOCKET_EVENTS.POSTED,
  WEBSOCKET_EVENTS.POST_EDITED,
  WEBSOCKET_EVENTS.POST_DELETED,
  WEBSOCKET_EVENTS.POST_UPDATED,
  WEBSOCKET_EVENTS.POST_UNREAD,
  WEBSOCKET_EVENTS.BURN_ON_READ_POST_REVEALED,
  WEBSOCKET_EVENTS.BURN_ON_READ_POST_BURNED,
  WEBSOCKET_EVENTS.BURN_ON_READ_ALL_REVEALED,
  WEBSOCKET_EVENTS.POST_ACKNOWLEDGEMENT_ADDED,
  WEBSOCKET_EVENTS.POST_ACKNOWLEDGEMENT_REMOVED,
] as const;

/**
 * Channel-related WebSocket events
 */
export const CHANNEL_WEBSOCKET_EVENTS = [
  WEBSOCKET_EVENTS.CHANNEL_CONVERTED,
  WEBSOCKET_EVENTS.CHANNEL_CREATED,
  WEBSOCKET_EVENTS.CHANNEL_DELETED,
  WEBSOCKET_EVENTS.CHANNEL_UNARCHIVED,
  WEBSOCKET_EVENTS.CHANNEL_UPDATED,
  WEBSOCKET_EVENTS.MULTIPLE_CHANNELS_VIEWED,
  WEBSOCKET_EVENTS.CHANNEL_MEMBER_UPDATED,
  WEBSOCKET_EVENTS.CHANNEL_SCHEME_UPDATED,
  WEBSOCKET_EVENTS.CHANNEL_BOOKMARK_CREATED,
  WEBSOCKET_EVENTS.CHANNEL_BOOKMARK_DELETED,
  WEBSOCKET_EVENTS.CHANNEL_BOOKMARK_UPDATED,
  WEBSOCKET_EVENTS.CHANNEL_BOOKMARK_SORTED,
  WEBSOCKET_EVENTS.DIRECT_ADDED,
  WEBSOCKET_EVENTS.GROUP_ADDED,
] as const;

/**
 * Team-related WebSocket events
 */
export const TEAM_WEBSOCKET_EVENTS = [
  WEBSOCKET_EVENTS.ADDED_TO_TEAM,
  WEBSOCKET_EVENTS.JOIN_TEAM,
  WEBSOCKET_EVENTS.LEAVE_TEAM,
  WEBSOCKET_EVENTS.UPDATE_TEAM,
  WEBSOCKET_EVENTS.DELETE_TEAM,
  WEBSOCKET_EVENTS.UPDATE_TEAM_SCHEME,
] as const;

/**
 * User-related WebSocket events
 */
export const USER_WEBSOCKET_EVENTS = [
  WEBSOCKET_EVENTS.NEW_USER,
  WEBSOCKET_EVENTS.USER_ADDED,
  WEBSOCKET_EVENTS.USER_REMOVED,
  WEBSOCKET_EVENTS.USER_UPDATED,
  WEBSOCKET_EVENTS.USER_ROLE_UPDATED,
  WEBSOCKET_EVENTS.MEMBERROLE_UPDATED,
  WEBSOCKET_EVENTS.USER_ACTIVATION_STATUS_CHANGED,
  WEBSOCKET_EVENTS.STATUS_CHANGED,
] as const;

/**
 * Thread-related WebSocket events
 */
export const THREAD_WEBSOCKET_EVENTS = [
  WEBSOCKET_EVENTS.THREAD_UPDATED,
  WEBSOCKET_EVENTS.THREAD_FOLLOW_CHANGED,
  WEBSOCKET_EVENTS.THREAD_READ_CHANGED,
] as const;

//#endregion
```

### Team Constants

```typescript
// apps/v2/src/constants/team.ts

/**
 * Team-related constants
 * Migrated from: vendor/desktop/webapp/channels/src/packages/mattermost-redux/src/constants/teams.ts
 *                vendor/desktop/webapp/channels/src/packages/mattermost-redux/src/constants/schemes.ts
 */

//#region Team Types

/**
 * Team type identifiers
 * - OPEN: Anyone can join without an invite
 * - INVITE: Users need an invite to join
 */
export const TEAM_TYPES = {
  /** Open team - anyone can join */
  OPEN: "O",
  /** Invite-only team - requires invitation */
  INVITE: "I",
} as const;

export type ITeamType = (typeof TEAM_TYPES)[keyof typeof TEAM_TYPES];

//#endregion

//#region Scheme Scope Types

/**
 * Scope types for permission schemes
 * Used to determine at which level permissions are applied
 */
export const SCOPE_TYPES = {
  /** Team-level scope */
  TEAM: "team",
  /** Channel-level scope */
  CHANNEL: "channel",
} as const;

export type IScopeType = (typeof SCOPE_TYPES)[keyof typeof SCOPE_TYPES];

//#endregion

//#region Team Sort Options

/**
 * Options for sorting team members
 */
export const TEAM_SORT_OPTIONS = {
  /** Sort by username */
  USERNAME: "Username",
} as const;

export type ITeamSortOption =
  (typeof TEAM_SORT_OPTIONS)[keyof typeof TEAM_SORT_OPTIONS];

//#endregion

//#region Team Limits

/**
 * Team-related limits and constraints
 */
export const TEAM_LIMITS = {
  /** Minimum team name length */
  MIN_TEAMNAME_LENGTH: 2,
  /** Maximum team name length */
  MAX_TEAMNAME_LENGTH: 64,
  /** Maximum team description length */
  MAX_TEAMDESCRIPTION_LENGTH: 50,
  /** Default maximum users per team */
  DEFAULT_MAX_USERS_PER_TEAM: 50,
} as const;

//#endregion
```

## Index Export

```typescript
// apps/v2/src/constants/index.ts

// WebSocket constants
export {
  WEBSOCKET_EVENTS,
  POST_WEBSOCKET_EVENTS,
  CHANNEL_WEBSOCKET_EVENTS,
  TEAM_WEBSOCKET_EVENTS,
  USER_WEBSOCKET_EVENTS,
  THREAD_WEBSOCKET_EVENTS,
  type IWebsocketEvent,
} from "./websocket";

// Team constants
export {
  TEAM_TYPES,
  SCOPE_TYPES,
  TEAM_SORT_OPTIONS,
  TEAM_LIMITS,
  type ITeamType,
  type IScopeType,
  type ITeamSortOption,
} from "./team";
```

## Acceptance Criteria

- [ ] All 57+ WebSocket events defined with `as const`
- [ ] Team type constants (OPEN, INVITE) defined
- [ ] Scope types (TEAM, CHANNEL) for permission schemes
- [ ] All type exports prefixed with `I`
- [ ] Uses `#region` comments for organization
- [ ] Exported from `constants/index.ts`
- [ ] Event category arrays for filtering
- [ ] TypeScript strict mode passes

## Testing

```bash
# Type check
pnpm --filter @retrievly/app tsc --noEmit

# Verify exports
pnpm --filter @retrievly/app test:unit -- constants
```

## Usage Examples

```typescript
import {
  WEBSOCKET_EVENTS,
  TEAM_TYPES,
  SCOPE_TYPES,
  type IWebsocketEvent,
} from "@/constants";

// WebSocket event handler
function handleWebSocketEvent(event: IWebsocketEvent, data: unknown) {
  switch (event) {
    case WEBSOCKET_EVENTS.POSTED:
      // Handle new post
      break;
    case WEBSOCKET_EVENTS.TYPING:
      // Handle typing indicator
      break;
    case WEBSOCKET_EVENTS.USER_UPDATED:
      // Handle user update
      break;
  }
}

// Team type check
function isOpenTeam(teamType: string): boolean {
  return teamType === TEAM_TYPES.OPEN;
}

// Permission scope check
function isChannelScope(scope: string): boolean {
  return scope === SCOPE_TYPES.CHANNEL;
}
```

## Notes

- WebSocket events are the primary mechanism for real-time updates
- Team types determine how users can join a team
- Scope types are used in permission scheme definitions
- Event category arrays are useful for filtering/subscribing to related events
