# T6.02: Badge Component

## Metadata

| Field        | Value                |
| ------------ | -------------------- |
| **ID**       | T6.02                |
| **Layer**    | L6 - Base Components |
| **Status**   | pending              |
| **Priority** | high                 |
| **Estimate** | 2h                   |
| **Parallel** | true                 |
| **Assignee** | -                    |
| **Created**  | 2026-01-04           |
| **Updated**  | 2026-01-04           |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T1.01   | theme-setup |

## Blocks

| Task ID | Name                          |
| ------- | ----------------------------- |
| T9.xx   | Sidebar channel items         |
| T9.xx   | Channel header components     |
| T10b.\* | Components with notifications |

## Description

Migrate Badge component for notification counts from Mattermost. The component displays notification counts with support for max display value (99+), dot-only variant, color variants, and positioning options.

## Source Files

- `vendor/desktop/webapp/channels/src/components/sidebar/sidebar_channel/channel_mention_badge.tsx` (lines 1-31)
- `vendor/desktop/webapp/channels/src/components/team_sidebar/components/team_button.tsx` (lines 72-127)

### Source Analysis

The original implementation uses:

- **classnames**: For conditional class composition
- **CSS classes**: `.badge`, `.badge-max-number`, `.urgent`, `.unread-badge`
- **Max value logic**: `mentions > 99 ? '99+' : mentions`
- **Dot variant**: Simple `<span className={'unread-badge'}/>` without number

Key patterns migrated:
| Original Pattern | Purpose |
|-----------------|---------|
| `ChannelMentionBadge` | Badge with mention count and optional icon |
| `unread-badge` | Dot-only indicator for unread state |
| `badge-max-number` | Badge with 99+ overflow |
| `urgent` class | Visual urgency indicator |

## Migration Target

- **Target Folder**: `apps/v2/src/components/Badge/`
- **Files**:
  - `Badge.tsx` - component + styles
  - `Badge.spec.tsx` - tests
  - `Badge.stories.tsx` - storybook
  - `index.ts` - export

## Implementation

```typescript
// apps/v2/src/components/Badge/Badge.tsx

/**
 * Badge component for notification counts
 * Migrated from: vendor/desktop/webapp/channels/src/components/sidebar/sidebar_channel/channel_mention_badge.tsx
 */

import { View, Text } from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";

//#region Types

type IProps = {
  /** Number to display (ignored for dot variant) */
  count?: number;
  /** Maximum number to display before showing "max+" */
  max?: number;
  /** Show badge even when count is 0 */
  showZero?: boolean;
  /** Optional icon to display before count */
  icon?: React.ReactNode;
  /** Accessible label for screen readers */
  accessibilityLabel?: string;
  /** Test ID for testing */
  testID?: string;
  /** Ref to the container View */
  ref?: React.Ref<React.ComponentRef<typeof View>>;
} & UnistylesVariants<typeof styles>;

//#endregion Types

//#region Constants

const DEFAULT_MAX = 99;

//#endregion Constants

//#region Component

export function Badge({
  count = 0,
  max = DEFAULT_MAX,
  showZero = false,
  icon,
  accessibilityLabel,
  testID,
  variant = "default",
  color = "default",
  position = "inline",
  size = "md",
  ref,
}: IProps) {
  styles.useVariants({ variant, color, position, size });

  // Dot variant doesn't need count logic
  if (variant === "dot") {
    return (
      <View
        ref={ref}
        style={styles.container}
        accessibilityLabel={accessibilityLabel ?? "New notification"}
        accessibilityRole="text"
        testID={testID}
      />
    );
  }

  // Don't render if count is 0 and showZero is false
  if (count === 0 && !showZero) {
    return null;
  }

  const displayValue = count > max ? `${max}+` : String(count);

  return (
    <View
      ref={ref}
      style={styles.container}
      accessibilityLabel={accessibilityLabel ?? `${count} notifications`}
      accessibilityRole="text"
      testID={testID}
    >
      {icon}
      <Text style={styles.text}>{displayValue}</Text>
    </View>
  );
}

//#endregion Component

//#region Styles

const styles = StyleSheet.create((theme) => ({
  container: {
    alignItems: "center",
    justifyContent: "center",
    flexDirection: "row",
    variants: {
      variant: {
        default: {
          borderRadius: theme.radius.xl,
        },
        dot: {
          borderRadius: theme.radius.xl,
        },
      },
      color: {
        default: {
          backgroundColor: theme.colors.buttonBg,
        },
        mention: {
          backgroundColor: theme.colors.mentionBg,
        },
        urgent: {
          backgroundColor: theme.colors.errorTextColor,
        },
      },
      position: {
        inline: {},
        topRight: {
          position: "absolute",
          top: -4,
          right: -4,
        },
      },
      size: {
        sm: {
          minWidth: 16,
          height: 16,
          paddingHorizontal: theme.gap(0.5),
        },
        md: {
          minWidth: 20,
          height: 20,
          paddingHorizontal: theme.gap(0.75),
        },
        lg: {
          minWidth: 24,
          height: 24,
          paddingHorizontal: theme.gap(1),
        },
      },
    },
    compoundVariants: [
      {
        variant: "dot",
        size: "sm",
        styles: {
          width: 6,
          height: 6,
          minWidth: 6,
          paddingHorizontal: 0,
        },
      },
      {
        variant: "dot",
        size: "md",
        styles: {
          width: 8,
          height: 8,
          minWidth: 8,
          paddingHorizontal: 0,
        },
      },
      {
        variant: "dot",
        size: "lg",
        styles: {
          width: 10,
          height: 10,
          minWidth: 10,
          paddingHorizontal: 0,
        },
      },
    ],
  },
  text: {
    fontWeight: "600",
    textAlign: "center",
    variants: {
      variant: {
        default: {},
        dot: {
          display: "none",
        },
      },
      color: {
        default: {
          color: theme.colors.buttonColor,
        },
        mention: {
          color: theme.colors.mentionColor,
        },
        urgent: {
          color: theme.colors.buttonColor,
        },
      },
      position: {
        inline: {},
        topRight: {},
      },
      size: {
        sm: {
          fontSize: 10,
        },
        md: {
          fontSize: 11,
        },
        lg: {
          fontSize: 13,
        },
      },
    },
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/Badge/index.ts

export { Badge } from "./Badge";
```

## Storybook

```typescript
// apps/v2/src/components/Badge/Badge.stories.tsx

import type { Meta, StoryObj } from "@storybook/react";
import { View } from "react-native";
import { Badge } from "./Badge";

const meta: Meta<typeof Badge> = {
  component: Badge,
  title: "Base/Badge",
  argTypes: {
    variant: {
      control: "select",
      options: ["default", "dot"],
    },
    color: {
      control: "select",
      options: ["default", "mention", "urgent"],
    },
    position: {
      control: "select",
      options: ["inline", "topRight"],
    },
    size: {
      control: "select",
      options: ["sm", "md", "lg"],
    },
  },
};
export default meta;

type IStory = StoryObj<typeof Badge>;

export const Default: IStory = {
  args: {
    count: 5,
    variant: "default",
    color: "default",
    size: "md",
  },
};

export const MentionColor: IStory = {
  args: {
    count: 3,
    color: "mention",
    size: "md",
  },
};

export const UrgentColor: IStory = {
  args: {
    count: 3,
    color: "urgent",
    size: "md",
  },
};

export const OverMax: IStory = {
  args: {
    count: 150,
    max: 99,
    variant: "default",
    size: "md",
  },
};

export const DotVariant: IStory = {
  args: {
    variant: "dot",
    color: "default",
    size: "md",
  },
};

export const DotUrgent: IStory = {
  args: {
    variant: "dot",
    color: "urgent",
    size: "md",
  },
};

export const TopRightPosition: IStory = {
  render: () => (
    <View style={{ width: 40, height: 40, backgroundColor: "#ddd", position: "relative" }}>
      <Badge count={5} position="topRight" color="urgent" />
    </View>
  ),
};

export const AllSizes: IStory = {
  render: () => (
    <View style={{ flexDirection: "row", gap: 8 }}>
      <Badge count={5} size="sm" />
      <Badge count={5} size="md" />
      <Badge count={5} size="lg" />
    </View>
  ),
};

export const AllDotSizes: IStory = {
  render: () => (
    <View style={{ flexDirection: "row", gap: 8, alignItems: "center" }}>
      <Badge variant="dot" size="sm" />
      <Badge variant="dot" size="md" />
      <Badge variant="dot" size="lg" />
    </View>
  ),
};

export const AllColors: IStory = {
  render: () => (
    <View style={{ flexDirection: "row", gap: 8 }}>
      <Badge count={5} color="default" />
      <Badge count={5} color="mention" />
      <Badge count={5} color="urgent" />
    </View>
  ),
};

export const ZeroCount: IStory = {
  args: {
    count: 0,
  },
};

export const ZeroWithShowZero: IStory = {
  args: {
    count: 0,
    showZero: true,
  },
};
```

## Acceptance Criteria

- [ ] Displays count with max overflow (99+)
- [ ] Supports dot variant without number
- [ ] Supports color variants (default, mention, urgent)
- [ ] Supports position variants (inline, top-right)
- [ ] Supports size variants (sm, md, lg)
- [ ] Uses Unistyles variants (not conditional styles)
- [ ] No `useCallback`/`useMemo` (React Compiler handles memoization)
- [ ] All types use `I` prefix naming convention
- [ ] Proper accessibility labels
- [ ] Exported from `components/Badge/index.ts`
- [ ] TypeScript strict mode passes
- [ ] No `any` types
- [ ] Storybook stories
- [ ] Unit tests pass

## Testing

```typescript
// apps/v2/src/components/Badge/Badge.spec.tsx

import { render, screen } from "@testing-library/react-native";
import { Badge } from "./Badge";

//#region Rendering Tests

describe("<Badge />", () => {
  describe("default variant", () => {
    it("renders count", () => {
      render(<Badge count={5} testID="badge" />);

      expect(screen.getByText("5")).toBeTruthy();
    });

    it("renders max+ when count exceeds max", () => {
      render(<Badge count={150} max={99} testID="badge" />);

      expect(screen.getByText("99+")).toBeTruthy();
    });

    it("renders custom max", () => {
      render(<Badge count={15} max={10} testID="badge" />);

      expect(screen.getByText("10+")).toBeTruthy();
    });

    it("does not render when count is 0 by default", () => {
      render(<Badge count={0} testID="badge" />);

      expect(screen.queryByTestId("badge")).toBeNull();
    });

    it("renders when count is 0 and showZero is true", () => {
      render(<Badge count={0} showZero testID="badge" />);

      expect(screen.getByText("0")).toBeTruthy();
    });
  });

  describe("dot variant", () => {
    it("renders dot without count", () => {
      render(<Badge variant="dot" testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
      expect(screen.queryByText(/\d/)).toBeNull();
    });

    it("renders dot even when count is 0", () => {
      render(<Badge variant="dot" count={0} testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
    });
  });

  describe("accessibility", () => {
    it("has default accessibility label for count", () => {
      render(<Badge count={5} testID="badge" />);

      expect(screen.getByLabelText("5 notifications")).toBeTruthy();
    });

    it("has default accessibility label for dot", () => {
      render(<Badge variant="dot" testID="badge" />);

      expect(screen.getByLabelText("New notification")).toBeTruthy();
    });

    it("accepts custom accessibility label", () => {
      render(
        <Badge count={3} accessibilityLabel="3 unread messages" testID="badge" />
      );

      expect(screen.getByLabelText("3 unread messages")).toBeTruthy();
    });
  });

  describe("color variants", () => {
    it("renders with default color", () => {
      render(<Badge count={5} color="default" testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
    });

    it("renders with mention color", () => {
      render(<Badge count={5} color="mention" testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
    });

    it("renders with urgent color", () => {
      render(<Badge count={5} color="urgent" testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
    });
  });

  describe("position variants", () => {
    it("renders with inline position", () => {
      render(<Badge count={5} position="inline" testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
    });

    it("renders with topRight position", () => {
      render(<Badge count={5} position="topRight" testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
    });
  });

  describe("size variants", () => {
    it("renders with sm size", () => {
      render(<Badge count={5} size="sm" testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
    });

    it("renders with md size", () => {
      render(<Badge count={5} size="md" testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
    });

    it("renders with lg size", () => {
      render(<Badge count={5} size="lg" testID="badge" />);

      expect(screen.getByTestId("badge")).toBeTruthy();
    });
  });
});

//#endregion Rendering Tests
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- Badge
```
