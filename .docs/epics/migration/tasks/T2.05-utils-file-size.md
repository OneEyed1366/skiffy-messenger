# T2.05: File Size Utilities

## Metadata

| Field        | Value          |
| ------------ | -------------- |
| **ID**       | T2.05          |
| **Layer**    | L2 - Utilities |
| **Status**   | pending        |
| **Priority** | medium         |
| **Estimate** | 0.5h           |
| **Parallel** | true           |
| **Assignee** | -              |
| **Created**  | 2026-01-04     |
| **Updated**  | 2026-01-04     |

## Dependencies

| Task ID | Name           |
| ------- | -------------- |
| T1.04   | File Constants |

## Blocks

| Task ID | Name           |
| ------- | -------------- |
| T10b.10 | FileAttachment |

## Description

Migrate file size formatting utility from Mattermost. Converts bytes to human-readable strings (B, KB, MB, GB, TB).

## Source Files

- `vendor/desktop/webapp/channels/src/utils/utils.tsx` (lines 1105-1127)

## Target File

`apps/v2/src/utils/file.ts`

## Implementation

```typescript
// apps/v2/src/utils/file.ts

/**
 * File size formatting utilities
 * Migrated from: vendor/desktop/webapp/channels/src/utils/utils.tsx
 */

//#region Constants

const BYTES_PER_KB = 1024;
const BYTES_PER_MB = 1024 ** 2;
const BYTES_PER_GB = 1024 ** 3;
const BYTES_PER_TB = 1024 ** 4;

//#endregion

//#region File Size Formatting

/**
 * Converts a file size in bytes into a human-readable string.
 *
 * @param bytes - File size in bytes
 * @returns Human-readable string (e.g., '123MB', '1.5GB')
 *
 * @example
 * fileSizeToString(1024) // '1KB'
 * fileSizeToString(1536) // '2KB'
 * fileSizeToString(1048576) // '1MB'
 * fileSizeToString(5368709120) // '5GB'
 */
export function fileSizeToString(bytes: number): string {
  if (bytes > BYTES_PER_TB) {
    if (bytes < BYTES_PER_TB * 10) {
      return `${Math.round((bytes / BYTES_PER_TB) * 10) / 10}TB`;
    }
    return `${Math.round(bytes / BYTES_PER_TB)}TB`;
  }

  if (bytes > BYTES_PER_GB) {
    if (bytes < BYTES_PER_GB * 10) {
      return `${Math.round((bytes / BYTES_PER_GB) * 10) / 10}GB`;
    }
    return `${Math.round(bytes / BYTES_PER_GB)}GB`;
  }

  if (bytes > BYTES_PER_MB) {
    if (bytes < BYTES_PER_MB * 10) {
      return `${Math.round((bytes / BYTES_PER_MB) * 10) / 10}MB`;
    }
    return `${Math.round(bytes / BYTES_PER_MB)}MB`;
  }

  if (bytes > BYTES_PER_KB) {
    return `${Math.round(bytes / BYTES_PER_KB)}KB`;
  }

  return `${bytes}B`;
}

//#endregion
```

## Index Export

```typescript
// apps/v2/src/utils/index.ts

export { fileSizeToString } from "./file";
```

## Acceptance Criteria

- [ ] Function handles all size ranges: B, KB, MB, GB, TB
- [ ] Shows one decimal place for sizes < 10 (GB, MB, TB only)
- [ ] Uses named constants instead of magic numbers
- [ ] Exported from `utils/index.ts`
- [ ] No external dependencies
- [ ] TypeScript strict mode passes

## Testing

```typescript
// apps/v2/src/utils/file.spec.ts

import { fileSizeToString } from "./file";

describe("fileSizeToString", () => {
  it("formats bytes", () => {
    expect(fileSizeToString(0)).toBe("0B");
    expect(fileSizeToString(512)).toBe("512B");
    expect(fileSizeToString(1023)).toBe("1023B");
  });

  it("formats kilobytes", () => {
    expect(fileSizeToString(1024)).toBe("1KB");
    expect(fileSizeToString(1536)).toBe("2KB");
    expect(fileSizeToString(10240)).toBe("10KB");
  });

  it("formats megabytes", () => {
    expect(fileSizeToString(1048576)).toBe("1MB");
    expect(fileSizeToString(1572864)).toBe("1.5MB");
    expect(fileSizeToString(10485760)).toBe("10MB");
  });

  it("formats gigabytes", () => {
    expect(fileSizeToString(1073741824)).toBe("1GB");
    expect(fileSizeToString(1610612736)).toBe("1.5GB");
    expect(fileSizeToString(10737418240)).toBe("10GB");
  });

  it("formats terabytes", () => {
    expect(fileSizeToString(1099511627776)).toBe("1TB");
    expect(fileSizeToString(1649267441664)).toBe("1.5TB");
    expect(fileSizeToString(10995116277760)).toBe("10TB");
  });

  it("shows decimal for small values in MB/GB/TB", () => {
    expect(fileSizeToString(5242880)).toBe("5MB");
    expect(fileSizeToString(5368709120)).toBe("5GB");
    expect(fileSizeToString(5497558138880)).toBe("5TB");
  });
});
```

```bash
pnpm --filter @retrievly/app test:unit -- file.spec
```
