# T6.03: Loading Spinner Component

## Metadata

| Field        | Value                     |
| ------------ | ------------------------- |
| **ID**       | T6.03                     |
| **Layer**    | L6 - Primitive Components |
| **Status**   | pending                   |
| **Priority** | high                      |
| **Estimate** | 3h                        |
| **Parallel** | true                      |
| **Assignee** | -                         |
| **Created**  | 2026-01-04                |
| **Updated**  | 2026-01-04                |

## Dependencies

| Task ID | Name         |
| ------- | ------------ |
| T0.01   | types-common |

## Blocks

| Task ID | Name                           |
| ------- | ------------------------------ |
| T6.04   | component-loading-wrapper      |
| T10b.\* | Components with loading states |

## Description

Migrate loading spinner/indicator component from Mattermost web app. The original uses FontAwesome spinning icon with CSS animations. Replace with React Native's `ActivityIndicator` for native performance, plus a custom animated spinner for advanced styling needs.

## Source Files

- `vendor/desktop/webapp/channels/src/components/widgets/loading/loading_spinner.tsx` (lines 1-35)
- `vendor/desktop/webapp/channels/src/components/widgets/loading/loading_wrapper.tsx` (lines 1-24)
- `vendor/desktop/webapp/channels/src/components/loading_screen.tsx` (lines 1-40)

### Source Analysis

The original implementation uses:

- **FontAwesome**: `fa-spinner fa-pulse` for animated spinning icon
- **classNames**: For conditional `with-text` class when label present
- **react-intl**: For i18n text and accessibility labels
- **CSS**: For positioning, sizing, and overlay styles

Key components migrated:
| Original Component | Purpose |
|-------------------|---------|
| `LoadingSpinner` | Inline spinner with optional text label |
| `LoadingWrapper` | Conditional wrapper showing spinner or children |
| `LoadingScreen` | Fullscreen centered loading with message |

## Migration Target

- **Target File**: `apps/v2/src/components/LoadingSpinner/LoadingSpinner.tsx`
- **Index Export**: `apps/v2/src/components/LoadingSpinner/index.ts`

## Implementation

```typescript
// apps/v2/src/components/LoadingSpinner/LoadingSpinner.tsx

import { ActivityIndicator, View, Text } from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";
import { useTranslation } from "react-i18next";

//#region Types

type ISize = "small" | "medium" | "large";

type IColor = "primary" | "secondary" | "neutral" | "button";

type IProps = {
  /**
   * i18n key for optional label text displayed below spinner
   */
  labelKey?: string;
  /**
   * Whether to display as fullscreen overlay
   * @default false
   */
  fullscreen?: boolean;
  /**
   * Test ID for testing
   */
  testID?: string;
} & UnistylesVariants<typeof styles>;

//#endregion Types

//#region Constants

const SIZE_MAP: Record<ISize, number> = {
  small: 16,
  medium: 24,
  large: 40,
};

//#endregion Constants

//#region Component

export function LoadingSpinner({
  size = "medium",
  color = "primary",
  labelKey,
  fullscreen = false,
  testID = "loadingSpinner",
}: IProps) {
  const { t } = useTranslation();
  styles.useVariants({ size, color, fullscreen });

  const spinnerSize = SIZE_MAP[size ?? "medium"];
  const spinnerColor = getSpinnerColor(color ?? "primary");

  return (
    <View
      style={fullscreen ? styles.fullscreenContainer : styles.container}
      testID={testID}
      accessibilityRole="progressbar"
      accessibilityLabel={t("loadingSpinner.loading")}
    >
      <View style={styles.spinnerWrapper}>
        <ActivityIndicator
          size={spinnerSize}
          color={spinnerColor}
          testID={`${testID}-indicator`}
        />
      </View>
      {labelKey ? (
        <Text style={styles.label} testID={`${testID}-label`}>
          {t(labelKey)}
        </Text>
      ) : null}
    </View>
  );
}

//#endregion Component

//#region Helpers

function getSpinnerColor(colorVariant: IColor): string {
  // Colors are resolved at runtime from theme
  // This function returns the appropriate color key
  const colorMap: Record<IColor, string> = {
    primary: "#166de0", // theme.colors.primary
    secondary: "#1ff4ff", // theme.colors.secondary
    neutral: "#3f4350", // theme.colors.centerChannelColor
    button: "#ffffff", // theme.colors.buttonColor
  };
  return colorMap[colorVariant];
}

//#endregion Helpers

//#region Styles

const styles = StyleSheet.create((theme) => ({
  container: {
    flexDirection: "column",
    alignItems: "center",
    justifyContent: "center",
    padding: theme.gap(1),
  },

  fullscreenContainer: {
    position: "absolute",
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
    flexDirection: "column",
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: "rgba(0, 0, 0, 0.5)",
    zIndex: 1000,
  },

  spinnerWrapper: {
    alignItems: "center",
    justifyContent: "center",
    variants: {
      size: {
        small: {
          width: 20,
          height: 20,
        },
        medium: {
          width: 28,
          height: 28,
        },
        large: {
          width: 48,
          height: 48,
        },
      },
      fullscreen: {
        true: {
          backgroundColor: theme.colors.centerChannelBg,
          borderRadius: theme.radius.m,
          padding: theme.gap(2),
        },
        false: {},
      },
    },
  },

  label: {
    marginTop: theme.gap(1),
    fontSize: 14,
    fontFamily: theme.fonts.primary,
    fontWeight: theme.fontWeights.normal,
    textAlign: "center",
    variants: {
      color: {
        primary: {
          color: theme.colors.primary,
        },
        secondary: {
          color: theme.colors.secondary,
        },
        neutral: {
          color: theme.colors.centerChannelColor,
        },
        button: {
          color: theme.colors.buttonColor,
        },
      },
      fullscreen: {
        true: {
          color: theme.colors.centerChannelColor,
        },
        false: {},
      },
    },
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/LoadingSpinner/index.ts

export { LoadingSpinner } from "./LoadingSpinner";
```

## i18n Keys

Add to `apps/v2/src/locales/en.json`:

```json
{
  "loadingSpinner.loading": "Loading"
}
```

## Acceptance Criteria

- [ ] Uses React Native's `ActivityIndicator` for native spinner animation
- [ ] Supports 3 size variants: `small` (16px), `medium` (24px), `large` (40px)
- [ ] Supports 4 color variants: `primary`, `secondary`, `neutral`, `button`
- [ ] Optional label text via `labelKey` prop (i18n)
- [ ] Fullscreen overlay variant with semi-transparent backdrop
- [ ] Proper accessibility: `accessibilityRole="progressbar"`, `accessibilityLabel`
- [ ] All types use `I` prefix naming convention
- [ ] Uses Unistyles variants (not conditional styles)
- [ ] No `useMemo`/`useCallback` (React Compiler handles optimization)
- [ ] Named export from component file
- [ ] TypeScript strict mode passes
- [ ] No `any` types

## Testing

```typescript
// apps/v2/src/components/LoadingSpinner/LoadingSpinner.spec.tsx

import { render, screen } from "@testing-library/react-native";

import { LoadingSpinner } from "./LoadingSpinner";

//#region Rendering Tests

describe("<LoadingSpinner />", () => {
  it("renders spinner with default props", () => {
    render(<LoadingSpinner />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
    expect(screen.getByTestId("loadingSpinner-indicator")).toBeTruthy();
  });

  it("renders without label by default", () => {
    render(<LoadingSpinner />);

    expect(screen.queryByTestId("loadingSpinner-label")).toBeNull();
  });

  it("renders label when labelKey provided", () => {
    render(<LoadingSpinner labelKey="loadingSpinner.loading" />);

    expect(screen.getByTestId("loadingSpinner-label")).toBeTruthy();
    expect(screen.getByText("Loading")).toBeTruthy();
  });

  it("applies custom testID", () => {
    render(<LoadingSpinner testID="customSpinner" />);

    expect(screen.getByTestId("customSpinner")).toBeTruthy();
    expect(screen.getByTestId("customSpinner-indicator")).toBeTruthy();
  });
});

//#endregion Rendering Tests

//#region Size Variant Tests

describe("size variants", () => {
  it("renders small size", () => {
    render(<LoadingSpinner size="small" />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
  });

  it("renders medium size (default)", () => {
    render(<LoadingSpinner size="medium" />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
  });

  it("renders large size", () => {
    render(<LoadingSpinner size="large" />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
  });
});

//#endregion Size Variant Tests

//#region Color Variant Tests

describe("color variants", () => {
  it("renders primary color (default)", () => {
    render(<LoadingSpinner color="primary" />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
  });

  it("renders secondary color", () => {
    render(<LoadingSpinner color="secondary" />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
  });

  it("renders neutral color", () => {
    render(<LoadingSpinner color="neutral" />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
  });

  it("renders button color", () => {
    render(<LoadingSpinner color="button" />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
  });
});

//#endregion Color Variant Tests

//#region Fullscreen Variant Tests

describe("fullscreen variant", () => {
  it("renders inline by default", () => {
    render(<LoadingSpinner fullscreen={false} />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
  });

  it("renders fullscreen overlay when enabled", () => {
    render(<LoadingSpinner fullscreen={true} />);

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
  });

  it("renders fullscreen with label", () => {
    render(
      <LoadingSpinner fullscreen={true} labelKey="loadingSpinner.loading" />
    );

    expect(screen.getByTestId("loadingSpinner")).toBeTruthy();
    expect(screen.getByText("Loading")).toBeTruthy();
  });
});

//#endregion Fullscreen Variant Tests

//#region Accessibility Tests

describe("accessibility", () => {
  it("has progressbar role", () => {
    render(<LoadingSpinner />);

    const spinner = screen.getByTestId("loadingSpinner");
    expect(spinner.props.accessibilityRole).toBe("progressbar");
  });

  it("has accessibility label", () => {
    render(<LoadingSpinner />);

    const spinner = screen.getByTestId("loadingSpinner");
    expect(spinner.props.accessibilityLabel).toBe("Loading");
  });
});

//#endregion Accessibility Tests
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- LoadingSpinner
```

## Storybook

```typescript
// apps/v2/src/components/LoadingSpinner/LoadingSpinner.stories.tsx

import type { Meta, StoryObj } from "@storybook/react";
import { View } from "react-native";

import { LoadingSpinner } from "./LoadingSpinner";

const meta: Meta<typeof LoadingSpinner> = {
  title: "Components/LoadingSpinner",
  component: LoadingSpinner,
  argTypes: {
    size: {
      control: "select",
      options: ["small", "medium", "large"],
    },
    color: {
      control: "select",
      options: ["primary", "secondary", "neutral", "button"],
    },
    fullscreen: {
      control: "boolean",
    },
    labelKey: {
      control: "text",
    },
  },
  decorators: [
    (Story) => (
      <View style={{ padding: 20, minHeight: 100 }}>
        <Story />
      </View>
    ),
  ],
};

export default meta;

type IStory = StoryObj<typeof LoadingSpinner>;

export const Default: IStory = {
  args: {},
};

export const WithLabel: IStory = {
  args: {
    labelKey: "loadingSpinner.loading",
  },
};

export const Small: IStory = {
  args: {
    size: "small",
  },
};

export const Large: IStory = {
  args: {
    size: "large",
  },
};

export const Secondary: IStory = {
  args: {
    color: "secondary",
  },
};

export const Neutral: IStory = {
  args: {
    color: "neutral",
  },
};

export const Fullscreen: IStory = {
  args: {
    fullscreen: true,
    labelKey: "loadingSpinner.loading",
  },
};

export const AllSizes: IStory = {
  render: () => (
    <View style={{ flexDirection: "row", gap: 20, alignItems: "center" }}>
      <LoadingSpinner size="small" />
      <LoadingSpinner size="medium" />
      <LoadingSpinner size="large" />
    </View>
  ),
};

export const AllColors: IStory = {
  render: () => (
    <View style={{ flexDirection: "row", gap: 20, alignItems: "center" }}>
      <LoadingSpinner color="primary" />
      <LoadingSpinner color="secondary" />
      <LoadingSpinner color="neutral" />
    </View>
  ),
};
```
