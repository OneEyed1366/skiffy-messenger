# T7.51: State Provider

## Metadata

| Field        | Value                 |
| ------------ | --------------------- |
| **ID**       | T7.51                 |
| **Layer**    | L7 - State Management |
| **Status**   | pending               |
| **Priority** | high                  |
| **Estimate** | 2h                    |
| **Parallel** | false                 |
| **Assignee** | -                     |
| **Created**  | 2026-01-06            |
| **Updated**  | 2026-01-06            |

## Dependencies

| Task ID | Name                    |
| ------- | ----------------------- |
| T7.02   | query-client            |
| T7.50   | websocket-subscriptions |

## Blocks

| Task ID | Name      |
| ------- | --------- |
| -       | App entry |

## Description

Create the root provider component that wraps the app with QueryClientProvider and initializes WebSocket subscriptions.

**Reference:** See [State Management Architecture](../../../architecture/state-management.md#provider-setup) for full implementation.

## Target Files

- `apps/v2/src/providers/StateProvider.tsx`

## Implementation

```typescript
import { QueryClientProvider } from "@tanstack/react-query";
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";
import { useEffect, useRef } from "react";
import { Platform } from "react-native";
import { queryClient } from "@/queries/client";
import { initWebSocketSubscriptions } from "@/services/websocket/subscriptions";

type IProps = {
  children: React.ReactNode;
};

export function StateProvider({ children }: IProps) {
  const cleanupRef = useRef<(() => void) | null>(null);

  useEffect(() => {
    // Initialize WebSocket subscriptions
    cleanupRef.current = initWebSocketSubscriptions(queryClient);

    return () => {
      cleanupRef.current?.();
    };
  }, []);

  return (
    <QueryClientProvider client={queryClient}>
      {children}
      {Platform.OS === "web" && __DEV__ && (
        <ReactQueryDevtools initialIsOpen={false} />
      )}
    </QueryClientProvider>
  );
}
```

## Usage in App

```typescript
// app/_layout.tsx
import { StateProvider } from "@/providers/StateProvider";

export default function RootLayout() {
  return (
    <StateProvider>
      <Stack />
    </StateProvider>
  );
}
```

## Acceptance Criteria

- [ ] QueryClientProvider wraps children
- [ ] WebSocket subscriptions initialized on mount
- [ ] Cleanup on unmount
- [ ] ReactQueryDevtools in dev mode (web only)
- [ ] TypeScript strict mode passes
