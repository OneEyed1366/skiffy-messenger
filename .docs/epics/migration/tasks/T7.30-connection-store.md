# T7.30: Connection Store

## Metadata

| Field        | Value                 |
| ------------ | --------------------- |
| **ID**       | T7.30                 |
| **Layer**    | L7 - State Management |
| **Status**   | pending               |
| **Priority** | high                  |
| **Estimate** | 1h                    |
| **Parallel** | true                  |
| **Assignee** | -                     |
| **Created**  | 2026-01-06            |
| **Updated**  | 2026-01-06            |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T7.04   | store-setup |

## Blocks

| Task ID | Name              |
| ------- | ----------------- |
| T8.01   | websocket-service |

## Description

Create a Zustand store to track WebSocket connection status, error counts, and reconnection state.

**Reference:** See [State Management Architecture](../../../architecture/state-management.md#connection-store) for full implementation.

## Target Files

- `apps/v2/src/stores/connection/useConnectionStore.ts`
- `apps/v2/src/stores/connection/index.ts`

## State Shape

```typescript
type IConnectionStatus =
  | "connected"
  | "connecting"
  | "disconnected"
  | "reconnecting";

type IConnectionState = {
  status: IConnectionStatus;
  errorCount: number;
  lastConnectedAt: number | null;
  lastDisconnectedAt: number | null;
};

type IConnectionActions = {
  setStatus: (status: IConnectionStatus) => void;
  incrementErrorCount: () => void;
  resetErrorCount: () => void;
  reset: () => void;
};
```

## Selector Hooks

```typescript
export const useIsConnected = () =>
  useConnectionStore((s) => s.status === "connected");
export const useIsReconnecting = () =>
  useConnectionStore((s) => s.status === "reconnecting");
export const useConnectionStatus = () => useConnectionStore((s) => s.status);
```

## Acceptance Criteria

- [ ] Connection status tracking (4 states)
- [ ] Error count with increment/reset
- [ ] Timestamp tracking for connect/disconnect
- [ ] Selector hooks for common queries
- [ ] DevTools integration via `createStore()`
