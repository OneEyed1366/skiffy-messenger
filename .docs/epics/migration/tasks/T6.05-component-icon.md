# T6.05: Icon Wrapper Component

## Metadata

| Field        | Value              |
| ------------ | ------------------ |
| **ID**       | T6.05              |
| **Layer**    | L6 - UI Components |
| **Status**   | pending            |
| **Priority** | high               |
| **Estimate** | 2h                 |
| **Parallel** | true               |
| **Assignee** | -                  |
| **Created**  | 2026-01-04         |
| **Updated**  | 2026-01-04         |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T0.01   | types-theme |

## Blocks

| Task ID | Name                      |
| ------- | ------------------------- |
| T6.\*   | All icon-using components |
| T10b.\* | Complex UI with icons     |

## Description

Create a unified Icon wrapper component that provides consistent sizing, theming, and accessibility for icons across the app. The original Mattermost codebase uses inline SVG icons wrapped in `<span>` elements with `react-intl` for accessibility. Migrate to use `@expo/vector-icons` with a wrapper that provides:

- Consistent sizing via variants (sm, md, lg)
- Theme-aware colors with override capability
- Accessibility labels via i18next

## Source Files

- `vendor/desktop/webapp/channels/src/components/widgets/icons/*.tsx`

### Source Analysis

The original implementation uses:

- **Inline SVG**: Each icon is a separate component with hardcoded SVG paths
- **react-intl**: For accessibility labels via `formatMessage()`
- **Span wrapper**: Icons wrapped in `<span>` with spread props
- **Variable sizing**: Some icons use fixed px (24px, 16px), others use 100%

Key patterns observed:
| Pattern | Example |
|---------|---------|
| Fixed size | `width='24px' height='24px'` |
| Fluid size | `width='100%' height='100%'` |
| Accessibility | `aria-label={formatMessage({id: '...'})}` |
| Role | `role='img'` |

## Migration Target

- **Target File**: `apps/v2/src/components/Icon/Icon.tsx`
- **Index Export**: `apps/v2/src/components/Icon/index.ts`

## Implementation

```typescript
// apps/v2/src/components/Icon/Icon.tsx

/**
 * Icon wrapper component
 * Migrated from: vendor/desktop/webapp/channels/src/components/widgets/icons/
 *
 * Provides consistent sizing, theming, and accessibility for icons.
 * Uses @expo/vector-icons for icon rendering with Unistyles for theming.
 */

import { MaterialCommunityIcons, Ionicons, FontAwesome } from "@expo/vector-icons";
import { View } from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";

//#region Types

type IIconFamily = "material" | "ionicons" | "fontawesome";

type IMaterialIconName = keyof typeof MaterialCommunityIcons.glyphMap;
type IIoniconsIconName = keyof typeof Ionicons.glyphMap;
type IFontAwesomeIconName = keyof typeof FontAwesome.glyphMap;

type IIconName = IMaterialIconName | IIoniconsIconName | IFontAwesomeIconName;

type IIconSize = "sm" | "md" | "lg";

type IProps = {
  /**
   * Icon name from the selected icon family
   */
  name: IIconName;
  /**
   * Icon family to use
   * @default "material"
   */
  family?: IIconFamily;
  /**
   * Custom color override (theme color key or hex/rgb value)
   */
  color?: string;
  /**
   * Accessibility label for screen readers
   */
  accessibilityLabel?: string;
  /**
   * Whether to hide from accessibility tree (decorative icons)
   * @default false
   */
  accessibilityHidden?: boolean;
  /**
   * Test ID for testing
   */
  testID?: string;
  /**
   * Ref to the container View
   */
  ref?: React.Ref<React.ComponentRef<typeof View>>;
} & UnistylesVariants<typeof styles>;

//#endregion Types

//#region Constants

const SIZE_MAP: Record<IIconSize, number> = {
  sm: 16,
  md: 24,
  lg: 32,
};

//#endregion Constants

//#region Component

export function Icon({
  name,
  family = "material",
  color,
  size = "md",
  accessibilityLabel,
  accessibilityHidden = false,
  testID,
  ref,
}: IProps) {
  styles.useVariants({ size });

  const iconSize = SIZE_MAP[size ?? "md"];

  const IconComponent = getIconComponent(family);
  const iconColor = color ?? styles.icon.color;

  return (
    <View
      ref={ref}
      style={styles.container}
      accessible={!accessibilityHidden}
      accessibilityRole="image"
      accessibilityLabel={accessibilityLabel}
      testID={testID}
    >
      <IconComponent
        name={name as never}
        size={iconSize}
        color={iconColor}
      />
    </View>
  );
}

//#endregion Component

//#region Helpers

function getIconComponent(family: IIconFamily) {
  switch (family) {
    case "ionicons":
      return Ionicons;
    case "fontawesome":
      return FontAwesome;
    case "material":
    default:
      return MaterialCommunityIcons;
  }
}

//#endregion Helpers

//#region Styles

const styles = StyleSheet.create((theme) => ({
  container: {
    alignItems: "center",
    justifyContent: "center",
    variants: {
      size: {
        sm: {
          width: SIZE_MAP.sm,
          height: SIZE_MAP.sm,
        },
        md: {
          width: SIZE_MAP.md,
          height: SIZE_MAP.md,
        },
        lg: {
          width: SIZE_MAP.lg,
          height: SIZE_MAP.lg,
        },
      },
    },
  },
  icon: {
    color: theme.colors.centerChannelColor,
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/Icon/index.ts

export { Icon } from "./Icon";
```

## Acceptance Criteria

- [ ] Uses `@expo/vector-icons` for icon rendering
- [ ] Supports 3 size variants: sm (16px), md (24px), lg (32px)
- [ ] Default color from theme (`centerChannelColor`)
- [ ] Custom color override via `color` prop
- [ ] Accessibility label via `accessibilityLabel` prop
- [ ] `accessibilityHidden` for decorative icons
- [ ] `accessibilityRole="image"` for proper screen reader handling
- [ ] Supports 3 icon families: material, ionicons, fontawesome
- [ ] All types use `I` prefix naming convention
- [ ] Uses Unistyles variants for sizing
- [ ] Named export from `Icon/index.ts`
- [ ] TypeScript strict mode passes
- [ ] No `any` types

## Testing

```typescript
// apps/v2/src/components/Icon/Icon.spec.tsx

import { render } from "@testing-library/react-native";

import { Icon } from "./Icon";

//#region Rendering Tests

describe("<Icon />", () => {
  it("renders with default props", () => {
    const { getByTestId } = render(
      <Icon name="close" testID="icon" />,
    );

    expect(getByTestId("icon")).toBeTruthy();
  });

  it("renders with accessibility label", () => {
    const { getByLabelText } = render(
      <Icon name="close" accessibilityLabel="Close button" />,
    );

    expect(getByLabelText("Close button")).toBeTruthy();
  });

  it("hides from accessibility when accessibilityHidden is true", () => {
    const { getByTestId } = render(
      <Icon name="close" accessibilityHidden testID="icon" />,
    );

    const icon = getByTestId("icon");
    expect(icon.props.accessible).toBe(false);
  });

  it("has accessibilityRole of image", () => {
    const { getByTestId } = render(
      <Icon name="close" testID="icon" />,
    );

    const icon = getByTestId("icon");
    expect(icon.props.accessibilityRole).toBe("image");
  });
});

//#endregion Rendering Tests

//#region Size Variant Tests

describe("Icon size variants", () => {
  it("renders sm size (16px)", () => {
    const { getByTestId } = render(
      <Icon name="close" size="sm" testID="icon" />,
    );

    const icon = getByTestId("icon");
    expect(icon.props.style).toMatchObject({
      width: 16,
      height: 16,
    });
  });

  it("renders md size (24px) by default", () => {
    const { getByTestId } = render(
      <Icon name="close" testID="icon" />,
    );

    const icon = getByTestId("icon");
    expect(icon.props.style).toMatchObject({
      width: 24,
      height: 24,
    });
  });

  it("renders lg size (32px)", () => {
    const { getByTestId } = render(
      <Icon name="close" size="lg" testID="icon" />,
    );

    const icon = getByTestId("icon");
    expect(icon.props.style).toMatchObject({
      width: 32,
      height: 32,
    });
  });
});

//#endregion Size Variant Tests

//#region Icon Family Tests

describe("Icon families", () => {
  it("renders material icon by default", () => {
    const { getByTestId } = render(
      <Icon name="close" testID="icon" />,
    );

    expect(getByTestId("icon")).toBeTruthy();
  });

  it("renders ionicons icon", () => {
    const { getByTestId } = render(
      <Icon name="close" family="ionicons" testID="icon" />,
    );

    expect(getByTestId("icon")).toBeTruthy();
  });

  it("renders fontawesome icon", () => {
    const { getByTestId } = render(
      <Icon name="close" family="fontawesome" testID="icon" />,
    );

    expect(getByTestId("icon")).toBeTruthy();
  });
});

//#endregion Icon Family Tests

//#region Color Tests

describe("Icon colors", () => {
  it("applies custom color", () => {
    const { getByTestId } = render(
      <Icon name="close" color="#ff0000" testID="icon" />,
    );

    expect(getByTestId("icon")).toBeTruthy();
  });
});

//#endregion Color Tests
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- Icon
```

## Usage Examples

```typescript
import { Icon } from "@/components/Icon";
import { useTranslation } from "react-i18next";

// Basic usage
<Icon name="close" />

// With accessibility label
const { t } = useTranslation();
<Icon
  name="close"
  accessibilityLabel={t("generic_icons.close")}
/>

// Different sizes
<Icon name="search" size="sm" />
<Icon name="search" size="md" />
<Icon name="search" size="lg" />

// Custom color
<Icon name="check-circle" color="#3db887" />

// Different icon families
<Icon name="close" family="material" />
<Icon name="close" family="ionicons" />
<Icon name="times" family="fontawesome" />

// Decorative icon (hidden from accessibility)
<Icon name="chevron-right" accessibilityHidden />
```

## Icon Mapping Reference

Common icons from Mattermost source â†’ @expo/vector-icons equivalent:

| Original Icon       | Material Community            | Ionicons         |
| ------------------- | ----------------------------- | ---------------- |
| close_icon          | close                         | close            |
| search_icon         | magnify                       | search           |
| menu_icon           | menu                          | menu             |
| back_icon           | arrow-left                    | arrow-back       |
| check_mark_icon     | check                         | checkmark        |
| info_icon           | information                   | information      |
| alert_icon          | alert                         | alert            |
| pin_icon            | pin                           | pin              |
| reply_icon          | reply                         | return-up-back   |
| emoji_icon          | emoticon-outline              | happy-outline    |
| attachment_icon     | attachment                    | attach           |
| status_online_icon  | check-circle                  | checkmark-circle |
| status_away_icon    | clock-outline                 | time-outline     |
| status_dnd_icon     | minus-circle                  | remove-circle    |
| status_offline_icon | checkbox-blank-circle-outline | ellipse-outline  |
