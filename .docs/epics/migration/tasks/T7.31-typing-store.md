# T7.31: Typing Store

## Metadata

| Field        | Value                 |
| ------------ | --------------------- |
| **ID**       | T7.31                 |
| **Layer**    | L7 - State Management |
| **Status**   | pending               |
| **Priority** | high                  |
| **Estimate** | 2h                    |
| **Parallel** | true                  |
| **Assignee** | -                     |
| **Created**  | 2026-01-06            |
| **Updated**  | 2026-01-06            |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T7.04   | store-setup |

## Blocks

| Task ID | Name             |
| ------- | ---------------- |
| T9.14   | useTypingUsers   |
| T7.50   | WS Subscriptions |

## Description

Create a Zustand store to track typing indicators per channel. Updated via RxJS WebSocket stream.

**Reference:** See [State Management Architecture](../../../architecture/state-management.md#typing-store) for full implementation.

## Target Files

- `apps/v2/src/stores/typing/useTypingStore.ts`
- `apps/v2/src/stores/typing/index.ts`

## State Shape

```typescript
type ITypingUser = {
  userId: string;
  username: string;
  timestamp: number;
};

type ITypingState = {
  typing: Record<string, ITypingUser[]>; // channelId -> users
};

type ITypingActions = {
  setTyping: (channelId: string, user: ITypingUser, isTyping: boolean) => void;
  clearChannel: (channelId: string) => void;
  clearExpired: () => void;
  reset: () => void;
};
```

## Key Behavior

- **Add user**: When `isTyping=true`, add/update user in channel list
- **Remove user**: When `isTyping=false`, remove user from channel list
- **Expire**: `clearExpired()` removes entries older than 5 seconds
- **RxJS integration**: Updated from `typing$` stream via `getState().setTyping()`

## Selector Hooks

```typescript
export const useTypingUsers = (channelId: string) =>
  useTypingStore((s) => s.typing[channelId] || []);

export const useIsAnyoneTyping = (channelId: string) =>
  useTypingStore((s) => (s.typing[channelId]?.length || 0) > 0);
```

## Acceptance Criteria

- [ ] Per-channel typing user tracking
- [ ] Add/remove/update typing users
- [ ] Expiration cleanup (5 second timeout)
- [ ] Selector hooks for components
- [ ] Works with RxJS `getState()` pattern
