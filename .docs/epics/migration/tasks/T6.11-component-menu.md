# T6.11: Menu Component

## Metadata

| Field        | Value              |
| ------------ | ------------------ |
| **ID**       | T6.11              |
| **Layer**    | L6 - UI Components |
| **Status**   | pending            |
| **Priority** | high               |
| **Estimate** | 6h                 |
| **Parallel** | true               |
| **Assignee** | -                  |
| **Created**  | 2026-01-04         |
| **Updated**  | 2026-01-04         |

## Dependencies

| Task ID | Name             |
| ------- | ---------------- |
| T0.01   | types-common     |
| T6.06   | component-button |

## Blocks

| Task ID | Name                        |
| ------- | --------------------------- |
| T6.12   | component-context-menu      |
| T7.\*   | Channel/thread action menus |
| T10b.\* | Form select dropdowns       |

## Description

Migrate the Menu/Dropdown component from Mattermost. The original uses a combination of `MenuWrapper` (click handler + open state), `Menu` (dropdown container), and various `MenuItem*` components. The newer implementation uses MUI Popover with custom styling. This migration implements a fully typed React Native menu system with Unistyles, keyboard navigation for desktop, and outside-tap dismiss.

## Source Files

- `vendor/desktop/webapp/channels/src/components/menu/menu.tsx` (lines 1-365) - New MUI-based menu
- `vendor/desktop/webapp/channels/src/components/menu/menu_item.tsx` (lines 1-354)
- `vendor/desktop/webapp/channels/src/components/menu/menu_item_separator.tsx` (lines 1-25)
- `vendor/desktop/webapp/channels/src/components/widgets/menu/menu.tsx` (lines 1-153) - Legacy menu
- `vendor/desktop/webapp/channels/src/components/widgets/menu/menu_wrapper.tsx` (lines 1-165)
- `vendor/desktop/webapp/channels/src/components/widgets/menu/menu_group.tsx` (lines 1-39)
- `vendor/desktop/webapp/channels/src/components/widgets/menu/menu_header.tsx` (lines 1-28)
- `vendor/desktop/webapp/channels/src/components/widgets/menu/menu_items/menu_item_action.tsx` (lines 1-59)

### Source Analysis

The original implementation uses:

- **MenuWrapper**: Class component managing open/close state via click handlers
- **Menu**: Container with `<ul role="menu">` and divider management
- **MenuItem**: HOC pattern wrapping action components with `<li role="menuitem">`
- **MUI Popover**: Newer implementation uses Material UI for positioning and animations
- **Event handling**: Click outside to close, Escape key, Tab key navigation
- **Mobile view**: Falls back to modal on mobile

Key patterns migrated:
| Original Pattern | Purpose |
|------------------|---------|
| `MenuWrapper` | Toggle open/close, click-outside detection |
| `Menu` with `dropdown-menu` class | Positioned dropdown container |
| `MenuItem` with icon/text slots | Individual menu actions |
| `MenuGroup` with divider | Grouped menu sections |
| `MenuHeader` | Non-interactive section headers |
| `isDestructive` prop | Red/danger styling for destructive actions |
| Keyboard navigation | Arrow keys, Enter/Space to select, Escape to close |

## Migration Target

- **Target Files**:
  - `apps/v2/src/components/Menu/Menu.tsx`
  - `apps/v2/src/components/Menu/MenuItem.tsx`
  - `apps/v2/src/components/Menu/MenuDivider.tsx`
  - `apps/v2/src/components/Menu/MenuHeader.tsx`
  - `apps/v2/src/components/Menu/index.ts`

## Implementation

```typescript
// apps/v2/src/components/Menu/Menu.tsx

import { useEffect, useRef } from "react";
import {
  Modal,
  Pressable,
  ScrollView,
  View,
  Platform,
} from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";

//#region Types

type IMenuPosition = "bottom-left" | "bottom-right" | "top-left" | "top-right";

type IProps = {
  /**
   * Trigger element that opens the menu
   */
  trigger: React.ReactNode;
  /**
   * Menu content (MenuItem, MenuDivider, MenuHeader components)
   */
  children: React.ReactNode;
  /**
   * Controlled open state
   */
  open?: boolean;
  /**
   * Callback when menu open state changes
   */
  onOpenChange?: (open: boolean) => void;
  /**
   * Menu position relative to trigger
   * @default "bottom-left"
   */
  position?: IMenuPosition;
  /**
   * Disable the menu trigger
   * @default false
   */
  disabled?: boolean;
  /**
   * Close menu when an item is selected
   * @default true
   */
  closeOnSelect?: boolean;
  /**
   * Test ID for testing
   */
  testID?: string;
  /**
   * Accessibility label for the menu
   */
  accessibilityLabel?: string;
} & UnistylesVariants<typeof styles>;

//#endregion Types

//#region Component

export function Menu({
  trigger,
  children,
  open: controlledOpen,
  onOpenChange,
  position = "bottom-left",
  disabled = false,
  closeOnSelect = true,
  testID,
  accessibilityLabel,
}: IProps) {
  const [internalOpen, setInternalOpen] = useState(false);
  const triggerRef = useRef<View>(null);
  const [triggerLayout, setTriggerLayout] = useState({ x: 0, y: 0, width: 0, height: 0 });

  const isOpen = controlledOpen ?? internalOpen;

  const handleOpen = () => {
    if (disabled) return;

    triggerRef.current?.measureInWindow((x, y, width, height) => {
      setTriggerLayout({ x, y, width, height });
    });

    const newOpen = !isOpen;
    setInternalOpen(newOpen);
    onOpenChange?.(newOpen);
  };

  const handleClose = () => {
    setInternalOpen(false);
    onOpenChange?.(false);
  };

  const handleItemSelect = () => {
    if (closeOnSelect) {
      handleClose();
    }
  };

  // Handle escape key on desktop
  useEffect(() => {
    if (Platform.OS !== "web" || !isOpen) return;

    const handleKeyDown = (event: KeyboardEvent) => {
      if (event.key === "Escape") {
        handleClose();
      }
    };

    document.addEventListener("keydown", handleKeyDown);
    return () => document.removeEventListener("keydown", handleKeyDown);
  }, [isOpen]);

  styles.useVariants({ position });

  const menuPosition = getMenuPosition(position, triggerLayout);

  return (
    <>
      <Pressable
        ref={triggerRef}
        onPress={handleOpen}
        disabled={disabled}
        accessibilityRole="button"
        accessibilityState={{ expanded: isOpen }}
        accessibilityLabel={accessibilityLabel}
        testID={testID}
      >
        {trigger}
      </Pressable>

      <Modal
        visible={isOpen}
        transparent
        animationType="fade"
        onRequestClose={handleClose}
        statusBarTranslucent
      >
        <Pressable style={styles.backdrop} onPress={handleClose}>
          <View
            style={[styles.menuContainer, menuPosition]}
            onStartShouldSetResponder={() => true}
          >
            <MenuContext.Provider value={{ onItemSelect: handleItemSelect }}>
              <ScrollView
                style={styles.menuContent}
                bounces={false}
                showsVerticalScrollIndicator={false}
              >
                {children}
              </ScrollView>
            </MenuContext.Provider>
          </View>
        </Pressable>
      </Modal>
    </>
  );
}

//#endregion Component

//#region Context

import { createContext, useContext, useState } from "react";

type IMenuContext = {
  onItemSelect: () => void;
};

const MenuContext = createContext<IMenuContext>({
  onItemSelect: () => {},
});

export const useMenuContext = () => useContext(MenuContext);

//#endregion Context

//#region Helpers

function getMenuPosition(
  position: IMenuPosition,
  layout: { x: number; y: number; width: number; height: number }
) {
  const { x, y, width, height } = layout;

  switch (position) {
    case "bottom-left":
      return { top: y + height, left: x };
    case "bottom-right":
      return { top: y + height, right: undefined, left: x + width };
    case "top-left":
      return { bottom: undefined, top: y, left: x };
    case "top-right":
      return { bottom: undefined, top: y, left: x + width };
    default:
      return { top: y + height, left: x };
  }
}

//#endregion Helpers

//#region Styles

const styles = StyleSheet.create((theme) => ({
  backdrop: {
    flex: 1,
    backgroundColor: "transparent",
  },

  menuContainer: {
    position: "absolute",
    minWidth: 200,
    maxWidth: 320,
    maxHeight: 400,
    backgroundColor: theme.colors.centerChannelBg,
    borderRadius: theme.radius.m,
    shadowColor: "#000",
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.15,
    shadowRadius: 12,
    elevation: 8,
    borderWidth: 1,
    borderColor: `${theme.colors.centerChannelColor}14`, // 8% opacity
    overflow: "hidden",
  },

  menuContent: {
    paddingVertical: theme.gap(1), // 8px
  },
}));

//#endregion Styles
```

```typescript
// apps/v2/src/components/Menu/MenuItem.tsx

import { Pressable, Text, View } from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";
import { useTranslation } from "react-i18next";
import { useMenuContext } from "./Menu";

//#region Types

type IProps = {
  /**
   * i18n translation key for item label
   */
  labelKey?: string;
  /**
   * Direct text label (use labelKey for i18n)
   */
  label?: string;
  /**
   * Secondary description text
   */
  descriptionKey?: string;
  /**
   * Direct description text
   */
  description?: string;
  /**
   * Icon component to render on the left
   */
  leadingIcon?: React.ReactNode;
  /**
   * Element to render on the right (icon, badge, shortcut)
   */
  trailingElement?: React.ReactNode;
  /**
   * Press handler
   */
  onPress?: () => void;
  /**
   * Mark as destructive action (red styling)
   * @default false
   */
  destructive?: boolean;
  /**
   * Disabled state
   * @default false
   */
  disabled?: boolean;
  /**
   * Prevent menu from closing when this item is selected
   * @default false
   */
  keepOpen?: boolean;
  /**
   * Ref to the underlying Pressable
   */
  ref?: React.Ref<React.ComponentRef<typeof Pressable>>;
  /**
   * Test ID for testing
   */
  testID?: string;
} & UnistylesVariants<typeof styles>;

//#endregion Types

//#region Component

export function MenuItem({
  labelKey,
  label,
  descriptionKey,
  description,
  leadingIcon,
  trailingElement,
  onPress,
  destructive = false,
  disabled = false,
  keepOpen = false,
  ref,
  testID,
}: IProps) {
  const { t } = useTranslation();
  const { onItemSelect } = useMenuContext();

  const displayLabel = labelKey ? t(labelKey) : label;
  const displayDescription = descriptionKey ? t(descriptionKey) : description;

  styles.useVariants({
    destructive,
    disabled,
  });

  const handlePress = () => {
    if (disabled) return;

    onPress?.();

    if (!keepOpen) {
      onItemSelect();
    }
  };

  return (
    <Pressable
      ref={ref}
      style={({ pressed }) => [
        styles.container,
        pressed && !disabled && styles.containerPressed,
      ]}
      onPress={handlePress}
      disabled={disabled}
      accessibilityRole="menuitem"
      accessibilityState={{ disabled }}
      testID={testID}
    >
      {leadingIcon && <View style={styles.leadingIcon}>{leadingIcon}</View>}

      <View style={styles.labelContainer}>
        {displayLabel && (
          <Text style={styles.label} numberOfLines={1}>
            {displayLabel}
          </Text>
        )}
        {displayDescription && (
          <Text style={styles.description} numberOfLines={2}>
            {displayDescription}
          </Text>
        )}
      </View>

      {trailingElement && (
        <View style={styles.trailingElement}>{trailingElement}</View>
      )}
    </Pressable>
  );
}

//#endregion Component

//#region Styles

const styles = StyleSheet.create((theme) => ({
  container: {
    flexDirection: "row",
    alignItems: "center",
    paddingVertical: theme.gap(1), // 8px
    paddingHorizontal: theme.gap(2.5), // 20px
    minHeight: 36,
    variants: {
      destructive: {
        true: {},
        false: {},
      },
      disabled: {
        true: {
          opacity: 0.32,
        },
        false: {
          opacity: 1,
        },
      },
    },
  },

  containerPressed: {
    backgroundColor: `${theme.colors.centerChannelColor}14`, // 8% opacity
    variants: {
      destructive: {
        true: {
          backgroundColor: theme.colors.errorText,
        },
        false: {},
      },
    },
  },

  leadingIcon: {
    width: 18,
    height: 18,
    marginRight: theme.gap(1.25), // 10px
    alignItems: "center",
    justifyContent: "center",
    variants: {
      destructive: {
        true: {
          color: theme.colors.errorText,
        },
        false: {
          color: `${theme.colors.centerChannelColor}A3`, // 64% opacity
        },
      },
    },
  },

  labelContainer: {
    flex: 1,
    gap: theme.gap(0.5), // 4px
  },

  label: {
    fontFamily: theme.fonts.primary,
    fontSize: 14,
    fontWeight: theme.fontWeights.regular,
    lineHeight: 16,
    variants: {
      destructive: {
        true: {
          color: theme.colors.errorText,
        },
        false: {
          color: theme.colors.centerChannelColor,
        },
      },
    },
  },

  description: {
    fontFamily: theme.fonts.primary,
    fontSize: 12,
    fontWeight: theme.fontWeights.regular,
    lineHeight: 16,
    variants: {
      destructive: {
        true: {
          color: theme.colors.errorText,
        },
        false: {
          color: `${theme.colors.centerChannelColor}BF`, // 75% opacity
        },
      },
    },
  },

  trailingElement: {
    flexDirection: "row",
    alignItems: "center",
    marginLeft: theme.gap(3), // 24px
    gap: theme.gap(0.5), // 4px
    variants: {
      destructive: {
        true: {
          color: theme.colors.errorText,
        },
        false: {
          color: `${theme.colors.centerChannelColor}BF`, // 75% opacity
        },
      },
    },
  },
}));

//#endregion Styles
```

```typescript
// apps/v2/src/components/Menu/MenuDivider.tsx

import { View } from "react-native";
import { StyleSheet } from "react-native-unistyles";

//#region Types

type IProps = {
  /**
   * Test ID for testing
   */
  testID?: string;
};

//#endregion Types

//#region Component

export function MenuDivider({ testID }: IProps) {
  return (
    <View
      style={styles.divider}
      accessibilityRole="separator"
      testID={testID}
    />
  );
}

//#endregion Component

//#region Styles

const styles = StyleSheet.create((theme) => ({
  divider: {
    height: 1,
    backgroundColor: `${theme.colors.centerChannelColor}14`, // 8% opacity
    marginVertical: theme.gap(1), // 8px
    marginHorizontal: theme.gap(2.5), // 20px
  },
}));

//#endregion Styles
```

```typescript
// apps/v2/src/components/Menu/MenuHeader.tsx

import { Text, View } from "react-native";
import { StyleSheet } from "react-native-unistyles";
import { useTranslation } from "react-i18next";

//#region Types

type IProps = {
  /**
   * i18n translation key for header text
   */
  titleKey?: string;
  /**
   * Direct header text (use titleKey for i18n)
   */
  title?: string;
  /**
   * Test ID for testing
   */
  testID?: string;
};

//#endregion Types

//#region Component

export function MenuHeader({ titleKey, title, testID }: IProps) {
  const { t } = useTranslation();
  const displayTitle = titleKey ? t(titleKey) : title;

  return (
    <View style={styles.container} testID={testID}>
      <Text style={styles.title} numberOfLines={1}>
        {displayTitle}
      </Text>
    </View>
  );
}

//#endregion Component

//#region Styles

const styles = StyleSheet.create((theme) => ({
  container: {
    paddingVertical: theme.gap(1), // 8px
    paddingHorizontal: theme.gap(2.5), // 20px
  },

  title: {
    fontFamily: theme.fonts.primary,
    fontSize: 12,
    fontWeight: theme.fontWeights.semiBold,
    lineHeight: 16,
    color: `${theme.colors.centerChannelColor}A3`, // 64% opacity
    textTransform: "uppercase",
    letterSpacing: 0.5,
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/Menu/index.ts

export { Menu, useMenuContext } from "./Menu";
export { MenuItem } from "./MenuItem";
export { MenuDivider } from "./MenuDivider";
export { MenuHeader } from "./MenuHeader";
```

## Acceptance Criteria

- [ ] Menu component with trigger element and content
- [ ] MenuItem with label, description, leading icon, trailing element
- [ ] MenuDivider for visual separation between groups
- [ ] MenuHeader for section titles
- [ ] Dismiss on outside tap (backdrop press)
- [ ] Dismiss on Escape key (desktop/web)
- [ ] Controlled and uncontrolled open state
- [ ] Position variants: bottom-left, bottom-right, top-left, top-right
- [ ] Destructive variant for danger actions (red styling)
- [ ] Disabled state for items and trigger
- [ ] `keepOpen` prop to prevent auto-close on item select
- [ ] Uses i18n translation keys for text
- [ ] All types use `I` prefix naming convention
- [ ] No `forwardRef` (React 19 ref prop)
- [ ] No `useCallback`/`useMemo` (React Compiler)
- [ ] Uses Unistyles variants (not conditional styles)
- [ ] TypeScript strict mode passes
- [ ] No `any` types

## Testing

```typescript
// apps/v2/src/components/Menu/Menu.spec.tsx

import { render, fireEvent, waitFor } from "@testing-library/react-native";
import { Menu } from "./Menu";
import { MenuItem } from "./MenuItem";
import { MenuDivider } from "./MenuDivider";
import { MenuHeader } from "./MenuHeader";
import { Text } from "react-native";

//#region Menu Tests

describe("<Menu />", () => {
  describe("rendering", () => {
    it("renders trigger element", () => {
      const { getByText } = render(
        <Menu trigger={<Text>Open Menu</Text>}>
          <MenuItem label="Item 1" />
        </Menu>
      );
      expect(getByText("Open Menu")).toBeTruthy();
    });

    it("does not show menu content initially", () => {
      const { queryByText } = render(
        <Menu trigger={<Text>Open Menu</Text>}>
          <MenuItem label="Item 1" />
        </Menu>
      );
      expect(queryByText("Item 1")).toBeNull();
    });

    it("renders with testID", () => {
      const { getByTestId } = render(
        <Menu trigger={<Text>Open</Text>} testID="test-menu">
          <MenuItem label="Item" />
        </Menu>
      );
      expect(getByTestId("test-menu")).toBeTruthy();
    });
  });

  describe("interactions", () => {
    it("opens menu when trigger is pressed", async () => {
      const { getByText } = render(
        <Menu trigger={<Text>Open Menu</Text>}>
          <MenuItem label="Item 1" />
        </Menu>
      );

      fireEvent.press(getByText("Open Menu"));

      await waitFor(() => {
        expect(getByText("Item 1")).toBeTruthy();
      });
    });

    it("closes menu when backdrop is pressed", async () => {
      const { getByText, queryByText, getByTestId } = render(
        <Menu trigger={<Text>Open Menu</Text>} testID="menu">
          <MenuItem label="Item 1" />
        </Menu>
      );

      fireEvent.press(getByText("Open Menu"));
      await waitFor(() => expect(getByText("Item 1")).toBeTruthy());

      // Press backdrop (Modal's onRequestClose)
      // Note: Testing backdrop press requires Modal mock
    });

    it("does not open when disabled", () => {
      const { getByText, queryByText } = render(
        <Menu trigger={<Text>Open Menu</Text>} disabled>
          <MenuItem label="Item 1" />
        </Menu>
      );

      fireEvent.press(getByText("Open Menu"));
      expect(queryByText("Item 1")).toBeNull();
    });

    it("calls onOpenChange when opened", async () => {
      const onOpenChange = jest.fn();
      const { getByText } = render(
        <Menu trigger={<Text>Open Menu</Text>} onOpenChange={onOpenChange}>
          <MenuItem label="Item 1" />
        </Menu>
      );

      fireEvent.press(getByText("Open Menu"));
      expect(onOpenChange).toHaveBeenCalledWith(true);
    });
  });

  describe("controlled state", () => {
    it("respects controlled open prop", async () => {
      const { getByText, rerender } = render(
        <Menu trigger={<Text>Open Menu</Text>} open={false}>
          <MenuItem label="Item 1" />
        </Menu>
      );

      expect(() => getByText("Item 1")).toThrow();

      rerender(
        <Menu trigger={<Text>Open Menu</Text>} open={true}>
          <MenuItem label="Item 1" />
        </Menu>
      );

      await waitFor(() => {
        expect(getByText("Item 1")).toBeTruthy();
      });
    });
  });
});

//#endregion Menu Tests

//#region MenuItem Tests

describe("<MenuItem />", () => {
  describe("rendering", () => {
    it("renders with label", () => {
      const { getByText } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Test Item" />
        </Menu>
      );
      expect(getByText("Test Item")).toBeTruthy();
    });

    it("renders with labelKey (i18n)", () => {
      const { getByText } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem labelKey="label.save" />
        </Menu>
      );
      expect(getByText("Save")).toBeTruthy();
    });

    it("renders with description", () => {
      const { getByText } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Item" description="Description text" />
        </Menu>
      );
      expect(getByText("Description text")).toBeTruthy();
    });

    it("renders leading icon", () => {
      const Icon = () => <Text testID="icon">Icon</Text>;
      const { getByTestId } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Item" leadingIcon={<Icon />} />
        </Menu>
      );
      expect(getByTestId("icon")).toBeTruthy();
    });

    it("renders trailing element", () => {
      const Badge = () => <Text testID="badge">3</Text>;
      const { getByTestId } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Item" trailingElement={<Badge />} />
        </Menu>
      );
      expect(getByTestId("badge")).toBeTruthy();
    });

    it("renders with testID", () => {
      const { getByTestId } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Item" testID="test-item" />
        </Menu>
      );
      expect(getByTestId("test-item")).toBeTruthy();
    });
  });

  describe("interactions", () => {
    it("calls onPress when pressed", () => {
      const onPress = jest.fn();
      const { getByText } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Click me" onPress={onPress} />
        </Menu>
      );

      fireEvent.press(getByText("Click me"));
      expect(onPress).toHaveBeenCalledTimes(1);
    });

    it("does not call onPress when disabled", () => {
      const onPress = jest.fn();
      const { getByText } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Disabled" onPress={onPress} disabled />
        </Menu>
      );

      fireEvent.press(getByText("Disabled"));
      expect(onPress).not.toHaveBeenCalled();
    });
  });

  describe("variants", () => {
    it("renders destructive variant", () => {
      const { getByRole } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Delete" destructive />
        </Menu>
      );
      expect(getByRole("menuitem")).toBeTruthy();
    });

    it("renders disabled state", () => {
      const { getByRole } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Disabled" disabled />
        </Menu>
      );
      expect(getByRole("menuitem").props.accessibilityState.disabled).toBe(true);
    });
  });

  describe("accessibility", () => {
    it("has menuitem role", () => {
      const { getByRole } = render(
        <Menu trigger={<Text>Open</Text>} open={true}>
          <MenuItem label="Item" />
        </Menu>
      );
      expect(getByRole("menuitem")).toBeTruthy();
    });
  });
});

//#endregion MenuItem Tests

//#region MenuDivider Tests

describe("<MenuDivider />", () => {
  it("renders with separator role", () => {
    const { getByRole } = render(
      <Menu trigger={<Text>Open</Text>} open={true}>
        <MenuItem label="Item 1" />
        <MenuDivider />
        <MenuItem label="Item 2" />
      </Menu>
    );
    expect(getByRole("separator")).toBeTruthy();
  });

  it("renders with testID", () => {
    const { getByTestId } = render(
      <Menu trigger={<Text>Open</Text>} open={true}>
        <MenuDivider testID="divider" />
      </Menu>
    );
    expect(getByTestId("divider")).toBeTruthy();
  });
});

//#endregion MenuDivider Tests

//#region MenuHeader Tests

describe("<MenuHeader />", () => {
  it("renders with title", () => {
    const { getByText } = render(
      <Menu trigger={<Text>Open</Text>} open={true}>
        <MenuHeader title="Section" />
        <MenuItem label="Item" />
      </Menu>
    );
    expect(getByText("Section")).toBeTruthy();
  });

  it("renders with titleKey (i18n)", () => {
    const { getByText } = render(
      <Menu trigger={<Text>Open</Text>} open={true}>
        <MenuHeader titleKey="label.settings" />
        <MenuItem label="Item" />
      </Menu>
    );
    expect(getByText("Settings")).toBeTruthy();
  });

  it("renders with testID", () => {
    const { getByTestId } = render(
      <Menu trigger={<Text>Open</Text>} open={true}>
        <MenuHeader title="Section" testID="header" />
      </Menu>
    );
    expect(getByTestId("header")).toBeTruthy();
  });
});

//#endregion MenuHeader Tests
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- Menu
```

## Storybook

```typescript
// apps/v2/src/components/Menu/Menu.stories.tsx

import type { Meta, StoryObj } from "@storybook/react";
import { View, Text } from "react-native";
import { Menu } from "./Menu";
import { MenuItem } from "./MenuItem";
import { MenuDivider } from "./MenuDivider";
import { MenuHeader } from "./MenuHeader";

const meta: Meta<typeof Menu> = {
  title: "Components/Menu",
  component: Menu,
  argTypes: {
    position: {
      control: "select",
      options: ["bottom-left", "bottom-right", "top-left", "top-right"],
    },
    disabled: { control: "boolean" },
    closeOnSelect: { control: "boolean" },
  },
  decorators: [
    (Story) => (
      <View style={{ padding: 100, alignItems: "flex-start" }}>
        <Story />
      </View>
    ),
  ],
};

export default meta;
type Story = StoryObj<typeof Menu>;

//#region Basic Stories

const TriggerButton = () => (
  <View
    style={{
      paddingHorizontal: 16,
      paddingVertical: 8,
      backgroundColor: "#1E88E5",
      borderRadius: 4,
    }}
  >
    <Text style={{ color: "#fff" }}>Open Menu</Text>
  </View>
);

export const Basic: Story = {
  render: () => (
    <Menu trigger={<TriggerButton />}>
      <MenuItem label="Edit" onPress={() => console.log("Edit")} />
      <MenuItem label="Duplicate" onPress={() => console.log("Duplicate")} />
      <MenuItem label="Share" onPress={() => console.log("Share")} />
      <MenuDivider />
      <MenuItem
        label="Delete"
        destructive
        onPress={() => console.log("Delete")}
      />
    </Menu>
  ),
};

//#endregion Basic Stories

//#region With Icons Stories

export const WithIcons: Story = {
  render: () => (
    <Menu trigger={<TriggerButton />}>
      <MenuItem
        label="Edit"
        leadingIcon={<Text>*</Text>}
        onPress={() => console.log("Edit")}
      />
      <MenuItem
        label="Copy"
        leadingIcon={<Text>C</Text>}
        onPress={() => console.log("Copy")}
      />
      <MenuItem
        label="Move to..."
        leadingIcon={<Text>M</Text>}
        trailingElement={<Text>></Text>}
        onPress={() => console.log("Move")}
      />
    </Menu>
  ),
};

//#endregion With Icons Stories

//#region With Headers Stories

export const WithHeaders: Story = {
  render: () => (
    <Menu trigger={<TriggerButton />}>
      <MenuHeader title="Actions" />
      <MenuItem label="Edit" />
      <MenuItem label="Duplicate" />
      <MenuDivider />
      <MenuHeader title="More" />
      <MenuItem label="Archive" />
      <MenuItem label="Delete" destructive />
    </Menu>
  ),
};

//#endregion With Headers Stories

//#region With Descriptions Stories

export const WithDescriptions: Story = {
  render: () => (
    <Menu trigger={<TriggerButton />}>
      <MenuItem
        label="Public Channel"
        description="Anyone can join this channel"
      />
      <MenuItem
        label="Private Channel"
        description="Only invited members can see this"
      />
      <MenuItem
        label="Direct Message"
        description="Start a private conversation"
      />
    </Menu>
  ),
};

//#endregion With Descriptions Stories

//#region Disabled Items Stories

export const DisabledItems: Story = {
  render: () => (
    <Menu trigger={<TriggerButton />}>
      <MenuItem label="Available Action" />
      <MenuItem label="Disabled Action" disabled />
      <MenuItem label="Another Available" />
    </Menu>
  ),
};

//#endregion Disabled Items Stories

//#region Position Variants Stories

export const BottomLeft: Story = {
  args: {
    position: "bottom-left",
  },
  render: (args) => (
    <Menu trigger={<TriggerButton />} {...args}>
      <MenuItem label="Item 1" />
      <MenuItem label="Item 2" />
    </Menu>
  ),
};

export const BottomRight: Story = {
  args: {
    position: "bottom-right",
  },
  render: (args) => (
    <View style={{ alignItems: "flex-end" }}>
      <Menu trigger={<TriggerButton />} {...args}>
        <MenuItem label="Item 1" />
        <MenuItem label="Item 2" />
      </Menu>
    </View>
  ),
};

//#endregion Position Variants Stories

//#region Controlled Stories

export const Controlled: Story = {
  render: () => {
    const [open, setOpen] = React.useState(false);
    return (
      <View style={{ gap: 16 }}>
        <Menu
          trigger={<TriggerButton />}
          open={open}
          onOpenChange={setOpen}
        >
          <MenuItem label="Item 1" />
          <MenuItem label="Item 2" />
        </Menu>
        <Text>Menu is {open ? "open" : "closed"}</Text>
      </View>
    );
  },
};

//#endregion Controlled Stories

//#region Complex Example Stories

export const ComplexMenu: Story = {
  render: () => (
    <Menu trigger={<TriggerButton />}>
      <MenuHeader title="Channel Actions" />
      <MenuItem
        label="View Info"
        description="See channel details"
        leadingIcon={<Text>i</Text>}
      />
      <MenuItem
        label="Notification Preferences"
        leadingIcon={<Text>B</Text>}
        trailingElement={<Text>All</Text>}
      />
      <MenuDivider />
      <MenuHeader title="Organization" />
      <MenuItem
        label="Move to Category"
        leadingIcon={<Text>F</Text>}
        trailingElement={<Text>></Text>}
      />
      <MenuItem
        label="Mark as Favorite"
        leadingIcon={<Text>*</Text>}
      />
      <MenuDivider />
      <MenuItem
        label="Leave Channel"
        leadingIcon={<Text>X</Text>}
        destructive
      />
    </Menu>
  ),
};

//#endregion Complex Example Stories
```
