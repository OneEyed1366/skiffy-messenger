# T6.12: Pill Component

## Metadata

| Field        | Value              |
| ------------ | ------------------ |
| **ID**       | T6.12              |
| **Layer**    | L6 - UI Components |
| **Status**   | pending            |
| **Priority** | medium             |
| **Estimate** | 3h                 |
| **Parallel** | true               |
| **Assignee** | -                  |
| **Created**  | 2026-01-04         |
| **Updated**  | 2026-01-04         |

## Dependencies

| Task ID | Name         |
| ------- | ------------ |
| T0.01   | types-common |

## Blocks

| Task ID | Name                           |
| ------- | ------------------------------ |
| T10b.\* | Form components (multi-select) |

## Description

Migrate the Pill/Chip/Tag components from Mattermost. The original uses styled-components with CSS variables. This migration implements a unified Pill component with Unistyles variants for colors, sizes, and optional dismiss functionality.

## Source Files

- `vendor/desktop/webapp/channels/src/components/common/chip/chip.tsx`
- `vendor/desktop/webapp/channels/src/components/widgets/tag/tag.tsx`
- `vendor/desktop/webapp/channels/src/components/admin_console/content_flagging/user_multiselector/user_profile_pill.tsx`
- `vendor/desktop/webapp/channels/src/components/admin_console/content_flagging/user_multiselector/user_profile_pill.scss`

### Source Analysis

The original implementation uses:

- **Chip**: Styled-components button with `border-radius: 16px`, leading icon (emoji), shadow, hover states
- **Tag**: Styled-components div/button with size variants (xs/sm/md/lg), color variants (info/success/warning/danger/default), icon support
- **UserProfilePill**: Avatar + label + dismiss button pattern, `border-radius: 12px`, gap-based layout

Key patterns migrated:
| Original Component | Purpose |
|-------------------|---------|
| `Chip` | Clickable chip with emoji icon, shadow elevation |
| `Tag` | Status indicator with semantic colors |
| `UserProfilePill` | Dismissible selection pill with avatar |

Consolidated into unified `Pill` component:
| Feature | Implementation |
|---------|---------------|
| Color variants | `default`, `info`, `success`, `warning`, `danger` |
| Size variants | `sm` (20px), `md` (24px), `lg` (28px) |
| Left icon | Optional `iconLeft` prop |
| Dismiss button | Optional `onDismiss` callback shows X button |

## Migration Target

- **Target File**: `apps/v2/src/components/Pill/Pill.tsx`
- **Index Export**: `apps/v2/src/components/Pill/index.ts`

## Implementation

```typescript
// apps/v2/src/components/Pill/Pill.tsx

import { Pressable, Text, View } from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";
import { useTranslation } from "react-i18next";

//#region Types

type IPillColor = "default" | "info" | "success" | "warning" | "danger";

type IPillSize = "sm" | "md" | "lg";

type IProps = {
  /**
   * i18n translation key for pill text
   */
  labelKey?: string;
  /**
   * Direct text content (use labelKey for i18n)
   */
  label?: string;
  /**
   * Color variant
   * @default "default"
   */
  color?: IPillColor;
  /**
   * Pill size
   * @default "md"
   */
  size?: IPillSize;
  /**
   * Icon component to render on the left
   */
  iconLeft?: React.ReactNode;
  /**
   * Callback when dismiss button is pressed (shows X button when provided)
   */
  onDismiss?: () => void;
  /**
   * Callback when pill is pressed (makes pill interactive)
   */
  onPress?: () => void;
  /**
   * Disabled state
   * @default false
   */
  disabled?: boolean;
  /**
   * Ref to the underlying View/Pressable
   */
  ref?: React.Ref<React.ComponentRef<typeof View>>;
  /**
   * Test ID for testing
   */
  testID?: string;
} & UnistylesVariants<typeof styles>;

//#endregion Types

//#region Component

export function Pill({
  labelKey,
  label,
  color = "default",
  size = "md",
  iconLeft,
  onDismiss,
  onPress,
  disabled = false,
  ref,
  testID,
}: IProps) {
  const { t } = useTranslation();

  const displayText = labelKey ? t(labelKey) : label;
  const isInteractive = !!onPress || !!onDismiss;

  styles.useVariants({
    color,
    size,
    disabled,
    interactive: isInteractive,
  });

  const handlePress = () => {
    if (!disabled) {
      onPress?.();
    }
  };

  const handleDismiss = () => {
    if (!disabled) {
      onDismiss?.();
    }
  };

  const content = (
    <>
      {iconLeft && <View style={styles.iconLeft}>{iconLeft}</View>}

      {displayText && (
        <Text style={styles.text} numberOfLines={1}>
          {displayText}
        </Text>
      )}

      {onDismiss && (
        <Pressable
          style={styles.dismissButton}
          onPress={handleDismiss}
          disabled={disabled}
          hitSlop={4}
          accessibilityRole="button"
          accessibilityLabel={t("label.dismiss")}
          testID={testID ? `${testID}-dismiss` : undefined}
        >
          <Text style={styles.dismissIcon}>Ã—</Text>
        </Pressable>
      )}
    </>
  );

  if (onPress) {
    return (
      <Pressable
        ref={ref as React.Ref<React.ComponentRef<typeof Pressable>>}
        style={({ pressed }) => [
          styles.container,
          pressed && !disabled && styles.containerPressed,
        ]}
        onPress={handlePress}
        disabled={disabled}
        accessibilityRole="button"
        accessibilityState={{ disabled }}
        testID={testID}
      >
        {content}
      </Pressable>
    );
  }

  return (
    <View
      ref={ref}
      style={styles.container}
      accessibilityRole="text"
      testID={testID}
    >
      {content}
    </View>
  );
}

//#endregion Component

//#region Styles

const styles = StyleSheet.create((theme) => ({
  container: {
    flexDirection: "row",
    alignItems: "center",
    alignSelf: "flex-start",
    borderRadius: theme.radius.xl, // Pill shape (12-16px)
    gap: theme.gap(0.5), // 4px
    variants: {
      //#region Size Styles
      size: {
        sm: {
          height: 20,
          paddingHorizontal: theme.gap(1), // 8px
        },
        md: {
          height: 24,
          paddingHorizontal: theme.gap(1), // 8px
        },
        lg: {
          height: 28,
          paddingHorizontal: theme.gap(1.5), // 12px
        },
      },
      //#endregion Size Styles

      //#region Color Styles
      color: {
        default: {
          backgroundColor: `${theme.colors.centerChannelColor}14`, // 8% opacity
        },
        info: {
          backgroundColor: theme.colors.link,
        },
        success: {
          backgroundColor: theme.colors.onlineIndicator,
        },
        warning: {
          backgroundColor: theme.colors.awayIndicator,
        },
        danger: {
          backgroundColor: theme.colors.errorText,
        },
      },
      //#endregion Color Styles

      //#region State Styles
      disabled: {
        true: {
          opacity: 0.48,
        },
        false: {
          opacity: 1,
        },
      },

      interactive: {
        true: {},
        false: {},
      },
      //#endregion State Styles
    },
  },

  containerPressed: {
    variants: {
      color: {
        default: {
          backgroundColor: `${theme.colors.centerChannelColor}20`, // 12% opacity
        },
        info: {
          opacity: 0.85,
        },
        success: {
          opacity: 0.85,
        },
        warning: {
          opacity: 0.85,
        },
        danger: {
          opacity: 0.85,
        },
      },
    },
  },

  text: {
    fontFamily: theme.fonts.primary,
    fontWeight: theme.fontWeights.semiBold,
    maxWidth: 200,
    variants: {
      //#region Text Size Styles
      size: {
        sm: {
          fontSize: 11,
          lineHeight: 16,
        },
        md: {
          fontSize: 12,
          lineHeight: 16,
        },
        lg: {
          fontSize: 14,
          lineHeight: 20,
        },
      },
      //#endregion Text Size Styles

      //#region Text Color Styles
      color: {
        default: {
          color: theme.colors.centerChannelColor,
        },
        info: {
          color: "#ffffff",
        },
        success: {
          color: "#ffffff",
        },
        warning: {
          color: "#ffffff",
        },
        danger: {
          color: "#ffffff",
        },
      },
      //#endregion Text Color Styles
    },
  },

  iconLeft: {
    justifyContent: "center",
    alignItems: "center",
    variants: {
      size: {
        sm: {
          width: 12,
          height: 12,
        },
        md: {
          width: 14,
          height: 14,
        },
        lg: {
          width: 16,
          height: 16,
        },
      },
    },
  },

  dismissButton: {
    justifyContent: "center",
    alignItems: "center",
    marginLeft: theme.gap(0.25), // 2px
    variants: {
      size: {
        sm: {
          width: 14,
          height: 14,
        },
        md: {
          width: 16,
          height: 16,
        },
        lg: {
          width: 18,
          height: 18,
        },
      },
    },
  },

  dismissIcon: {
    fontWeight: theme.fontWeights.semiBold,
    textAlign: "center",
    variants: {
      size: {
        sm: {
          fontSize: 12,
          lineHeight: 14,
        },
        md: {
          fontSize: 14,
          lineHeight: 16,
        },
        lg: {
          fontSize: 16,
          lineHeight: 18,
        },
      },
      color: {
        default: {
          color: `${theme.colors.centerChannelColor}64`, // 40% opacity
        },
        info: {
          color: "rgba(255, 255, 255, 0.8)",
        },
        success: {
          color: "rgba(255, 255, 255, 0.8)",
        },
        warning: {
          color: "rgba(255, 255, 255, 0.8)",
        },
        danger: {
          color: "rgba(255, 255, 255, 0.8)",
        },
      },
    },
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/Pill/index.ts

export { Pill } from "./Pill";
```

## Acceptance Criteria

- [ ] Supports 5 color variants: default, info, success, warning, danger
- [ ] Supports 3 sizes: sm (20px), md (24px), lg (28px)
- [ ] Renders label text (via i18n key or direct string)
- [ ] Supports optional left icon slot
- [ ] Shows dismiss button (X) when `onDismiss` provided
- [ ] Interactive mode when `onPress` provided (Pressable wrapper)
- [ ] Static mode when no callbacks (View wrapper)
- [ ] Handles disabled state with visual feedback (opacity 0.48)
- [ ] Pressed state visual feedback for interactive pills
- [ ] Text truncation with ellipsis (max 200px width)
- [ ] All types use `I` prefix naming convention
- [ ] No `forwardRef` (React 19 ref prop)
- [ ] No `useCallback`/`useMemo` (React Compiler)
- [ ] Uses Unistyles variants (not conditional styles)
- [ ] TypeScript strict mode passes
- [ ] No `any` types

## Testing

```typescript
// apps/v2/src/components/Pill/Pill.spec.tsx

import { render, fireEvent } from "@testing-library/react-native";
import { Pill } from "./Pill";

//#region Rendering Tests

describe("<Pill />", () => {
  describe("rendering", () => {
    it("renders with labelKey", () => {
      const { getByText } = render(<Pill labelKey="label.new" />);
      expect(getByText("New")).toBeTruthy();
    });

    it("renders with direct label", () => {
      const { getByText } = render(<Pill label="Custom Label" />);
      expect(getByText("Custom Label")).toBeTruthy();
    });

    it("renders with testID", () => {
      const { getByTestId } = render(
        <Pill label="Test" testID="test-pill" />
      );
      expect(getByTestId("test-pill")).toBeTruthy();
    });
  });

  //#endregion Rendering Tests

  //#region Interaction Tests

  describe("interactions", () => {
    it("calls onPress when pressed", () => {
      const onPress = jest.fn();
      const { getByText } = render(
        <Pill label="Press me" onPress={onPress} />
      );

      fireEvent.press(getByText("Press me"));
      expect(onPress).toHaveBeenCalledTimes(1);
    });

    it("calls onDismiss when dismiss button pressed", () => {
      const onDismiss = jest.fn();
      const { getByTestId } = render(
        <Pill label="Dismissible" onDismiss={onDismiss} testID="pill" />
      );

      fireEvent.press(getByTestId("pill-dismiss"));
      expect(onDismiss).toHaveBeenCalledTimes(1);
    });

    it("does not call onPress when disabled", () => {
      const onPress = jest.fn();
      const { getByText } = render(
        <Pill label="Disabled" onPress={onPress} disabled />
      );

      fireEvent.press(getByText("Disabled"));
      expect(onPress).not.toHaveBeenCalled();
    });

    it("does not call onDismiss when disabled", () => {
      const onDismiss = jest.fn();
      const { getByTestId } = render(
        <Pill label="Disabled" onDismiss={onDismiss} disabled testID="pill" />
      );

      fireEvent.press(getByTestId("pill-dismiss"));
      expect(onDismiss).not.toHaveBeenCalled();
    });
  });

  //#endregion Interaction Tests

  //#region Color Variant Tests

  describe("color variants", () => {
    it("renders default color", () => {
      const { getByRole } = render(<Pill label="Default" color="default" />);
      expect(getByRole("text")).toBeTruthy();
    });

    it("renders info color", () => {
      const { getByRole } = render(<Pill label="Info" color="info" />);
      expect(getByRole("text")).toBeTruthy();
    });

    it("renders success color", () => {
      const { getByRole } = render(<Pill label="Success" color="success" />);
      expect(getByRole("text")).toBeTruthy();
    });

    it("renders warning color", () => {
      const { getByRole } = render(<Pill label="Warning" color="warning" />);
      expect(getByRole("text")).toBeTruthy();
    });

    it("renders danger color", () => {
      const { getByRole } = render(<Pill label="Danger" color="danger" />);
      expect(getByRole("text")).toBeTruthy();
    });
  });

  //#endregion Color Variant Tests

  //#region Size Tests

  describe("sizes", () => {
    it("renders small size", () => {
      const { getByRole } = render(<Pill label="Small" size="sm" />);
      expect(getByRole("text")).toBeTruthy();
    });

    it("renders medium size (default)", () => {
      const { getByRole } = render(<Pill label="Medium" />);
      expect(getByRole("text")).toBeTruthy();
    });

    it("renders large size", () => {
      const { getByRole } = render(<Pill label="Large" size="lg" />);
      expect(getByRole("text")).toBeTruthy();
    });
  });

  //#endregion Size Tests

  //#region Icon Tests

  describe("icons", () => {
    it("renders left icon", () => {
      const Icon = () => <></>;
      const { UNSAFE_getByType } = render(
        <Pill label="With Icon" iconLeft={<Icon />} />
      );
      expect(UNSAFE_getByType(Icon)).toBeTruthy();
    });
  });

  //#endregion Icon Tests

  //#region Dismiss Button Tests

  describe("dismiss button", () => {
    it("shows dismiss button when onDismiss provided", () => {
      const { getByTestId } = render(
        <Pill label="Dismissible" onDismiss={() => {}} testID="pill" />
      );
      expect(getByTestId("pill-dismiss")).toBeTruthy();
    });

    it("hides dismiss button when onDismiss not provided", () => {
      const { queryByTestId } = render(
        <Pill label="Not Dismissible" testID="pill" />
      );
      expect(queryByTestId("pill-dismiss")).toBeNull();
    });
  });

  //#endregion Dismiss Button Tests

  //#region Accessibility Tests

  describe("accessibility", () => {
    it("has text role when not interactive", () => {
      const { getByRole } = render(<Pill label="Static" />);
      expect(getByRole("text")).toBeTruthy();
    });

    it("has button role when onPress provided", () => {
      const { getByRole } = render(
        <Pill label="Interactive" onPress={() => {}} />
      );
      expect(getByRole("button")).toBeTruthy();
    });

    it("has disabled accessibility state when disabled", () => {
      const { getByRole } = render(
        <Pill label="Disabled" onPress={() => {}} disabled />
      );
      expect(getByRole("button").props.accessibilityState.disabled).toBe(true);
    });
  });

  //#endregion Accessibility Tests
});
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- Pill
```

## Storybook

```typescript
// apps/v2/src/components/Pill/Pill.stories.tsx

import type { Meta, StoryObj } from "@storybook/react";
import { View, Text } from "react-native";
import { Pill } from "./Pill";

const meta: Meta<typeof Pill> = {
  title: "Components/Pill",
  component: Pill,
  argTypes: {
    color: {
      control: "select",
      options: ["default", "info", "success", "warning", "danger"],
    },
    size: {
      control: "select",
      options: ["sm", "md", "lg"],
    },
    disabled: { control: "boolean" },
  },
  decorators: [
    (Story) => (
      <View style={{ padding: 16 }}>
        <Story />
      </View>
    ),
  ],
};

export default meta;
type Story = StoryObj<typeof Pill>;

//#region Color Variant Stories

export const Default: Story = {
  args: {
    label: "Default",
    color: "default",
  },
};

export const Info: Story = {
  args: {
    label: "Info",
    color: "info",
  },
};

export const Success: Story = {
  args: {
    label: "Success",
    color: "success",
  },
};

export const Warning: Story = {
  args: {
    label: "Warning",
    color: "warning",
  },
};

export const Danger: Story = {
  args: {
    label: "Danger",
    color: "danger",
  },
};

//#endregion Color Variant Stories

//#region Size Stories

export const Small: Story = {
  args: {
    label: "Small Pill",
    size: "sm",
  },
};

export const Medium: Story = {
  args: {
    label: "Medium Pill",
    size: "md",
  },
};

export const Large: Story = {
  args: {
    label: "Large Pill",
    size: "lg",
  },
};

//#endregion Size Stories

//#region Feature Stories

export const WithIcon: Story = {
  args: {
    label: "With Icon",
    iconLeft: <Text>*</Text>,
  },
};

export const Dismissible: Story = {
  args: {
    label: "Dismissible",
    onDismiss: () => console.log("Dismissed"),
  },
};

export const Interactive: Story = {
  args: {
    label: "Click Me",
    onPress: () => console.log("Pressed"),
  },
};

export const Disabled: Story = {
  args: {
    label: "Disabled",
    disabled: true,
    onPress: () => {},
  },
};

//#endregion Feature Stories

//#region All Colors Story

export const AllColors: Story = {
  render: () => (
    <View style={{ flexDirection: "row", flexWrap: "wrap", gap: 8 }}>
      <Pill label="Default" color="default" />
      <Pill label="Info" color="info" />
      <Pill label="Success" color="success" />
      <Pill label="Warning" color="warning" />
      <Pill label="Danger" color="danger" />
    </View>
  ),
};

//#endregion All Colors Story

//#region All Sizes Story

export const AllSizes: Story = {
  render: () => (
    <View style={{ flexDirection: "row", alignItems: "center", gap: 8 }}>
      <Pill label="Small" size="sm" />
      <Pill label="Medium" size="md" />
      <Pill label="Large" size="lg" />
    </View>
  ),
};

//#endregion All Sizes Story

//#region Dismissible All Colors Story

export const DismissibleAllColors: Story = {
  render: () => (
    <View style={{ flexDirection: "row", flexWrap: "wrap", gap: 8 }}>
      <Pill label="Default" color="default" onDismiss={() => {}} />
      <Pill label="Info" color="info" onDismiss={() => {}} />
      <Pill label="Success" color="success" onDismiss={() => {}} />
      <Pill label="Warning" color="warning" onDismiss={() => {}} />
      <Pill label="Danger" color="danger" onDismiss={() => {}} />
    </View>
  ),
};

//#endregion Dismissible All Colors Story

//#region Use Case Stories

export const TagsList: Story = {
  render: () => (
    <View style={{ gap: 8 }}>
      <Text style={{ fontWeight: "600", marginBottom: 4 }}>Selected Tags:</Text>
      <View style={{ flexDirection: "row", flexWrap: "wrap", gap: 8 }}>
        <Pill label="React" color="info" onDismiss={() => {}} />
        <Pill label="TypeScript" color="info" onDismiss={() => {}} />
        <Pill label="Mobile" color="default" onDismiss={() => {}} />
      </View>
    </View>
  ),
};

export const StatusIndicators: Story = {
  render: () => (
    <View style={{ gap: 8 }}>
      <View style={{ flexDirection: "row", alignItems: "center", gap: 8 }}>
        <Pill label="Active" color="success" size="sm" />
        <Text>Server is running</Text>
      </View>
      <View style={{ flexDirection: "row", alignItems: "center", gap: 8 }}>
        <Pill label="Warning" color="warning" size="sm" />
        <Text>High memory usage</Text>
      </View>
      <View style={{ flexDirection: "row", alignItems: "center", gap: 8 }}>
        <Pill label="Error" color="danger" size="sm" />
        <Text>Connection failed</Text>
      </View>
    </View>
  ),
};

//#endregion Use Case Stories
```
