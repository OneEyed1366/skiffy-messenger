# T5.13: usePrefixedIds Hook

## Metadata

| Field        | Value      |
| ------------ | ---------- |
| **ID**       | T5.13      |
| **Layer**    | L5 - Hooks |
| **Status**   | pending    |
| **Priority** | low        |
| **Estimate** | 0.5h       |
| **Parallel** | true       |
| **Assignee** | -          |
| **Created**  | 2026-01-06 |
| **Updated**  | 2026-01-06 |

## Dependencies

| Task ID | Name |
| ------- | ---- |
| None    | -    |

## Blocks

| Task ID | Name                  |
| ------- | --------------------- |
| T11.\*  | Suggestion components |

## Description

Generate prefixed unique IDs for child components. Useful for accessibility (aria-labelledby, aria-describedby) and test IDs.

## Source Files

- `vendor/desktop/webapp/channels/src/components/common/hooks/usePrefixedIds.ts`

## Migration Target

- **Target File**: `apps/v2/src/hooks/usePrefixedIds/usePrefixedIds.ts`
- **Index Export**: `apps/v2/src/hooks/usePrefixedIds/index.ts`

## Implementation

```typescript
// apps/v2/src/hooks/usePrefixedIds/usePrefixedIds.ts

/**
 * Prefixed ID generation hook for accessibility
 * Migrated from: vendor/desktop/webapp/channels/src/components/common/hooks/usePrefixedIds.ts
 */

import { useMemo } from "react";

//#region Types

type ISuffixMap = Record<string, unknown>;

type IPrefixedIds<S extends ISuffixMap> = {
  [K in keyof S]: string;
};

//#endregion Types

//#region Hook

/**
 * Generate prefixed IDs for accessibility and testing
 *
 * @param prefix - Unique prefix for this component instance
 * @param suffixes - Object with suffix names as keys (values are ignored)
 * @returns Object with same keys, values are `${prefix}-${key}`
 *
 * @example
 * const ids = usePrefixedIds('user-card', {
 *   title: null,
 *   description: null,
 *   avatar: null,
 * });
 *
 * // ids = {
 * //   title: 'user-card-title',
 * //   description: 'user-card-description',
 * //   avatar: 'user-card-avatar'
 * // }
 *
 * <View
 *   nativeID={ids.container}
 *   accessibilityLabelledBy={ids.title}
 * >
 *   <Text nativeID={ids.title}>{user.name}</Text>
 *   <Text nativeID={ids.description}>{user.bio}</Text>
 * </View>
 */
export function usePrefixedIds<S extends ISuffixMap>(
  prefix: string,
  suffixes: S,
): IPrefixedIds<S> {
  return useMemo(() => {
    const result = {} as IPrefixedIds<S>;

    for (const key of Object.keys(suffixes) as Array<keyof S>) {
      result[key] = `${prefix}-${String(key)}`;
    }

    return result;
  }, [prefix, suffixes]);
}

//#endregion Hook

//#region Utility

/**
 * Join multiple IDs for aria attributes that accept space-separated IDs
 *
 * @param ids - IDs to join
 * @returns Space-separated string of IDs
 *
 * @example
 * const labelledBy = joinIds(ids.title, ids.subtitle);
 * // 'user-card-title user-card-subtitle'
 *
 * <View accessibilityLabelledBy={labelledBy}>
 */
export function joinIds(...ids: (string | undefined | null)[]): string {
  return ids.filter(Boolean).join(" ");
}

//#endregion Utility

//#region Unique ID Generation

let idCounter = 0;

/**
 * Generate a unique ID with optional prefix
 *
 * @param prefix - Optional prefix for the ID
 * @returns Unique ID string
 *
 * @example
 * const id = generateUniqueId('modal');
 * // 'modal-1', 'modal-2', etc.
 */
export function generateUniqueId(prefix: string = "id"): string {
  idCounter += 1;
  return `${prefix}-${idCounter}`;
}

/**
 * Reset the ID counter (useful for testing)
 */
export function resetIdCounter(): void {
  idCounter = 0;
}

//#endregion Unique ID Generation
```

## Index Export

```typescript
// apps/v2/src/hooks/usePrefixedIds/index.ts

export {
  usePrefixedIds,
  joinIds,
  generateUniqueId,
  resetIdCounter,
} from "./usePrefixedIds";
```

## Acceptance Criteria

- [ ] Returns object with prefixed IDs
- [ ] Memoized to prevent unnecessary recalculations
- [ ] `joinIds` helper for multi-ID aria attributes
- [ ] `generateUniqueId` for one-off ID generation
- [ ] All types use `I` prefix naming convention
- [ ] TypeScript strict mode passes
- [ ] No `any` types

## Testing

```typescript
// apps/v2/src/hooks/usePrefixedIds/usePrefixedIds.spec.ts

import { renderHook } from "@testing-library/react-native";

import {
  usePrefixedIds,
  joinIds,
  generateUniqueId,
  resetIdCounter,
} from "./usePrefixedIds";

//#region usePrefixedIds Tests

describe("usePrefixedIds", () => {
  it("generates prefixed IDs from suffix object", () => {
    const { result } = renderHook(() =>
      usePrefixedIds("card", {
        title: null,
        description: null,
        image: null,
      }),
    );

    expect(result.current).toEqual({
      title: "card-title",
      description: "card-description",
      image: "card-image",
    });
  });

  it("handles empty suffix object", () => {
    const { result } = renderHook(() => usePrefixedIds("card", {}));

    expect(result.current).toEqual({});
  });

  it("memoizes result", () => {
    const suffixes = { a: null, b: null };
    const { result, rerender } = renderHook(
      ({ prefix }) => usePrefixedIds(prefix, suffixes),
      { initialProps: { prefix: "card" } },
    );

    const firstResult = result.current;
    rerender({ prefix: "card" });

    expect(result.current).toBe(firstResult);
  });

  it("updates when prefix changes", () => {
    const suffixes = { title: null };
    const { result, rerender } = renderHook(
      ({ prefix }) => usePrefixedIds(prefix, suffixes),
      { initialProps: { prefix: "card" } },
    );

    expect(result.current.title).toBe("card-title");

    rerender({ prefix: "modal" });

    expect(result.current.title).toBe("modal-title");
  });
});

//#endregion usePrefixedIds Tests

//#region joinIds Tests

describe("joinIds", () => {
  it("joins multiple IDs with space", () => {
    expect(joinIds("a", "b", "c")).toBe("a b c");
  });

  it("filters out undefined and null", () => {
    expect(joinIds("a", undefined, "b", null, "c")).toBe("a b c");
  });

  it("returns empty string for all falsy", () => {
    expect(joinIds(undefined, null)).toBe("");
  });

  it("handles single ID", () => {
    expect(joinIds("single")).toBe("single");
  });
});

//#endregion joinIds Tests

//#region generateUniqueId Tests

describe("generateUniqueId", () => {
  beforeEach(() => {
    resetIdCounter();
  });

  it("generates incrementing IDs", () => {
    expect(generateUniqueId()).toBe("id-1");
    expect(generateUniqueId()).toBe("id-2");
    expect(generateUniqueId()).toBe("id-3");
  });

  it("uses custom prefix", () => {
    expect(generateUniqueId("modal")).toBe("modal-1");
    expect(generateUniqueId("modal")).toBe("modal-2");
  });

  it("counter continues across prefixes", () => {
    expect(generateUniqueId("a")).toBe("a-1");
    expect(generateUniqueId("b")).toBe("b-2");
    expect(generateUniqueId("a")).toBe("a-3");
  });
});

describe("resetIdCounter", () => {
  it("resets counter to 0", () => {
    generateUniqueId();
    generateUniqueId();
    resetIdCounter();
    expect(generateUniqueId()).toBe("id-1");
  });
});

//#endregion generateUniqueId Tests
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- usePrefixedIds
```
