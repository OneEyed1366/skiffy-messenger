# T7.01: API Client Setup

## Metadata

| Field        | Value                 |
| ------------ | --------------------- |
| **ID**       | T7.01                 |
| **Layer**    | L7 - State Management |
| **Status**   | pending               |
| **Priority** | high                  |
| **Estimate** | 2h                    |
| **Parallel** | false                 |
| **Assignee** | -                     |
| **Created**  | 2026-01-06            |
| **Updated**  | 2026-01-06            |

## Dependencies

| Task ID | Name       |
| ------- | ---------- |
| T0.01   | types-user |

## Blocks

| Task ID | Name                     |
| ------- | ------------------------ |
| T7.10+  | All TanStack Query tasks |
| T7.50   | WebSocket Subscriptions  |

## Description

Create the core API client that handles authentication, base URLs, and HTTP requests. This is the foundation for all TanStack Query hooks.

**Reference:** See [State Management Architecture](../../../architecture/state-management.md#api-layer) for full implementation.

## Target Files

- `apps/v2/src/api/client.ts` - ApiClient class
- `apps/v2/src/api/urls.ts` - URL builder utilities
- `apps/v2/src/api/index.ts` - Barrel export

## Key Features

1. **Configuration methods**: `setUrl()`, `setToken()`, `setUserId()`, `setLocale()`
2. **Route builders**: `getBaseRoute()`, `getUsersRoute()`, `getPostsRoute()`, etc.
3. **Auth headers**: Bearer token injection
4. **Error handling**: `ApiError` class with status code and data
5. **URL utilities**: `getProfilePictureUrl()`, `getFileUrl()`, etc.

## Implementation Outline

```typescript
// api/client.ts
class ApiClient {
  private baseUrl = "";
  private token = "";

  setUrl(url: string): void;
  setToken(token: string): void;
  getBaseRoute(): string;  // ${baseUrl}/api/v4
  getHeaders(): HeadersInit;
  fetch<T>(url: string, options?: RequestInit): Promise<T>;
}

export const apiClient = new ApiClient();
export class ApiError extends Error { ... }
```

```typescript
// api/urls.ts
export function getProfilePictureUrl(
  userId: string,
  lastUpdate?: number,
): string;
export function getFileUrl(fileId: string): string;
export function getFileThumbnailUrl(fileId: string): string;
```

## Acceptance Criteria

- [ ] ApiClient singleton exported from `api/client.ts`
- [ ] Route builders for all API namespaces (users, posts, channels, teams, threads)
- [ ] `fetch<T>()` method with error handling
- [ ] `ApiError` class with statusCode and data
- [ ] URL utility functions for images and files
- [ ] TypeScript strict mode passes
- [ ] No `any` types
