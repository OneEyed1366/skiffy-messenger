# T7.52: Reset All Stores

## Metadata

| Field        | Value                 |
| ------------ | --------------------- |
| **ID**       | T7.52                 |
| **Layer**    | L7 - State Management |
| **Status**   | pending               |
| **Priority** | medium                |
| **Estimate** | 1h                    |
| **Parallel** | false                 |
| **Assignee** | -                     |
| **Created**  | 2026-01-06            |
| **Updated**  | 2026-01-06            |

## Dependencies

| Task ID | Name               |
| ------- | ------------------ |
| T7.30+  | All Zustand stores |
| T7.02   | query-client       |

## Description

Create a utility function to reset all state on logout. Clears TanStack Query cache and resets all Zustand stores.

## Target Files

- `apps/v2/src/stores/resetAllStores.ts`

## Implementation

```typescript
import { queryClient } from "@/queries/client";
import { useConnectionStore } from "./connection";
import { useTypingStore } from "./typing";
import { usePresenceStore } from "./presence";
import { useDraftsStore } from "./drafts";
import { useModalsStore } from "./ui/useModalsStore";
import { useRhsStore } from "./ui/useRhsStore";
import { useLhsStore } from "./ui/useLhsStore";
import { useChannelViewStore } from "./ui/useChannelViewStore";
import { useThreadsViewStore } from "./ui/useThreadsViewStore";
import { useSearchStore } from "./ui/useSearchStore";
import { useBrowserStore } from "./ui/useBrowserStore";
import { useSettingsStore } from "./ui/useSettingsStore";
import { useChannelSidebarStore } from "./ui/useChannelSidebarStore";
import { useEmojiStore } from "./ui/useEmojiStore";

/**
 * Resets all application state on logout.
 * Call this when user logs out to prevent data leakage.
 */
export function resetAllStores(): void {
  // Clear TanStack Query cache
  queryClient.clear();

  // Reset all Zustand stores
  useConnectionStore.getState().reset();
  useTypingStore.getState().reset();
  usePresenceStore.getState().reset();
  useDraftsStore.getState().reset();
  useModalsStore.getState().reset();
  useRhsStore.getState().reset();
  useLhsStore.getState().reset();
  useChannelViewStore.getState().reset();
  useThreadsViewStore.getState().reset();
  useSearchStore.getState().reset();
  useBrowserStore.getState().reset();
  useSettingsStore.getState().reset();
  useChannelSidebarStore.getState().reset();
  useEmojiStore.getState().reset();
}

/**
 * Partially resets state when switching teams.
 * Keeps user preferences but clears team-specific data.
 */
export function resetTeamStores(): void {
  // Invalidate team-specific queries
  queryClient.invalidateQueries({ queryKey: ["channels"] });
  queryClient.invalidateQueries({ queryKey: ["posts"] });
  queryClient.invalidateQueries({ queryKey: ["threads"] });

  // Reset team-specific UI
  useRhsStore.getState().close();
  useTypingStore.getState().reset();
  useChannelViewStore.getState().reset();
}
```

## Usage

```typescript
// In logout handler
async function handleLogout() {
  await authApi.logout();
  resetAllStores();
  router.replace("/login");
}

// In team switch handler
async function handleTeamSwitch(teamId: string) {
  resetTeamStores();
  router.push(`/team/${teamId}`);
}
```

## Acceptance Criteria

- [ ] `resetAllStores()` clears all caches and stores
- [ ] `resetTeamStores()` for team switching
- [ ] TanStack Query cache cleared
- [ ] All Zustand stores reset
- [ ] Called on logout
- [ ] No memory leaks
