# T6.08: Checkbox Component

## Metadata

| Field        | Value           |
| ------------ | --------------- |
| **ID**       | T6.08           |
| **Layer**    | L6 - Primitives |
| **Status**   | pending         |
| **Priority** | high            |
| **Estimate** | 3h              |
| **Parallel** | true            |
| **Assignee** | -               |
| **Created**  | 2026-01-04      |
| **Updated**  | 2026-01-04      |

## Dependencies

| Task ID | Name       |
| ------- | ---------- |
| T0.01   | types-core |

## Blocks

| Task ID | Name                       |
| ------- | -------------------------- |
| T10b.\* | Forms with checkbox inputs |
| T6.xx   | CheckboxGroup component    |

## Description

Migrate Checkbox component from Mattermost. The original uses native HTML checkbox with custom CSS styling for checked, unchecked, and indeterminate states. Implement using React Native Pressable with Unistyles for consistent cross-platform appearance.

## Source Files

- `vendor/desktop/webapp/channels/src/components/widgets/inputs/check/index.tsx` (lines 1-40)
- `vendor/desktop/webapp/channels/src/components/widgets/inputs/check/check.scss` (lines 1-30)
- `vendor/desktop/webapp/channels/src/components/widgets/modals/components/checkbox_setting_item.tsx` (lines 1-73)
- `vendor/desktop/webapp/channels/src/components/widgets/modals/components/base_setting_item.scss` (lines 107-148)
- `vendor/desktop/webapp/channels/src/components/widgets/icons/checkbox_checked_icon.tsx` (lines 1-61)
- `vendor/desktop/webapp/channels/src/components/widgets/icons/checkbox_partial_icon.tsx` (lines 1-61)

### Source Analysis

The original implementation uses:

- **Native checkbox input**: `<input type='checkbox' />` with custom CSS appearance override
- **CSS clip-path**: For checkmark animation using polygon path
- **CSS transitions**: 200ms transform/background-color transitions
- **SVG icons**: Separate icon components for checked and partial (indeterminate) states

Key patterns migrated:
| Original Pattern | Purpose |
|------------------|---------|
| `checked` prop | Boolean for checked state |
| `onChange` callback | Handler for state changes |
| `ariaLabel` | Accessibility label |
| Custom CSS checkbox | Styled appearance with transitions |
| Indeterminate state | Partial checkbox icon for mixed selections |
| Label association | Clickable label via htmlFor |

## Migration Target

- **Target File**: `apps/v2/src/components/Checkbox/Checkbox.tsx`
- **Index Export**: `apps/v2/src/components/Checkbox/index.ts`

## Implementation

```typescript
// apps/v2/src/components/Checkbox/Checkbox.tsx

import { Pressable, View, Text } from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";

//#region Types

type ICheckboxState = "checked" | "unchecked" | "indeterminate";

type IProps = {
  /**
   * Whether the checkbox is checked
   */
  checked?: boolean;

  /**
   * Whether the checkbox is in indeterminate state (partial selection)
   */
  indeterminate?: boolean;

  /**
   * Label text displayed next to the checkbox
   */
  label?: string;

  /**
   * Translation key for label (alternative to label prop)
   */
  labelKey?: string;

  /**
   * Callback when checkbox state changes
   */
  onChange?: (checked: boolean) => void;

  /**
   * Whether the checkbox is disabled
   */
  disabled?: boolean;

  /**
   * Whether the checkbox is in error state
   */
  error?: boolean;

  /**
   * Error message to display
   */
  errorMessage?: string;

  /**
   * Accessibility label for screen readers
   */
  accessibilityLabel?: string;

  /**
   * Test ID for testing
   */
  testID?: string;

  /**
   * Ref to the pressable element
   */
  ref?: React.Ref<React.ComponentRef<typeof Pressable>>;
} & UnistylesVariants<typeof styles>;

//#endregion Types

//#region Component

export function Checkbox({
  checked = false,
  indeterminate = false,
  label,
  labelKey,
  onChange,
  disabled = false,
  error = false,
  errorMessage,
  accessibilityLabel,
  testID,
  ref,
}: IProps) {
  const { t } = useTranslation();

  const state: ICheckboxState = indeterminate
    ? "indeterminate"
    : checked
      ? "checked"
      : "unchecked";

  styles.useVariants({ state, disabled, error });

  const handlePress = () => {
    if (disabled) return;
    onChange?.(!checked);
  };

  const displayLabel = labelKey ? t(labelKey) : label;

  return (
    <View style={styles.container}>
      <Pressable
        ref={ref}
        style={styles.pressable}
        onPress={handlePress}
        disabled={disabled}
        accessibilityRole="checkbox"
        accessibilityState={{ checked: indeterminate ? "mixed" : checked, disabled }}
        accessibilityLabel={accessibilityLabel ?? displayLabel}
        testID={testID}
      >
        <View style={styles.checkbox}>
          {state === "checked" && <CheckmarkIcon />}
          {state === "indeterminate" && <IndeterminateIcon />}
        </View>
        {displayLabel && <Text style={styles.label}>{displayLabel}</Text>}
      </Pressable>
      {error && errorMessage && (
        <Text style={styles.errorText}>{errorMessage}</Text>
      )}
    </View>
  );
}

//#endregion Component

//#region Icons

function CheckmarkIcon() {
  return (
    <View style={styles.checkmark}>
      <View style={styles.checkmarkShort} />
      <View style={styles.checkmarkLong} />
    </View>
  );
}

function IndeterminateIcon() {
  return <View style={styles.indeterminateLine} />;
}

//#endregion Icons

//#region Styles

import { useTranslation } from "react-i18next";

const styles = StyleSheet.create((theme) => ({
  container: {
    flexDirection: "column",
  },
  pressable: {
    flexDirection: "row",
    alignItems: "center",
    gap: theme.gap(1),
  },
  checkbox: {
    width: 18,
    height: 18,
    borderRadius: theme.radius.xs,
    borderWidth: 1,
    borderColor: theme.colors.centerChannelColor24,
    backgroundColor: "transparent",
    justifyContent: "center",
    alignItems: "center",
    variants: {
      state: {
        checked: {
          borderColor: theme.colors.buttonBg,
          backgroundColor: theme.colors.buttonBg,
        },
        unchecked: {
          borderColor: theme.colors.centerChannelColor24,
          backgroundColor: "transparent",
        },
        indeterminate: {
          borderColor: theme.colors.buttonBg,
          backgroundColor: theme.colors.buttonBg,
        },
      },
      disabled: {
        true: {
          opacity: 0.5,
        },
        false: {},
      },
      error: {
        true: {
          borderColor: theme.colors.errorText,
        },
        false: {},
      },
    },
  },
  checkmark: {
    width: 10,
    height: 10,
    position: "relative",
  },
  checkmarkShort: {
    position: "absolute",
    width: 3,
    height: 6,
    backgroundColor: theme.colors.buttonColor,
    borderRadius: 1,
    transform: [{ rotate: "-45deg" }],
    left: 0,
    bottom: 2,
  },
  checkmarkLong: {
    position: "absolute",
    width: 3,
    height: 10,
    backgroundColor: theme.colors.buttonColor,
    borderRadius: 1,
    transform: [{ rotate: "45deg" }],
    right: 1,
    bottom: 1,
  },
  indeterminateLine: {
    width: 10,
    height: 2,
    backgroundColor: theme.colors.buttonColor,
    borderRadius: 1,
  },
  label: {
    fontSize: 14,
    lineHeight: 20,
    color: theme.colors.centerChannelColor,
    variants: {
      disabled: {
        true: {
          opacity: 0.5,
        },
        false: {},
      },
    },
  },
  errorText: {
    fontSize: 12,
    lineHeight: 16,
    color: theme.colors.errorText,
    marginTop: theme.gap(0.5),
    marginLeft: 26, // checkbox width + gap
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/Checkbox/index.ts

export { Checkbox } from "./Checkbox";
```

## Acceptance Criteria

- [ ] Supports `checked`, `unchecked`, and `indeterminate` states
- [ ] Displays optional label text via `label` or `labelKey` prop
- [ ] Supports `disabled` state with reduced opacity
- [ ] Supports `error` state with error border and optional error message
- [ ] Uses Unistyles variants for state styling (no conditional inline styles)
- [ ] Proper accessibility with `accessibilityRole="checkbox"` and `accessibilityState`
- [ ] Indeterminate state reports `accessibilityState.checked = "mixed"`
- [ ] Checkmark icon rendered with View elements (not SVG for RN compatibility)
- [ ] Uses `ref` as regular prop (React 19, no forwardRef)
- [ ] No `useCallback`/`useMemo` (React Compiler handles optimization)
- [ ] All types use `I` prefix naming convention
- [ ] TypeScript strict mode passes
- [ ] No `any` types
- [ ] Exported from `components/Checkbox/index.ts`

## Testing

```typescript
// apps/v2/src/components/Checkbox/Checkbox.spec.tsx

import { render, fireEvent, screen } from "@testing-library/react-native";
import { Checkbox } from "./Checkbox";

//#region State Tests

describe("<Checkbox />", () => {
  describe("checked state", () => {
    it("renders unchecked by default", () => {
      render(<Checkbox testID="checkbox" />);
      const checkbox = screen.getByTestId("checkbox");

      expect(checkbox.props.accessibilityState.checked).toBe(false);
    });

    it("renders checked when checked prop is true", () => {
      render(<Checkbox checked testID="checkbox" />);
      const checkbox = screen.getByTestId("checkbox");

      expect(checkbox.props.accessibilityState.checked).toBe(true);
    });

    it("renders indeterminate state with mixed accessibility state", () => {
      render(<Checkbox indeterminate testID="checkbox" />);
      const checkbox = screen.getByTestId("checkbox");

      expect(checkbox.props.accessibilityState.checked).toBe("mixed");
    });

    it("prioritizes indeterminate over checked", () => {
      render(<Checkbox checked indeterminate testID="checkbox" />);
      const checkbox = screen.getByTestId("checkbox");

      expect(checkbox.props.accessibilityState.checked).toBe("mixed");
    });
  });

  describe("label", () => {
    it("renders label text", () => {
      render(<Checkbox label="Accept terms" />);

      expect(screen.getByText("Accept terms")).toBeOnTheScreen();
    });

    it("renders without label when not provided", () => {
      const { queryByText } = render(<Checkbox testID="checkbox" />);

      expect(queryByText(/./)).toBeNull();
    });
  });

  describe("onChange", () => {
    it("calls onChange with true when unchecked checkbox is pressed", () => {
      const onChange = jest.fn();
      render(<Checkbox checked={false} onChange={onChange} testID="checkbox" />);

      fireEvent.press(screen.getByTestId("checkbox"));

      expect(onChange).toHaveBeenCalledWith(true);
    });

    it("calls onChange with false when checked checkbox is pressed", () => {
      const onChange = jest.fn();
      render(<Checkbox checked onChange={onChange} testID="checkbox" />);

      fireEvent.press(screen.getByTestId("checkbox"));

      expect(onChange).toHaveBeenCalledWith(false);
    });

    it("does not call onChange when disabled", () => {
      const onChange = jest.fn();
      render(<Checkbox disabled onChange={onChange} testID="checkbox" />);

      fireEvent.press(screen.getByTestId("checkbox"));

      expect(onChange).not.toHaveBeenCalled();
    });
  });

  describe("disabled state", () => {
    it("sets accessibility disabled state", () => {
      render(<Checkbox disabled testID="checkbox" />);
      const checkbox = screen.getByTestId("checkbox");

      expect(checkbox.props.accessibilityState.disabled).toBe(true);
    });

    it("sets disabled prop on Pressable", () => {
      render(<Checkbox disabled testID="checkbox" />);
      const checkbox = screen.getByTestId("checkbox");

      expect(checkbox.props.disabled).toBe(true);
    });
  });

  describe("error state", () => {
    it("renders error message when error and errorMessage provided", () => {
      render(<Checkbox error errorMessage="This field is required" />);

      expect(screen.getByText("This field is required")).toBeOnTheScreen();
    });

    it("does not render error message when error is false", () => {
      render(<Checkbox error={false} errorMessage="This field is required" />);

      expect(screen.queryByText("This field is required")).toBeNull();
    });
  });

  describe("accessibility", () => {
    it("has checkbox role", () => {
      render(<Checkbox testID="checkbox" />);
      const checkbox = screen.getByTestId("checkbox");

      expect(checkbox.props.accessibilityRole).toBe("checkbox");
    });

    it("uses label as accessibilityLabel by default", () => {
      render(<Checkbox label="Accept terms" testID="checkbox" />);
      const checkbox = screen.getByTestId("checkbox");

      expect(checkbox.props.accessibilityLabel).toBe("Accept terms");
    });

    it("prefers explicit accessibilityLabel over label", () => {
      render(
        <Checkbox
          label="Accept terms"
          accessibilityLabel="Accept terms and conditions"
          testID="checkbox"
        />
      );
      const checkbox = screen.getByTestId("checkbox");

      expect(checkbox.props.accessibilityLabel).toBe("Accept terms and conditions");
    });
  });
});

//#endregion State Tests
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- Checkbox
```
