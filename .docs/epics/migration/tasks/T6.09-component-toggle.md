# T6.09: Toggle Component

## Metadata

| Field        | Value           |
| ------------ | --------------- |
| **ID**       | T6.09           |
| **Layer**    | L6 - Primitives |
| **Status**   | pending         |
| **Priority** | high            |
| **Estimate** | 3h              |
| **Parallel** | true            |
| **Assignee** | -               |
| **Created**  | 2026-01-04      |
| **Updated**  | 2026-01-04      |

## Dependencies

| Task ID | Name          |
| ------- | ------------- |
| T0.01   | types-utility |

## Blocks

| Task ID | Name                          |
| ------- | ----------------------------- |
| T10b.\* | Settings screens with toggles |

## Description

Migrate Toggle/Switch component from Mattermost. The original uses CSS-based toggle button with `classnames` for state management. Replace with React Native `Switch` as base or custom animated implementation using `react-native-reanimated` for smooth transitions.

## Source Files

- `vendor/desktop/webapp/channels/src/components/toggle.tsx` (lines 1-76)
- `vendor/desktop/webapp/channels/src/components/admin_console/team_channel_settings/line_switch.tsx` (lines 1-52)

### Source Analysis

The original implementation uses:

- **classNames**: For conditional CSS class application (`active`, `disabled`)
- **Button element**: Custom styled button with inner `.handle` div for toggle thumb
- **Text labels**: Optional on/off text displayed inside toggle

Key props migrated:
| Original Prop | Purpose |
|---------------|---------|
| `onToggle` | Callback when toggle state changes |
| `toggled` | Current on/off state |
| `disabled` | Prevents interaction |
| `onText` / `offText` | Optional labels displayed in toggle |
| `size` | Size variants: `btn-lg`, `btn-md`, `btn-sm` |
| `ariaLabel` | Accessibility label |

LineSwitch wrapper provides:
| Feature | Purpose |
|---------|---------|
| `title` | Label displayed to left/top of toggle |
| `subTitle` | Help text below toggle |
| `singleLine` | Compact single-line layout |

## Migration Target

- **Target File**: `apps/v2/src/components/Toggle/Toggle.tsx`
- **Index Export**: `apps/v2/src/components/Toggle/index.ts`

## Implementation

```typescript
// apps/v2/src/components/Toggle/Toggle.tsx

/**
 * Toggle/Switch component
 * Migrated from: vendor/desktop/webapp/channels/src/components/toggle.tsx
 *
 * Uses React Native Switch with Unistyles theming
 */

import { Platform, Pressable, Switch, Text, View } from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";
import { useTranslation } from "react-i18next";

//#region Types

type IToggleProps = {
  /**
   * Current toggle state
   */
  value: boolean;

  /**
   * Callback when toggle changes
   */
  onValueChange: (value: boolean) => void;

  /**
   * Prevents user interaction
   */
  disabled?: boolean;

  /**
   * Label text (translation key)
   */
  labelKey?: string;

  /**
   * Label position relative to toggle
   * @default 'left'
   */
  labelPosition?: "left" | "right";

  /**
   * Accessible label for screen readers
   */
  accessibilityLabel?: string;

  /**
   * Test ID for testing
   */
  testID?: string;

  /**
   * Ref for the switch component
   */
  ref?: React.Ref<React.ComponentRef<typeof Switch>>;
} & UnistylesVariants<typeof styles>;

//#endregion Types

//#region Component

export function Toggle({
  value,
  onValueChange,
  disabled = false,
  labelKey,
  labelPosition = "left",
  accessibilityLabel,
  testID,
  size = "medium",
  ref,
}: IToggleProps) {
  const { t } = useTranslation();
  styles.useVariants({ size, disabled: disabled ? "true" : "false" });

  const handleValueChange = (newValue: boolean) => {
    if (!disabled) {
      onValueChange(newValue);
    }
  };

  const label = labelKey ? (
    <Text style={styles.label}>{t(labelKey)}</Text>
  ) : null;

  const switchComponent = (
    <Switch
      ref={ref}
      value={value}
      onValueChange={handleValueChange}
      disabled={disabled}
      trackColor={{
        false: styles.trackOff.backgroundColor as string,
        true: styles.trackOn.backgroundColor as string,
      }}
      thumbColor={
        Platform.OS === "android"
          ? value
            ? (styles.thumbOn.backgroundColor as string)
            : (styles.thumbOff.backgroundColor as string)
          : undefined
      }
      ios_backgroundColor={styles.trackOff.backgroundColor as string}
      accessibilityLabel={accessibilityLabel}
      accessibilityRole="switch"
      accessibilityState={{ checked: value, disabled }}
      testID={testID}
      style={styles.switch}
    />
  );

  if (!label) {
    return switchComponent;
  }

  return (
    <Pressable
      style={styles.container}
      onPress={() => handleValueChange(!value)}
      disabled={disabled}
      accessibilityRole="switch"
      accessibilityState={{ checked: value, disabled }}
      accessibilityLabel={accessibilityLabel}
    >
      {labelPosition === "left" && label}
      {switchComponent}
      {labelPosition === "right" && label}
    </Pressable>
  );
}

//#endregion Component

//#region Styles

const styles = StyleSheet.create((theme) => ({
  container: {
    flexDirection: "row",
    alignItems: "center",
    gap: theme.gap(1.5),
  },

  switch: {
    variants: {
      size: {
        small: {
          transform: [{ scale: 0.8 }],
        },
        medium: {
          transform: [{ scale: 1 }],
        },
        large: {
          transform: [{ scale: 1.2 }],
        },
      },
    },
  },

  label: {
    fontSize: 16,
    color: theme.colors.centerChannelColor,
    variants: {
      size: {
        small: {
          fontSize: 14,
        },
        medium: {
          fontSize: 16,
        },
        large: {
          fontSize: 18,
        },
      },
      disabled: {
        true: {
          opacity: 0.5,
        },
        false: {
          opacity: 1,
        },
      },
    },
  },

  // Track colors (extracted for use in props)
  trackOff: {
    backgroundColor: theme.colors.centerChannelColor + "40", // 25% opacity
  },

  trackOn: {
    backgroundColor: theme.colors.buttonBg,
  },

  // Thumb colors (Android only)
  thumbOff: {
    backgroundColor: theme.colors.centerChannelBg,
  },

  thumbOn: {
    backgroundColor: theme.colors.buttonColor,
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/Toggle/index.ts

export { Toggle } from "./Toggle";
```

## Acceptance Criteria

- [ ] Uses React Native `Switch` as base component
- [ ] Supports `value` and `onValueChange` for controlled state
- [ ] Supports `disabled` state with visual feedback
- [ ] Supports optional `labelKey` with i18n translation
- [ ] Supports `labelPosition` (left/right)
- [ ] Size variants: `small`, `medium`, `large`
- [ ] Track/thumb colors from Unistyles theme
- [ ] Platform-specific styling (iOS vs Android)
- [ ] Proper accessibility attributes (`accessibilityRole`, `accessibilityState`)
- [ ] All types use `I` prefix naming convention
- [ ] TypeScript strict mode passes
- [ ] No `any` types
- [ ] Exported from `components/Toggle/index.ts`

## Testing

```typescript
// apps/v2/src/components/Toggle/Toggle.spec.tsx

import { fireEvent, render, screen } from "@testing-library/react-native";

import { Toggle } from "./Toggle";

//#region Basic Rendering

describe("<Toggle />", () => {
  it("renders switch in off state", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        testID="toggle"
      />
    );

    const toggle = screen.getByTestId("toggle");
    expect(toggle.props.value).toBe(false);
  });

  it("renders switch in on state", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={true}
        onValueChange={onValueChange}
        testID="toggle"
      />
    );

    const toggle = screen.getByTestId("toggle");
    expect(toggle.props.value).toBe(true);
  });
});

//#endregion Basic Rendering

//#region Interaction

describe("Toggle interaction", () => {
  it("calls onValueChange when toggled", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        testID="toggle"
      />
    );

    const toggle = screen.getByTestId("toggle");
    fireEvent(toggle, "valueChange", true);

    expect(onValueChange).toHaveBeenCalledWith(true);
  });

  it("does not call onValueChange when disabled", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        disabled={true}
        testID="toggle"
      />
    );

    const toggle = screen.getByTestId("toggle");
    fireEvent(toggle, "valueChange", true);

    expect(onValueChange).not.toHaveBeenCalled();
  });
});

//#endregion Interaction

//#region Label

describe("Toggle with label", () => {
  it("renders label on the left by default", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        labelKey="settings.notifications.enable"
        testID="toggle"
      />
    );

    expect(screen.getByText("settings.notifications.enable")).toBeTruthy();
  });

  it("renders label on the right when specified", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        labelKey="settings.notifications.enable"
        labelPosition="right"
        testID="toggle"
      />
    );

    expect(screen.getByText("settings.notifications.enable")).toBeTruthy();
  });

  it("toggles when label container is pressed", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        labelKey="settings.notifications.enable"
        testID="toggle"
      />
    );

    const container = screen.getByRole("switch");
    fireEvent.press(container);

    expect(onValueChange).toHaveBeenCalledWith(true);
  });
});

//#endregion Label

//#region Accessibility

describe("Toggle accessibility", () => {
  it("has correct accessibility role", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        testID="toggle"
      />
    );

    const toggle = screen.getByTestId("toggle");
    expect(toggle.props.accessibilityRole).toBe("switch");
  });

  it("has correct accessibility state when on", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={true}
        onValueChange={onValueChange}
        testID="toggle"
      />
    );

    const toggle = screen.getByTestId("toggle");
    expect(toggle.props.accessibilityState).toEqual({
      checked: true,
      disabled: false,
    });
  });

  it("has correct accessibility state when disabled", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        disabled={true}
        testID="toggle"
      />
    );

    const toggle = screen.getByTestId("toggle");
    expect(toggle.props.accessibilityState).toEqual({
      checked: false,
      disabled: true,
    });
  });

  it("uses custom accessibility label", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        accessibilityLabel="Enable notifications"
        testID="toggle"
      />
    );

    const toggle = screen.getByTestId("toggle");
    expect(toggle.props.accessibilityLabel).toBe("Enable notifications");
  });
});

//#endregion Accessibility

//#region Size Variants

describe("Toggle size variants", () => {
  it("renders small size", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        size="small"
        testID="toggle"
      />
    );

    expect(screen.getByTestId("toggle")).toBeTruthy();
  });

  it("renders medium size by default", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        testID="toggle"
      />
    );

    expect(screen.getByTestId("toggle")).toBeTruthy();
  });

  it("renders large size", () => {
    const onValueChange = jest.fn();

    render(
      <Toggle
        value={false}
        onValueChange={onValueChange}
        size="large"
        testID="toggle"
      />
    );

    expect(screen.getByTestId("toggle")).toBeTruthy();
  });
});

//#endregion Size Variants
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- Toggle
```
