# T7.35: RHS Store (Right Hand Sidebar)

## Metadata

| Field        | Value                 |
| ------------ | --------------------- |
| **ID**       | T7.35                 |
| **Layer**    | L7 - State Management |
| **Status**   | pending               |
| **Priority** | high                  |
| **Estimate** | 3h                    |
| **Parallel** | true                  |
| **Assignee** | -                     |
| **Created**  | 2026-01-06            |
| **Updated**  | 2026-01-06            |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T7.04   | store-setup |

## Blocks

| Task ID | Name             |
| ------- | ---------------- |
| T9.15   | useThreadRouting |
| T10c.\* | RHS components   |

## Description

Create a complex UI store for the Right Hand Sidebar with ~20 state fields. Handles thread view, search, pinned posts, etc.

**Reference:** See [State Management Architecture](../../../architecture/state-management.md#rhs-store) for full implementation.

## Target Files

- `apps/v2/src/stores/ui/useRhsStore.ts`

## State Shape

```typescript
type IRhsView =
  | "thread"
  | "search"
  | "pinned"
  | "flagged"
  | "mentions"
  | "channel_info"
  | "channel_members"
  | "edit_history"
  | null;

type IRhsState = {
  isOpen: boolean;
  view: IRhsView;
  selectedPostId: string | null;
  selectedChannelId: string | null;
  searchTerms: string;
  searchType: "messages" | "files" | "";
  isExpanded: boolean;
  previousStates: Array<{ view: IRhsView; postId: string | null }>;
};

type IRhsActions = {
  openThread: (postId: string) => void;
  openSearch: (terms?: string, type?: "messages" | "files") => void;
  openPinned: (channelId: string) => void;
  openFlagged: () => void;
  openMentions: () => void;
  openChannelInfo: (channelId: string) => void;
  openChannelMembers: (channelId: string) => void;
  close: () => void;
  goBack: () => void;
  setExpanded: (expanded: boolean) => void;
  setSearchTerms: (terms: string) => void;
  reset: () => void;
};
```

## Key Feature: Navigation Stack

```typescript
openThread: (postId) => {
  const current = get();
  set({
    isOpen: true,
    view: "thread",
    selectedPostId: postId,
    previousStates: current.view
      ? [...current.previousStates, { view: current.view, postId: current.selectedPostId }]
      : current.previousStates,
  });
},

goBack: () => {
  const { previousStates } = get();
  if (previousStates.length === 0) {
    set({ isOpen: false, view: null });
    return;
  }
  const previous = previousStates[previousStates.length - 1];
  set({
    view: previous.view,
    selectedPostId: previous.postId,
    previousStates: previousStates.slice(0, -1),
  });
},
```

## Selector Hooks

```typescript
export const useIsRhsOpen = () => useRhsStore((s) => s.isOpen);
export const useRhsView = () => useRhsStore((s) => s.view);
export const useSelectedThreadId = () =>
  useRhsStore((s) => (s.view === "thread" ? s.selectedPostId : null));
```

## Acceptance Criteria

- [ ] 8 RHS view types supported
- [ ] Navigation history stack for goBack()
- [ ] Search terms and type tracking
- [ ] Expanded state for mobile
- [ ] All open\* actions with proper state updates
- [ ] close() and reset() functions
