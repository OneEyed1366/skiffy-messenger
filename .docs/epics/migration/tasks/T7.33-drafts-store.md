# T7.33: Drafts Store (Persisted)

## Metadata

| Field        | Value                 |
| ------------ | --------------------- |
| **ID**       | T7.33                 |
| **Layer**    | L7 - State Management |
| **Status**   | pending               |
| **Priority** | high                  |
| **Estimate** | 2h                    |
| **Parallel** | true                  |
| **Assignee** | -                     |
| **Created**  | 2026-01-06            |
| **Updated**  | 2026-01-06            |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T7.04   | store-setup |

## Blocks

| Task ID | Name      |
| ------- | --------- |
| T9.19   | useDrafts |

## Description

Create a **persisted** Zustand store for message drafts. Drafts survive app restarts.

**Reference:** See [State Management Architecture](../../../architecture/state-management.md#drafts-store-persisted) for full implementation.

## Target Files

- `apps/v2/src/stores/drafts/useDraftsStore.ts`
- `apps/v2/src/stores/drafts/index.ts`

## State Shape

```typescript
type IDraft = {
  message: string;
  files?: string[]; // File IDs pending upload
  updatedAt: number;
};

type IDraftsState = {
  channelDrafts: Record<string, IDraft>; // channelId -> draft
  threadDrafts: Record<string, IDraft>; // rootPostId -> draft
};

type IDraftsActions = {
  setChannelDraft: (
    channelId: string,
    message: string,
    files?: string[],
  ) => void;
  setThreadDraft: (rootId: string, message: string, files?: string[]) => void;
  clearChannelDraft: (channelId: string) => void;
  clearThreadDraft: (rootId: string) => void;
  reset: () => void;
};
```

## Key: Persistence

```typescript
export const useDraftsStore = createStore<IDraftsStore>(
  (set) => ({ ... }),
  { name: "drafts", persist: true }  // â† Persisted!
);
```

## Selector Hooks

```typescript
export const useChannelDraft = (channelId: string) =>
  useDraftsStore((s) => s.channelDrafts[channelId]);

export const useThreadDraft = (rootId: string) =>
  useDraftsStore((s) => s.threadDrafts[rootId]);
```

## Acceptance Criteria

- [ ] Separate channel and thread drafts
- [ ] Persisted to localStorage (web) / AsyncStorage (native)
- [ ] Auto-timestamp on updates
- [ ] File attachment IDs support
- [ ] Clear individual or all drafts
