# T6.07: TextInput Component

## Metadata

| Field        | Value                |
| ------------ | -------------------- |
| **ID**       | T6.07                |
| **Layer**    | L6 - Base Components |
| **Status**   | pending              |
| **Priority** | high                 |
| **Estimate** | 5h                   |
| **Parallel** | true                 |
| **Assignee** | -                    |
| **Created**  | 2026-01-04           |
| **Updated**  | 2026-01-04           |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T0.01   | types-theme |
| T5.01   | icons       |

## Blocks

| Task ID | Name                             |
| ------- | -------------------------------- |
| T6.08   | component-search-input           |
| T10b.\* | Form components with text inputs |

## Description

Migrate the Input component from Mattermost desktop. The original uses class-based React with `classnames`, `react-intl`, and custom validation. Replace with functional React 19 component using Unistyles, ref-as-prop pattern, and i18next for translations.

## Source Files

- `vendor/desktop/webapp/channels/src/components/widgets/inputs/input/input.tsx` (lines 1-322)
- `vendor/desktop/webapp/channels/src/components/widgets/inputs/password_input/password_input.tsx` (lines 1-99)

### Source Analysis

The original implementation uses:

- **classnames**: For conditional CSS class joining
- **react-intl**: For i18n placeholder/label formatting
- **forwardRef**: For ref forwarding (replaced with ref-as-prop in React 19)
- **useState/useEffect**: For focus state and validation messages
- **ItemStatus enum**: For message types (ERROR, WARNING, INFO, SUCCESS)

Key features migrated:
| Original Feature | Purpose |
|------------------|---------|
| `label` | Floating label that animates on focus |
| `placeholder` | Input placeholder text |
| `customMessage` | Error/warning/info/success messages |
| `inputPrefix/inputSuffix` | Left/right icons or elements |
| `clearable` | Clear button to reset input |
| `type="textarea"` | Multiline text input variant |
| `PasswordInput` | Password visibility toggle |
| `validate` | Custom validation function |
| `limit/minLength` | Character length constraints |

## Migration Target

- **Target Folder**: `apps/v2/src/components/TextInput/`
- **Component File**: `apps/v2/src/components/TextInput/TextInput.tsx`
- **Spec File**: `apps/v2/src/components/TextInput/TextInput.spec.tsx`
- **Stories File**: `apps/v2/src/components/TextInput/TextInput.stories.tsx`
- **Index Export**: `apps/v2/src/components/TextInput/index.ts`

## Implementation

```typescript
// apps/v2/src/components/TextInput/TextInput.tsx

import React, { useState } from "react";
import {
  View,
  TextInput as RNTextInput,
  Text,
  Pressable,
  type TextInputProps as RNTextInputProps,
  type NativeSyntheticEvent,
  type TextInputFocusEventData,
} from "react-native";
import { StyleSheet, UnistylesVariants } from "react-native-unistyles";
import { useTranslation } from "react-i18next";

//#region Types

type IMessageType = "error" | "warning" | "info" | "success";

type ICustomMessage = {
  type: IMessageType;
  value: string;
};

type IProps = {
  /**
   * Input label displayed above the field
   */
  labelKey?: string;
  /**
   * Placeholder text translation key
   */
  placeholderKey?: string;
  /**
   * Placeholder text (raw string, use placeholderKey for i18n)
   */
  placeholder?: string;
  /**
   * Helper text displayed below the input
   */
  helperTextKey?: string;
  /**
   * Error message to display (sets error state automatically)
   */
  errorMessage?: string;
  /**
   * Custom message object for info/warning/success states
   */
  customMessage?: ICustomMessage | null;
  /**
   * Icon element to display on the left side
   */
  leftIcon?: React.ReactNode;
  /**
   * Icon element to display on the right side
   */
  rightIcon?: React.ReactNode;
  /**
   * Show clear button when input has value
   */
  clearable?: boolean;
  /**
   * Callback when clear button is pressed
   */
  onClear?: () => void;
  /**
   * Enable multiline textarea mode
   */
  multiline?: boolean;
  /**
   * Number of lines for multiline mode
   */
  numberOfLines?: number;
  /**
   * Enable password mode with visibility toggle
   */
  secureTextEntry?: boolean;
  /**
   * Show password visibility toggle (only when secureTextEntry=true)
   */
  showPasswordToggle?: boolean;
  /**
   * Disabled state
   */
  disabled?: boolean;
  /**
   * Ref to the underlying TextInput
   */
  ref?: React.Ref<React.ComponentRef<typeof RNTextInput>>;
} & Omit<RNTextInputProps, "placeholder" | "editable" | "secureTextEntry"> &
  UnistylesVariants<typeof styles>;

//#endregion Types

//#region Component

export function TextInput({
  labelKey,
  placeholderKey,
  placeholder,
  helperTextKey,
  errorMessage,
  customMessage,
  leftIcon,
  rightIcon,
  clearable = false,
  onClear,
  multiline = false,
  numberOfLines = 4,
  secureTextEntry = false,
  showPasswordToggle = true,
  disabled = false,
  value,
  onFocus,
  onBlur,
  ref,
  ...restProps
}: IProps) {
  const { t } = useTranslation();
  const [isFocused, setIsFocused] = useState(false);
  const [isPasswordVisible, setIsPasswordVisible] = useState(false);

  // Determine message state
  const hasError = Boolean(errorMessage);
  const message: ICustomMessage | null = errorMessage
    ? { type: "error", value: errorMessage }
    : customMessage ?? null;

  // Apply variants
  styles.useVariants({
    hasError,
    disabled,
    focused: isFocused,
    multiline,
  });

  const handleFocus = (e: NativeSyntheticEvent<TextInputFocusEventData>) => {
    setIsFocused(true);
    onFocus?.(e);
  };

  const handleBlur = (e: NativeSyntheticEvent<TextInputFocusEventData>) => {
    setIsFocused(false);
    onBlur?.(e);
  };

  const handleClear = () => {
    onClear?.();
  };

  const togglePasswordVisibility = () => {
    setIsPasswordVisible((prev) => !prev);
  };

  const resolvedPlaceholder = placeholderKey
    ? t(placeholderKey)
    : placeholder ?? "";

  const showClearButton = clearable && value && String(value).length > 0;
  const showPasswordButton = secureTextEntry && showPasswordToggle;
  const isSecure = secureTextEntry && !isPasswordVisible;

  return (
    <View style={styles.container}>
      {/* Label */}
      {labelKey && (
        <Text style={styles.label}>{t(labelKey)}</Text>
      )}

      {/* Input Container */}
      <View style={styles.inputWrapper}>
        {/* Left Icon */}
        {leftIcon && <View style={styles.leftIcon}>{leftIcon}</View>}

        {/* Text Input */}
        <RNTextInput
          ref={ref}
          style={styles.input}
          value={value}
          placeholder={resolvedPlaceholder}
          placeholderTextColor={styles.placeholder.color}
          editable={!disabled}
          secureTextEntry={isSecure}
          multiline={multiline}
          numberOfLines={multiline ? numberOfLines : 1}
          textAlignVertical={multiline ? "top" : "center"}
          onFocus={handleFocus}
          onBlur={handleBlur}
          {...restProps}
        />

        {/* Right Icon */}
        {rightIcon && !showClearButton && !showPasswordButton && (
          <View style={styles.rightIcon}>{rightIcon}</View>
        )}

        {/* Clear Button */}
        {showClearButton && !showPasswordButton && (
          <Pressable
            onPress={handleClear}
            style={styles.clearButton}
            accessibilityRole="button"
            accessibilityLabel={t("renderer.components.textInput.clear")}
          >
            <Text style={styles.clearButtonText}>‚úï</Text>
          </Pressable>
        )}

        {/* Password Toggle */}
        {showPasswordButton && (
          <Pressable
            onPress={togglePasswordVisibility}
            style={styles.passwordToggle}
            accessibilityRole="button"
            accessibilityLabel={
              isPasswordVisible
                ? t("renderer.components.textInput.hidePassword")
                : t("renderer.components.textInput.showPassword")
            }
          >
            <Text style={styles.passwordToggleText}>
              {isPasswordVisible ? "üëÅ" : "üëÅ‚Äçüó®"}
            </Text>
          </Pressable>
        )}
      </View>

      {/* Helper Text */}
      {helperTextKey && !message && (
        <Text style={styles.helperText}>{t(helperTextKey)}</Text>
      )}

      {/* Message (Error/Warning/Info/Success) */}
      {message && (
        <Text
          style={[
            styles.message,
            message.type === "error" && styles.messageError,
            message.type === "warning" && styles.messageWarning,
            message.type === "info" && styles.messageInfo,
            message.type === "success" && styles.messageSuccess,
          ]}
          accessibilityRole={message.type === "error" ? "alert" : undefined}
        >
          {message.value}
        </Text>
      )}
    </View>
  );
}

//#endregion Component

//#region Styles

const styles = StyleSheet.create((theme) => ({
  container: {
    width: "100%",
  },
  label: {
    fontSize: 14,
    fontWeight: "500",
    color: theme.colors.centerChannelColor,
    marginBottom: theme.gap(0.5),
    variants: {
      hasError: {
        true: { color: theme.colors.errorText },
        false: {},
      },
      disabled: {
        true: { color: theme.colors.centerChannelColor, opacity: 0.5 },
        false: {},
      },
    },
  },
  inputWrapper: {
    flexDirection: "row",
    alignItems: "center",
    backgroundColor: theme.colors.centerChannelBg,
    borderWidth: 1,
    borderColor: theme.colors.centerChannelColor20,
    borderRadius: theme.radius.m,
    paddingHorizontal: theme.gap(1.5),
    minHeight: 48,
    variants: {
      focused: {
        true: { borderColor: theme.colors.buttonBg },
        false: {},
      },
      hasError: {
        true: { borderColor: theme.colors.errorText },
        false: {},
      },
      disabled: {
        true: { backgroundColor: theme.colors.centerChannelColor05, opacity: 0.6 },
        false: {},
      },
      multiline: {
        true: { minHeight: 100, alignItems: "flex-start", paddingVertical: theme.gap(1) },
        false: {},
      },
    },
  },
  input: {
    flex: 1,
    fontSize: 16,
    color: theme.colors.centerChannelColor,
    paddingVertical: theme.gap(1),
    variants: {
      multiline: {
        true: { minHeight: 80 },
        false: {},
      },
      disabled: {
        true: { color: theme.colors.centerChannelColor50 },
        false: {},
      },
    },
  },
  placeholder: {
    color: theme.colors.centerChannelColor50,
  },
  leftIcon: {
    marginRight: theme.gap(1),
  },
  rightIcon: {
    marginLeft: theme.gap(1),
  },
  clearButton: {
    padding: theme.gap(0.5),
    marginLeft: theme.gap(0.5),
  },
  clearButtonText: {
    fontSize: 16,
    color: theme.colors.centerChannelColor50,
  },
  passwordToggle: {
    padding: theme.gap(0.5),
    marginLeft: theme.gap(0.5),
  },
  passwordToggleText: {
    fontSize: 18,
  },
  helperText: {
    fontSize: 12,
    color: theme.colors.centerChannelColor50,
    marginTop: theme.gap(0.5),
  },
  message: {
    fontSize: 12,
    marginTop: theme.gap(0.5),
  },
  messageError: {
    color: theme.colors.errorText,
  },
  messageWarning: {
    color: theme.colors.awayIndicator,
  },
  messageInfo: {
    color: theme.colors.buttonBg,
  },
  messageSuccess: {
    color: theme.colors.onlineIndicator,
  },
}));

//#endregion Styles
```

## Index Export

```typescript
// apps/v2/src/components/TextInput/index.ts

export { TextInput } from "./TextInput";
```

## Acceptance Criteria

- [ ] Label displays above input when `labelKey` provided
- [ ] Placeholder text displays when input is empty
- [ ] Error state shows red border and error message
- [ ] Helper text displays below input
- [ ] Left icon renders inside input on left side
- [ ] Right icon renders inside input on right side
- [ ] Clear button appears when `clearable=true` and input has value
- [ ] Clear button calls `onClear` callback
- [ ] Multiline mode expands input height
- [ ] Password mode hides text with bullets
- [ ] Password toggle button shows/hides password
- [ ] Disabled state reduces opacity and prevents input
- [ ] Focus state shows accent border color
- [ ] Uses Unistyles variants (no conditional styles)
- [ ] Uses ref-as-prop pattern (no forwardRef)
- [ ] Uses i18next for translations
- [ ] TypeScript strict mode passes
- [ ] No `any` types
- [ ] Types use `I` prefix convention

## Testing

```typescript
// apps/v2/src/components/TextInput/TextInput.spec.tsx

import React from "react";
import { render, fireEvent, screen } from "@testing-library/react-native";

import { TextInput } from "./TextInput";

//#region Label Tests

describe("<TextInput /> label", () => {
  it("renders label when labelKey provided", () => {
    render(<TextInput labelKey="renderer.components.textInput.email" />);

    expect(screen.getByText("Email")).toBeTruthy();
  });

  it("does not render label when labelKey not provided", () => {
    render(<TextInput placeholderKey="renderer.components.textInput.email" />);

    expect(screen.queryByText("Email")).toBeNull();
  });
});

//#endregion Label Tests

//#region Placeholder Tests

describe("<TextInput /> placeholder", () => {
  it("renders placeholder from placeholderKey", () => {
    render(<TextInput placeholderKey="renderer.components.textInput.enterEmail" />);

    expect(screen.getByPlaceholderText("Enter email")).toBeTruthy();
  });

  it("renders raw placeholder string", () => {
    render(<TextInput placeholder="Enter your email" />);

    expect(screen.getByPlaceholderText("Enter your email")).toBeTruthy();
  });
});

//#endregion Placeholder Tests

//#region Error State Tests

describe("<TextInput /> error state", () => {
  it("displays error message", () => {
    render(<TextInput errorMessage="Invalid email address" />);

    expect(screen.getByText("Invalid email address")).toBeTruthy();
  });

  it("has alert role for error message", () => {
    render(<TextInput errorMessage="Invalid email address" />);

    expect(screen.getByRole("alert")).toBeTruthy();
  });
});

//#endregion Error State Tests

//#region Helper Text Tests

describe("<TextInput /> helper text", () => {
  it("displays helper text", () => {
    render(<TextInput helperTextKey="renderer.components.textInput.emailHint" />);

    expect(screen.getByText("We'll never share your email")).toBeTruthy();
  });

  it("hides helper text when error is present", () => {
    render(
      <TextInput
        helperTextKey="renderer.components.textInput.emailHint"
        errorMessage="Invalid email"
      />,
    );

    expect(screen.queryByText("We'll never share your email")).toBeNull();
    expect(screen.getByText("Invalid email")).toBeTruthy();
  });
});

//#endregion Helper Text Tests

//#region Clear Button Tests

describe("<TextInput /> clear button", () => {
  it("shows clear button when clearable and has value", () => {
    render(<TextInput clearable value="test" onChangeText={jest.fn()} />);

    expect(screen.getByLabelText("Clear")).toBeTruthy();
  });

  it("hides clear button when empty", () => {
    render(<TextInput clearable value="" onChangeText={jest.fn()} />);

    expect(screen.queryByLabelText("Clear")).toBeNull();
  });

  it("calls onClear when pressed", () => {
    const onClear = jest.fn();
    render(
      <TextInput clearable value="test" onChangeText={jest.fn()} onClear={onClear} />,
    );

    fireEvent.press(screen.getByLabelText("Clear"));

    expect(onClear).toHaveBeenCalled();
  });
});

//#endregion Clear Button Tests

//#region Password Toggle Tests

describe("<TextInput /> password toggle", () => {
  it("hides text by default in secure mode", () => {
    render(<TextInput secureTextEntry value="password123" onChangeText={jest.fn()} />);

    const input = screen.getByDisplayValue("password123");
    expect(input.props.secureTextEntry).toBe(true);
  });

  it("shows password toggle button", () => {
    render(<TextInput secureTextEntry value="password123" onChangeText={jest.fn()} />);

    expect(screen.getByLabelText("Show password")).toBeTruthy();
  });

  it("toggles password visibility on press", () => {
    render(<TextInput secureTextEntry value="password123" onChangeText={jest.fn()} />);

    fireEvent.press(screen.getByLabelText("Show password"));

    expect(screen.getByLabelText("Hide password")).toBeTruthy();
    const input = screen.getByDisplayValue("password123");
    expect(input.props.secureTextEntry).toBe(false);
  });

  it("hides toggle when showPasswordToggle=false", () => {
    render(
      <TextInput
        secureTextEntry
        showPasswordToggle={false}
        value="password123"
        onChangeText={jest.fn()}
      />,
    );

    expect(screen.queryByLabelText("Show password")).toBeNull();
  });
});

//#endregion Password Toggle Tests

//#region Multiline Tests

describe("<TextInput /> multiline", () => {
  it("enables multiline mode", () => {
    render(<TextInput multiline value="line1\nline2" onChangeText={jest.fn()} />);

    const input = screen.getByDisplayValue("line1\nline2");
    expect(input.props.multiline).toBe(true);
  });

  it("sets numberOfLines", () => {
    render(
      <TextInput multiline numberOfLines={6} value="text" onChangeText={jest.fn()} />,
    );

    const input = screen.getByDisplayValue("text");
    expect(input.props.numberOfLines).toBe(6);
  });
});

//#endregion Multiline Tests

//#region Disabled State Tests

describe("<TextInput /> disabled state", () => {
  it("prevents editing when disabled", () => {
    render(<TextInput disabled value="readonly" onChangeText={jest.fn()} />);

    const input = screen.getByDisplayValue("readonly");
    expect(input.props.editable).toBe(false);
  });
});

//#endregion Disabled State Tests

//#region Focus State Tests

describe("<TextInput /> focus state", () => {
  it("calls onFocus when focused", () => {
    const onFocus = jest.fn();
    render(<TextInput onFocus={onFocus} onChangeText={jest.fn()} />);

    const input = screen.getByRole("textbox") ?? screen.getByTestId("text-input");
    fireEvent(input, "focus");

    expect(onFocus).toHaveBeenCalled();
  });

  it("calls onBlur when blurred", () => {
    const onBlur = jest.fn();
    render(<TextInput onBlur={onBlur} onChangeText={jest.fn()} />);

    const input = screen.getByRole("textbox") ?? screen.getByTestId("text-input");
    fireEvent(input, "blur");

    expect(onBlur).toHaveBeenCalled();
  });
});

//#endregion Focus State Tests

//#region Icon Tests

describe("<TextInput /> icons", () => {
  it("renders left icon", () => {
    const { getByTestId } = render(
      <TextInput
        leftIcon={<MockIcon testID="left-icon" />}
        onChangeText={jest.fn()}
      />,
    );

    expect(getByTestId("left-icon")).toBeTruthy();
  });

  it("renders right icon", () => {
    const { getByTestId } = render(
      <TextInput
        rightIcon={<MockIcon testID="right-icon" />}
        onChangeText={jest.fn()}
      />,
    );

    expect(getByTestId("right-icon")).toBeTruthy();
  });
});

//#endregion Icon Tests

//#region Custom Message Tests

describe("<TextInput /> custom messages", () => {
  it("displays info message", () => {
    render(
      <TextInput
        customMessage={{ type: "info", value: "This is informational" }}
        onChangeText={jest.fn()}
      />,
    );

    expect(screen.getByText("This is informational")).toBeTruthy();
  });

  it("displays warning message", () => {
    render(
      <TextInput
        customMessage={{ type: "warning", value: "Please verify" }}
        onChangeText={jest.fn()}
      />,
    );

    expect(screen.getByText("Please verify")).toBeTruthy();
  });

  it("displays success message", () => {
    render(
      <TextInput
        customMessage={{ type: "success", value: "Looks good!" }}
        onChangeText={jest.fn()}
      />,
    );

    expect(screen.getByText("Looks good!")).toBeTruthy();
  });
});

//#endregion Custom Message Tests

//#region Test Helpers

function MockIcon({ testID }: { testID: string }) {
  return <></>;
}

//#endregion Test Helpers
```

## i18n Keys

Add the following keys to translation files:

```json
{
  "renderer.components.textInput.clear": "Clear",
  "renderer.components.textInput.showPassword": "Show password",
  "renderer.components.textInput.hidePassword": "Hide password",
  "renderer.components.textInput.email": "Email",
  "renderer.components.textInput.enterEmail": "Enter email",
  "renderer.components.textInput.emailHint": "We'll never share your email"
}
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- TextInput
```
