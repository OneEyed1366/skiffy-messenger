# T0.08: Thread Types

## Metadata

| Field        | Value      |
| ------------ | ---------- |
| **ID**       | T0.08      |
| **Layer**    | L0 - Types |
| **Status**   | pending    |
| **Priority** | high       |
| **Estimate** | 1h         |
| **Parallel** | true       |
| **Assignee** | -          |
| **Created**  | 2026-01-04 |
| **Updated**  | 2026-01-04 |

## Dependencies

| Task ID | Name          |
| ------- | ------------- |
| T0.01   | User Types    |
| T0.02   | Channel Types |
| T0.03   | Post Types    |
| T0.04   | Team Types    |
| T0.05   | Utility Types |

## Blocks

| Task ID | Name             |
| ------- | ---------------- |
| T8.15   | useThreadRouting |
| T10e.06 | ThreadsView      |
| T10e.07 | ThreadItem       |

## Description

Migrate thread-related TypeScript types from Mattermost. These types handle user threads, thread lists, and thread state management for the threaded messaging feature.

## Source File

- `vendor/desktop/webapp/platform/types/src/threads.ts`

## Target File

`apps/v2/src/types/thread.ts`

## Implementation

```typescript
// apps/v2/src/types/thread.ts

/**
 * Thread-related type definitions
 * Migrated from: vendor/desktop/webapp/platform/types/src/threads.ts
 */

import type { IChannel } from "./channel";
import type { IPost } from "./post";
import type { ITeam } from "./team";
import type { IUserProfile } from "./user";
import type {
  IIDMappedObjects,
  IRelationOneToMany,
  IRelationOneToOne,
} from "./utilities";

//#region Thread Type Enum

export enum IUserThreadType {
  Synthetic = "S", // derived from post
}

//#endregion

//#region User Thread

export type IUserThread = {
  id: string;
  reply_count: number;
  last_reply_at: number;
  last_viewed_at: number;
  participants: Array<{ id: IUserProfile["id"] } | IUserProfile>;
  unread_replies: number;
  unread_mentions: number;
  is_following: boolean;
  is_urgent?: boolean;
  type?: IUserThreadType;

  /**
   * Only depend on channel_id and user_id for UserThread<>Channel/User mapping,
   * use normalized post store/selectors as those are kept up-to-date in the store
   */
  post: {
    channel_id: IChannel["id"];
    user_id: IUserProfile["id"];
  };
};

//#endregion

//#region Synthetic Thread

type ISyntheticMissingKeys =
  | "unread_replies"
  | "unread_mentions"
  | "last_viewed_at";

export type IUserThreadSynthetic = Omit<IUserThread, ISyntheticMissingKeys> & {
  type: IUserThreadType.Synthetic;
};

/**
 * Type guard to check if a thread is synthetic
 */
export function threadIsSynthetic(
  thread: IUserThread | IUserThreadSynthetic,
): thread is IUserThreadSynthetic {
  return thread.type === IUserThreadType.Synthetic;
}

//#endregion

//#region Thread with Post

export type IUserThreadWithPost = IUserThread & { post: IPost };

//#endregion

//#region Thread List

export type IUserThreadList = {
  total: number;
  total_unread_threads: number;
  total_unread_mentions: number;
  total_unread_urgent_mentions?: number;
  threads: IUserThreadWithPost[];
};

//#endregion

//#region Thread Counts

export type IThreadCounts = {
  total: number;
  total_unread_threads: number;
  total_unread_mentions: number;
  total_unread_urgent_mentions?: number;
};

//#endregion

//#region Threads State

export type IThreadsState = {
  threadsInTeam: IRelationOneToMany<ITeam, IUserThread>;
  unreadThreadsInTeam: IRelationOneToMany<ITeam, IUserThread>;
  threads: IIDMappedObjects<IUserThread>;
  counts: IRelationOneToOne<ITeam, IThreadCounts>;
  countsIncludingDirect: IRelationOneToOne<ITeam, IThreadCounts>;
};

//#endregion
```

## Index Export

```typescript
// apps/v2/src/types/index.ts

export { IUserThreadType, threadIsSynthetic } from "./thread";

export type {
  IUserThread,
  IUserThreadSynthetic,
  IUserThreadWithPost,
  IUserThreadList,
  IThreadCounts,
  IThreadsState,
} from "./thread";
```

## Acceptance Criteria

- [ ] All types defined with `type` keyword
- [ ] All types prefixed with `I`
- [ ] Enum prefixed with `I` (`IUserThreadType`)
- [ ] Uses `#region` comments for organization
- [ ] Type guard function `threadIsSynthetic` included
- [ ] Extracted `IThreadCounts` for reuse (DRY)
- [ ] Proper imports from dependent type files
- [ ] Exported from `types/index.ts`
- [ ] No `any` types
- [ ] TypeScript strict mode passes

## Testing

```bash
pnpm --filter @retrievly/app tsc --noEmit
```
