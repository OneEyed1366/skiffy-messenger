# T9.03: useCurrentChannel Hook

## Metadata

| Field        | Value            |
| ------------ | ---------------- |
| **ID**       | T9.03            |
| **Layer**    | L9 - State Hooks |
| **Status**   | pending          |
| **Priority** | high             |
| **Estimate** | 1h               |
| **Parallel** | true             |
| **Assignee** | -                |
| **Created**  | 2026-01-06       |
| **Updated**  | 2026-01-06       |

## Dependencies

| Task ID | Name        |
| ------- | ----------- |
| T7.04   | Store Setup |

## Blocks

| Task ID | Name                     |
| ------- | ------------------------ |
| T9.xx   | Channel view components  |
| T10c.xx | Message composer, header |

## Description

Create a hook to get the currently viewed channel from the channels store. Returns the channel object, member info, and loading state.

## Source Analysis

- **Redux Selector**: `vendor/desktop/webapp/platform/client/src/selectors/entities/channels.ts` - `getCurrentChannel`

## Migration Target

- **Target File**: `apps/v2/src/hooks/useCurrentChannel/useCurrentChannel.ts`
- **Index Export**: `apps/v2/src/hooks/useCurrentChannel/index.ts`

## Implementation

```typescript
// apps/v2/src/hooks/useCurrentChannel/useCurrentChannel.ts

import { useChannelsStore } from "@/stores";
import type { IChannel, IChannelMember } from "@/types";

//#region Types

type IUseCurrentChannelReturn = {
  channel: IChannel | null;
  channelId: string | null;
  member: IChannelMember | null;
  loading: boolean;
};

//#endregion

//#region Hook

export function useCurrentChannel(): IUseCurrentChannelReturn {
  const currentChannelId = useChannelsStore((state) => state.currentChannelId);
  const channel = useChannelsStore((state) =>
    state.currentChannelId ? state.channels[state.currentChannelId] : null,
  );
  const member = useChannelsStore((state) =>
    state.currentChannelId ? state.members[state.currentChannelId] : null,
  );
  const loading = useChannelsStore((state) => state.isLoading);

  return { channel, channelId: currentChannelId, member, loading };
}

//#endregion
```

## Index Export

```typescript
// apps/v2/src/hooks/useCurrentChannel/index.ts
export { useCurrentChannel } from "./useCurrentChannel";
```

## Acceptance Criteria

- [ ] Returns current channel object or null
- [ ] Returns current channel ID
- [ ] Returns channel member info for current user
- [ ] Returns loading state
- [ ] Re-renders only when relevant state changes
- [ ] TypeScript strict mode passes

## Testing

```typescript
// apps/v2/src/hooks/useCurrentChannel/useCurrentChannel.spec.ts

import { renderHook } from "@testing-library/react-native";
import { useCurrentChannel } from "./useCurrentChannel";
import { useChannelsStore } from "@/stores";

jest.mock("@/stores");

describe("useCurrentChannel", () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  it("returns null when no channel is selected", () => {
    (useChannelsStore as unknown as jest.Mock).mockImplementation((selector) =>
      selector({
        currentChannelId: null,
        channels: {},
        members: {},
        isLoading: false,
      }),
    );

    const { result } = renderHook(() => useCurrentChannel());

    expect(result.current.channel).toBeNull();
    expect(result.current.channelId).toBeNull();
    expect(result.current.member).toBeNull();
  });

  it("returns current channel when selected", () => {
    const mockChannel = { id: "ch-1", name: "general", type: "O" };
    const mockMember = {
      channel_id: "ch-1",
      user_id: "u-1",
      roles: "channel_user",
    };

    (useChannelsStore as unknown as jest.Mock).mockImplementation((selector) =>
      selector({
        currentChannelId: "ch-1",
        channels: { "ch-1": mockChannel },
        members: { "ch-1": mockMember },
        isLoading: false,
      }),
    );

    const { result } = renderHook(() => useCurrentChannel());

    expect(result.current.channel).toEqual(mockChannel);
    expect(result.current.member).toEqual(mockMember);
  });
});
```
