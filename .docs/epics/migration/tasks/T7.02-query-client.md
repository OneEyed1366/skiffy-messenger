# T7.02: QueryClient Setup

## Metadata

| Field        | Value                 |
| ------------ | --------------------- |
| **ID**       | T7.02                 |
| **Layer**    | L7 - State Management |
| **Status**   | pending               |
| **Priority** | high                  |
| **Estimate** | 2h                    |
| **Parallel** | false                 |
| **Assignee** | -                     |
| **Created**  | 2026-01-06            |
| **Updated**  | 2026-01-06            |

## Dependencies

| Task ID | Name       |
| ------- | ---------- |
| T7.01   | api-client |

## Blocks

| Task ID | Name                     |
| ------- | ------------------------ |
| T7.10+  | All TanStack Query tasks |
| T7.51   | State Provider           |

## Description

Configure TanStack Query's QueryClient with optimal defaults for a real-time messaging application.

**Reference:** See [State Management Architecture](../../../architecture/state-management.md#queryclient-configuration) for full implementation.

## Target Files

- `apps/v2/src/queries/client.ts`

## Key Configuration

```typescript
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60, // 1 minute
      gcTime: 1000 * 60 * 5, // 5 minutes
      retry: 3,
      retryDelay: (i) => Math.min(1000 * 2 ** i, 30000),
      refetchOnWindowFocus: true, // Important for real-time app
      refetchOnReconnect: true,
    },
    mutations: {
      retry: 1,
    },
  },
});
```

## Acceptance Criteria

- [ ] QueryClient instance exported
- [ ] staleTime = 60s (data fresh for 1 minute)
- [ ] gcTime = 5 minutes (cache retained after unmount)
- [ ] Exponential backoff retry for queries
- [ ] Window focus refetch enabled
- [ ] Reconnect refetch enabled
