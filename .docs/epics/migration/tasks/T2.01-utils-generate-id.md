# T2.01: generateId Utility

## Metadata

| Field        | Value           |
| ------------ | --------------- |
| **ID**       | T2.01           |
| **Layer**    | L2 - Pure Utils |
| **Status**   | pending         |
| **Priority** | high            |
| **Estimate** | 0.5h            |
| **Parallel** | true            |
| **Assignee** | -               |
| **Created**  | 2026-01-04      |
| **Updated**  | 2026-01-04      |

## Dependencies

None

## Blocks

| Task ID | Name                        |
| ------- | --------------------------- |
| T7.\*   | All store implementations   |
| T8.\*   | All hooks                   |
| T10.\*  | All components needing keys |

## Description

Migrate ID generation utility from Mattermost. The original uses Math.random() for UUID v4 generation. Replace with `uuid` package for cryptographically secure random values.

## Source Files

- `vendor/desktop/webapp/channels/src/utils/utils.tsx` (lines 1129-1148)

### Original Implementation

```typescript
// Generates a RFC-4122 version 4 compliant globally unique identifier.
export function generateId() {
  // implementation taken from http://stackoverflow.com/a/2117523
  let id = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";

  id = id.replace(/[xy]/g, (c) => {
    const r = Math.floor(Math.random() * 16);

    let v;
    if (c === "x") {
      v = r;
    } else {
      v = (r & 0x3) | 0x8;
    }

    return v.toString(16);
  });

  return id;
}
```

## Target File

`apps/v2/src/utils/id.ts`

## Implementation

```typescript
// apps/v2/src/utils/id.ts

import { v4 as uuidv4 } from "uuid";

/**
 * Generates a RFC-4122 version 4 compliant globally unique identifier.
 * Uses cryptographically secure random values via uuid package.
 *
 * @returns A UUID v4 string (e.g., "550e8400-e29b-41d4-a716-446655440000")
 *
 * @example
 * const id = generateId();
 * // => "550e8400-e29b-41d4-a716-446655440000"
 */
export function generateId(): string {
  return uuidv4();
}
```

## Index Export

```typescript
// apps/v2/src/utils/index.ts

export { generateId } from "./id";
```

## Package Dependency

```bash
pnpm --filter @retrievly/app add uuid
pnpm --filter @retrievly/app add -D @types/uuid
```

## Acceptance Criteria

- [ ] Uses `uuid` package instead of Math.random()
- [ ] Function returns RFC-4122 v4 compliant UUID
- [ ] Exported from `utils/index.ts`
- [ ] TypeScript strict mode passes
- [ ] No `any` types

## Testing

```typescript
// apps/v2/src/utils/id.spec.ts

import { generateId } from "./id";

const UUID_V4_REGEX =
  /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;

describe("generateId", () => {
  it("returns a valid UUID v4 string", () => {
    const id = generateId();

    expect(id).toMatch(UUID_V4_REGEX);
  });

  it("generates unique IDs on each call", () => {
    const ids = new Set<string>();
    const iterations = 1000;

    for (let i = 0; i < iterations; i++) {
      ids.add(generateId());
    }

    expect(ids.size).toBe(iterations);
  });

  it("returns a 36-character string", () => {
    const id = generateId();

    expect(id).toHaveLength(36);
  });
});
```

### Run Tests

```bash
pnpm --filter @retrievly/app test:unit -- id.spec
```
